YUI.add("mail-ui-foldersview-bind",function(B){var Q=B.Node.one,C=NeoConfig,W=B.common.Utils,X=B.mail.persist.MetaData,A=B.mail.common,T=strings.str_nav_inbox,H=!(C.pfm&&C.pfm.count);var V="#system-folders",R="#custom-folders",J=Q(V),I=Q(R),K={"in":"Inbox",chats:"%40C%40Chats",drafts:"Draft",sent:"Sent",folder:"%40B%40Bulk",spam:"%40B%40Bulk",trash:"Trash"},d={"Inbox":"str_tabs_inbox","Draft":"str_tabs_drafts","Sent":"str_tabs_sent","%40B%40Bulk":"str_tabs_spam","%40C%40Chats":"str_tabs_conversations","Trash":"str_tabs_trash"},U=NeoConfig.grayoutEnabled,O=B.Lang;var c=function(h){var i=this,Y=U&&B.mail.ui.ContextButton,g=h.target;h.preventDefault();function f(k){var e=J.menu.getContextTarget(),j;if(e){k.target=e.ancestor(function(l){j=l.getAttribute("data-fid")||null;return j;},true);if(j){i.handleFolderActions(k,j);}}}if(!J.menu){B.use("common-ui-menu-helper",function(j){var e=j.common.ui.MenuHelper;e.createLoadingMenu(J,{isContext:true,xy:[h.clientX,h.clientY]});j.use("mail-ui-inboxmenu-base",function(k){k.mail.ui.InboxMenu.insert("menu-system-folder",function(){var l=Q("#menu-system-folder");k.common.ui.MenuHelper.create(J,{menu:l,isContext:true,xy:[h.clientX,h.clientY],contextTarget:h.target},function(){l.on("menuSelected",f);l.on("menu:state",function(o){var m=J.menu.getContextTarget().ancestor("li");if(o.state=="show"){var n=this.one("[data-action=folder-allread]");if(m&&"%40C%40Chats"===m.getAttribute("data-fid")){n.addClass("disabled");n.one("a").set("aria-disabled",true);}else{n.removeClass("disabled");n.one("a").removeAttribute("aria-disabled");}}else{if(o.state=="hide"){g&&g.focus();}}if(Y){Y.setNodeFolderMenu(m,l);}M(m,o.state);});});});});});}};function M(Y,e){if(Y){if("show"==e&&!Y.hasClass("selected")){Y.addClass("cntxtmenu");}else{if("hide"==e){Y.removeClass("cntxtmenu");}}}}function D(f,g){var Y;if(f){f=f[g.keyCode==40?"next":"previous"]();if(f&&(f.getStyle("display")!=="none")){Y=f;}else{Y=D(f,g);}}return Y;}var S=function(f){var Y=f.currentTarget,g=Y.getAttribute("data-mboxid");this.checkMail(g);};var G=function(Y){B.fire("#system-folders.li:keydown",Y);};var E=function(h){var i=h.currentTarget,g=h.keyCode,Y,f=B.UA.os;if((f=="macintosh")&&(g==8)){g=46;}switch(g){case 46:if(!i.one("input")){this.handleFolderActions({dataAction:"folder-remove"},i.getAttribute("data-fid"));h.preventDefault();}break;case 67:this.handleFolderActions({dataAction:"folder-rename",target:i});break;case 121:case 77:Y=(f=="windows"||f=="win");if((Y&&h.shiftKey&&g==121)||(!Y&&h.ctrlKey&&h.shiftKey&&h.altKey&&g==77)){h.preventDefault();W.simulateContextMenu(h.target);}break;}};var N=function(h){var g=h.target,f,Y;if(h.keyCode==38||h.keyCode==40){h.halt();f=D(g.ancestor("li"),h);if(f){g.set("tabIndex",-1);Y=f.one("a[role=option]");Y.set("tabIndex",0);Y.focus();}}};var b=function(Y){var f=W.getDataAction(Y);this.handleFolderActions({"dataAction":f.action,target:Y.target});};var L=function(g){var f=g.currentTarget,Y=f.one("input.trash"),h;if(Y){g.halt();B.UA.webkit&&g.target.focus();h=W.getDataAction(g);this.handleFolderActions({dataAction:h.action,target:g.target});}};var F=function(o){function i(){var r=J.all(".inbox-sub"),q=X.get("neo.pref.mboxesState")===1?0:1,e;if(r){r.each(function(s){s.toggleClass("hidden");});}if((e=J.one("#"+(q?"hide":"show")+"-accts"))){e.set("tabIndex",0);e.focus();}NeoConfig.expandEA=q;X.set("neo.pref.mboxesState",q);}var p=o.currentTarget,h=o.target,n,Y,f,m,g,l,j,k;if(p.hasClass("in")||p.hasClass("inbox-sub")){k=h.getAttribute("data-action");if(k==="show-accounts"){o.halt();i();}else{if(!h.hasClass("check-mail")){n=O.trim(p.one("input").getAttribute("data-mboxid"));g={fid:"Inbox",name:T,mailboxId:n&&n.length>0?n:"Inbox",smartFolder:o.smartFolder,forceRefresh:o.smartFolder};l=A&&A.cachewarmer;}}}else{if(o.target.get("type")!="button"){Y=p.get("className").split(" ");f=strings[d[p.getAttribute("data-fid")]];m=K[O.trim(Y[0])];j=m||Y[0];if(j){g={fid:m||Y[0],name:f,mailboxId:null,smartFolder:o.smartFolder,forceRefresh:o.smartFolder};}}}if(g){o.preventDefault();this.set("fid",g);l&&!H&&++H&&l.preFetchMessages(g.fid,null,100);}};var P=function(g){var f=g.currentTarget,h=f.getAttribute("data-fid"),Y=O.trim(f.one("a i").get("text"));if(this.get("active")&&(h===g.fid)){this.handleFolderActions({dataAction:"folder-rename",target:g.currentTarget});}else{this.set("fid",{fid:h,name:Y,smartFolder:g.smartFolder,forceRefresh:g.smartFolder});}};var a=function(h){var i=this,Y=U&&B.mail.ui.ContextButton,g=h.target;h.preventDefault();function f(k){var e=I.menu.getContextTarget(),j;if(e){k.target=e.ancestor(function(l){j=l.getAttribute("data-fid")||null;return j;},true);if(j){i.handleFolderActions(k,j);}}}if(!I.menu){B.use("common-ui-menu-helper",function(j){var e=j.common.ui.MenuHelper;e.createLoadingMenu(I,{isContext:true,xy:[h.clientX,h.clientY]});j.use("mail-ui-inboxmenu-base",function(k){k.mail.ui.InboxMenu.insert("menu-folder",function(){var l=Q("#menu-folder");e.create(I,{menu:l,isContext:true,xy:[h.clientX,h.clientY],contextTarget:h.target},function(){l.on("menuSelected",f);l.on("menu:state",function(n){var m=I.menu.getContextTarget().ancestor("li");if(Y){Y.setNodeFolderMenu(m,l);}M(m,n.state);if(n.state=="hide"){g&&g.focus();}});});});});});}};function Z(h){var g=Q(R+"-nav"),Y=Q("#renamer");h.preventDefault();if(!Y||Y.getStyle("display")=="none"){g.toggleClass("collapsed");g.toggleClass("expanded");var f=g.hasClass("expanded");g.one("span").set("title",f?strings.str_nav_left_folders_expanded_attr:strings.str_nav_left_folders_collapsed_attr);g.one(".label").set("aria-expanded",f);X.set("neo.pref.folderState",f?1:0);}}B.mix(B.mail.FoldersView,{contextClick:c,folderHilite:M,checkMailClick:S,sysFoldersKeyDown:G,usrFoldersKeyDown:E,upDownNavigation:N,newFolderClick:b,emptyFolderOnClick:L,sysFoldersClick:F,usrFoldersClick:P,usrFoldersContextClick:a,onLabelClick:Z});},"1.0.0");