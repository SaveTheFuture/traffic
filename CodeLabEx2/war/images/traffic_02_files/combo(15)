YUI.add("comms-intl-bidihighlight",function(A){A.mix(A.namespace("comms.Intl"),{_needPrevChar:/[\u0620\u0622-\u063F\u0641-\u064A\u066E\u066F\u0671-\u0673\u0675-\u06D3\u06D5\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u077F\u07CA-\u07EA]/,_needNextChar:/[\u0620\u0626\u0628\u062A-\u062E\u0633-\u063F\u0641-\u0647\u0649\u064A\u066E\u066F\u0678-\u0687\u069A-\u06BF\u06C1\u06C2\u06CC\u06CE\u06D0\u06D1\u06FA-\u06FC\u06FF\u0712-\u0714\u071A-\u071D\u071F-\u0727\u0729\u072B\u072D\u072E\u074E-\u0758\u075C-\u076A\u076D-\u0770\u0772\u0775-\u0777\u077A-\u077F\u07CA-\u07EA]/,_highlightJoiner:"\u200d",_highlightStartTag:"<b>",_highlightEndTag:"</b>",_initializeBidiHighlightJoiner:function(){if(A.UA.webkit){this._highlightJoiner="\u0640";}},highlightString:function(I,J,G){var K,F,M,D,B,L,C,E,H;E=function(N){return N==""?"":N.charAt(N.length-1);};H=function(N){return N==""?"":N.charAt(0);};if(I.length===0){return"";}L=E(J);C=H(G);K=I.charAt(0);M=I.charAt(I.length-1);F=K.charCodeAt(0);D=M.charCodeAt(0);if(L===""||L.charCodeAt(0)<1568||F<1568){B=this._highlightStartTag+I;}else{if(this._needNextChar.test(L)&&this._needPrevChar.test(K)){B=this._highlightJoiner+this._highlightStartTag+this._highlightJoiner+I;}else{B=this._highlightStartTag+I;}}if(C===""||C.charCodeAt(0)<1568||D<1568){B=B+this._highlightEndTag;}else{if(this._needPrevChar.test(C)&&this._needNextChar.test(M)){B=B+this._highlightJoiner+this._highlightEndTag+this._highlightJoiner;}else{B=B+this._highlightEndTag;}}return B;}});A.comms.Intl._initializeBidiHighlightJoiner();},"1.0.0");YUI.add("io-base",function(d){var D="io:start",p="io:complete",b="io:success",f="io:failure",E="io:end",y=0,o={"X-Requested-With":"XMLHttpRequest"},z={},k=d.config.win;function l(){return k.XMLHttpRequest?new XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP");}function e(){var w=y;y++;return w;}function x(G,w){var F={};F.id=d.Lang.isNumber(w)?w:e();G=G||{};if(!G.use&&!G.upload){F.c=l();}else{if(G.use){if(G.use==="native"){if(k.XDomainRequest){F.c=new XDomainRequest();F.t=G.use;}else{F.c=l();}}else{F.c=d.io._transport[G.use];F.t=G.use;}}else{F.c={};F.t="io:iframe";}}return F;}function i(w){if(k){if(w.c&&k.XMLHttpRequest){w.c.onreadystatechange=null;}else{if(d.UA.ie===6&&!w.t){w.c.abort();}}}w.c=null;w=null;}function q(H,I){var G=new d.EventTarget().publish("transaction:"+H),w=I.arguments,F=I.context||d;if(w){G.on(I.on[H],F,w);}else{G.on(I.on[H],F);}return G;}function u(G,F){var w=F.arguments;if(w){d.fire(D,G,w);}else{d.fire(D,G);}if(F.on&&F.on.start){q("start",F).fire(G);}}function g(G,H){var F=G.e?{status:0,statusText:G.e}:G.c,w=H.arguments;if(w){d.fire(p,G.id,F,w);}else{d.fire(p,G.id,F);}if(H.on&&H.on.complete){q("complete",H).fire(G.id,F);}}function j(F,G){var w=G.arguments;if(w){d.fire(E,F.id,w);}else{d.fire(E,F.id);}if(G.on&&G.on.end){q("end",G).fire(F.id);}i(F);}function t(F,G){var w=G.arguments;if(w){d.fire(b,F.id,F.c,w);}else{d.fire(b,F.id,F.c);}if(G.on&&G.on.success){q("success",G).fire(F.id,F.c);}j(F,G);}function h(G,H){var F=G.e?{status:0,statusText:G.e}:G.c,w=H.arguments;if(w){d.fire(f,G.id,F,w);}else{d.fire(f,G.id,F);}if(H.on&&H.on.failure){q("failure",H).fire(G.id,F);}j(G,H);}function a(G,w,H,F){i(G);H.xdr.use="flash";H.data=H.form&&F?F:null;return d.io(w,H,G.id);}function r(w,F){w+=((w.indexOf("?")==-1)?"?":"&")+F;return w;}function v(w,F){if(F){o[w]=F;}else{delete o[w];}}function c(G,w){var F;w=w||{};for(F in o){if(o.hasOwnProperty(F)){if(!w[F]){w[F]=o[F];}}}for(F in w){if(w.hasOwnProperty(F)){if(w[F]!=="disable"){G.setRequestHeader(F,w[F]);}}}}function n(F,w){if(F&&F.c){F.e=w;F.c.abort();}}function s(F,w){z[F.id]=k.setTimeout(function(){n(F,"timeout");},w);}function m(w){k.clearTimeout(z[w]);delete z[w];}function B(G,H){var w;try{w=(G.c.status&&G.c.status!==0)?G.c.status:0;}catch(F){w=0;}if(w>=200&&w<300||w===1223){t(G,H);}else{h(G,H);}}function C(w,F){if(w.c.readyState===4){if(F.timeout){m(w.id);}k.setTimeout(function(){g(w,F);B(w,F);},0);}}function A(G,O,K){var L,F,M,H,w,S,J,Q,I,R=G;O=d.Object(O);F=x(O.xdr||O.form,K);H=O.method?O.method=O.method.toUpperCase():O.method="GET";S=O.sync;J=O.data;if(d.Lang.isObject(O.data)&&d.QueryString){O.data=d.QueryString.stringify(O.data);}if(O.form){if(O.form.upload){return d.io.upload(F,G,O);}else{L=d.io._serialize(O.form,O.data);if(H==="POST"||H==="PUT"){O.data=L;}else{if(H==="GET"){G=r(G,L);}}}}if(O.data&&H==="GET"){G=r(G,O.data);}if(O.data&&H==="POST"){O.headers=d.merge({"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},O.headers);}if(F.t){return d.io.xdr(G,F,O);}if(!S){F.c.onreadystatechange=function(){C(F,O);};}try{F.c.open(H,G,S?false:true);if(O.xdr&&O.xdr.credentials){F.c.withCredentials=true;}}catch(P){if(O.xdr){return a(F,R,O,J);}}c(F.c,O.headers);u(F.id,O);try{F.c.send(O.data||"");if(S){M=F.c;Q=["status","statusText","responseText","responseXML"];w=O.arguments?{id:F.id,arguments:O.arguments}:{id:F.id};for(I=0;I<4;I++){w[Q[I]]=F.c[Q[I]];}w.getAllResponseHeaders=function(){return M.getAllResponseHeaders();};w.getResponseHeader=function(T){return M.getResponseHeader(T);};g(F,O);B(F,O);return w;}}catch(N){if(O.xdr){return a(F,R,O,J);}}if(O.timeout){s(F,O.timeout);}return{id:F.id,abort:function(){return F.c?n(F,"abort"):false;},isInProgress:function(){return F.c?F.c.readyState!==4&&F.c.readyState!==0:false;}};}A.start=u;A.complete=g;A.success=t;A.failure=h;A.end=j;A._id=e;A._timeout=z;A.header=v;d.io=A;d.io.http=A;},"@VERSION@",{requires:["event-custom-base","querystring-stringify-simple"]});YUI.add("contacts-smartcontacts-api",function(A){api={deleteSmartContacts:function(G,F,E){F=F||NeoConfig.socdirProxyPath;E=E||A.io;if(A.Lang.isArray(G)&&G.length>0){var C=G.length,D={ydht:{fields:{}}},B=D.ydht.fields;while(C--){B[G[C]]={"value":[0,null,-65536,1,1]};}E(F+"?/setSmartContacts?",{method:"POST",data:A.JSON.stringify(D)});}}};A.namespace("contacts.smartcontacts");A.contacts.smartcontacts.api=api;},"1.0.0",{requires:["io-base"]});YUI.add("ac-widget",function(F){var D=F.Lang,A=F.contacts,H=A.api,E=A.utils,G=F.comms;function C(I){var K=D.isUndefined,L=this,J;I.ac=L._getEventPlugin(I);tplWithDelete='<li role="option" ><span class="ac-value">{{hilite}}</span><span title="{{str_ac_remove_item}}" data-action="ac-remove-item" data-ac-sc={{isSmartContact}} data-ac-email-field-id="{{emailFieldId}}" data-ac-id="{{id}}" data-ac-email="{{email}}" class="ac-remove-item">X{{str_ac_remove_item}}</span></li>';tplNoDelete='<li role="option" ><span class="ac-value">{{hilite}}</span></li>';if(I.ac){C.superclass.constructor.apply(L,[I]);}L.set("itemTplNoDelete",tplNoDelete);L.set("itemTplWithDelete",tplNoDelete);}C.NAME="ACWidget";function B(){var I=arguments;F.use("rocket-stats",function(){F.common.Utils.rocketstats.stat.apply(0,I);});}F.extend(C,G.ui.AutoComplete,{bindUI:function(I){var J=this;C.superclass.bindUI.apply(J,arguments);},_getEventPlugin:function(I){var J=false,K=D.isUndefined;if(!K(I.acNode)&&!K(I.acTarget)){J=I.acTarget.plug(G.ui.AutoCompleteEventsPlugin,{alignNode:I.acNode}).ac;}return J;},refresh:function(I){var K=this,J=false;J=K._getEventPlugin(I);if(J){I.ac=J;return K.setAttrs(I);}return K;},getItemMarkup:function(L){var I=this,K=I.updateHighlighting(L),J;if(L.isCategory){J=F.common.Utils.substitute(I.get("itemTplNoDelete"),{hilite:K},0,0,0,0,strings);}else{J=F.common.Utils.substitute(I.get("itemTplWithDelete"),{hilite:K,id:L.id,email:L.email,emailFieldId:L.emailField.id,isSmartContact:L.isSmartContact||0},0,0,0,0,strings);}return J;},buildName:function(M,K,L,I){if(M||K||L){var J=F.common.Utils.substitute(strings["str_name_format"],{given_name:M?M:"",middle_name:K?K:"",family_name:L?L:""});J=J.replace(/ +(?= )/g,"");if(I&&NeoConfig.intl==="jp"){J=J+" ("+strings.str_form_lbl_nickname+I+")";}}else{if(I){J=I;}else{J="";}}return J;},updateHighlighting:function(U){var K=U.matches,b=this;if(K&&(K.nickname||K.user||K.firstname||K.lastname||K.mobileno||K.homeno||K.workno||K.email)){var i=F.Lang.isArray(K.nickname)&&K.nickname.length>0?true:false,S=F.Lang.isArray(K.firstname)&&K.firstname.length>0?true:false,L=F.Lang.isArray(K.lastname)&&K.lastname.length>0?true:false,V=F.Lang.isArray(K.mobileno)&&K.mobileno.length>0?true:false,g=F.Lang.isArray(K.homeno)&&K.homeno.length>0?true:false,M=F.Lang.isArray(K.workno)&&K.workno.length>0?true:false,N=F.Lang.isArray(K.email)&&K.email.length>0?true:false;var m=U.user||null,d=U.nickname||null,h=U.firstname||null,P=U.lastname||null,W=U.mobileno||null,R=U.homeno||null,Q=U.workno||null,Z=U.email||null,k=U.sc_score;var j=i?b._hlMatch(d,K.nickname):(d&&d.length>0?d:null),J=S?b._hlMatch(h,K.firstname):(h&&h.length>0?h:null),e=L?b._hlMatch(P,K.lastname):(P&&P.length>0?P:null),T=V?b._hlMatch(W,K.mobileno):null,c=g?b._hlMatch(R,K.homeno):null,I=M?b._hlMatch(Q,K.workno):null,f=N?b._hlMatch(Z,K.email):null;var a,l,X,Y;l="";l=b.buildName(J,"",e,j);j=i?j:null;J=S?J:null;e=L?e:null;X="";if(f){X+=f;}else{X+=Z;}a=l||"";a=F.Lang.trim(a);if(a!=""){if(NeoConfig.bidi){Y=F.Intl.detectDirection(a.replace(/<\/?b\>/,""));a="<span dir="+Y+">"+a+"</span>";}else{a="<span>"+a+"</span>";}}if(X.length>0){if(a.length>0){a+=" ";}if(a==""){a+="<em class='email no-name' dir='ltr'>"+X+"</em>";}else{a+="<em class='email' dir='ltr'>("+X+")</em>";}}}function O(r,q,o,p,n){switch(q){case"amp":if(o){return"&"+o+";";}else{return"&";}case"#39":return"'";case"quot":return'"';case"lt":return"<";case"gt":return">";case"#35":return"#";default:return"";}}a=a.replace(/&((?:[a-zA-Z]+)|(?:#[0-9]+));(?:([a-zA-Z]+|(?:#[0-9]+));)?|([;,])/gi,O);if(NeoConfig.smartcomplete_enabled=="debug"){if(F.UA["gecko"]){a+='<span style = "float:right; margin-top: -15px; color:red;">'+k.toFixed(6);+"</span>";}else{a+='<span style = "float:right; color:red;">'+k.toFixed(6);+"</span>";}}return a;},_hlMatch:function(I,N){var O=I;var K,M,J,P,L;N.sort(this._sortMatches);M=O.length;for(K=N.length-1;K>=0;K--){J=N[K];if(NeoConfig.bidi){P=O.substring(0,J.startIndex);L=O.substring(J.endIndex,M)+O.substring(M);O=P+F.comms.Intl.highlightString(O.substring(J.startIndex,J.endIndex),P,L)+L;}else{O=O.substring(0,J.startIndex)+this.hlFn(O.substring(J.startIndex,J.endIndex))+O.substring(J.endIndex,M)+O.substring(M);}M=J.startIndex;}O=O.substring(0,M)+O.substring(M);return O;},hlFn:function(I){return"<b>"+I+"</b>";},_sortMatches:function(J,I){if(typeof J==="object"&&typeof I==="object"&&typeof J.startIndex==="number"&&typeof I.startIndex==="number"){return +(J.startIndex-I.startIndex);}else{return 0;}},click:function(L){var P=this,O=P.get("ac");L.halt();if(L.target.hasClass("ac-remove-item")){var K=L.target,Q=parseInt(K.getAttribute("data-ac-sc"),10),I=K.getAttribute("data-ac-id"),N=K.getAttribute("data-ac-email-field-id"),M=K.getAttribute("data-ac-email");F.use("common-ui-dialog-helper","_shared_module_offscreen_bin_modal_btn_generic",function(V){var W=V.common.Utils.substitute(V.ui.Templates._shared_module_offscreen_bin_modal_btn_generic.base,0,0,0,{btnID:"ok",btnLabel:strings.str_ok}),S=V.common.Utils.substitute(V.ui.Templates._shared_module_offscreen_bin_modal_btn_generic.base,0,0,0,{btnID:"cancel","default":"default",btnLabel:strings.str_btn_cancel}),U={hd:strings.str_address_remove,bd:V.common.Utils.substitute(Q?strings.str_sc_remove:strings.str_contacts_remove,{name:name}),ft:W+S},T={ok:{handler:function(){V.contacts.smartcontacts.api.deleteSmartContacts([M]);var X=new G.FilterContacts();V.contacts.api.removeEmail(I,parseInt(N),X.buildContactsIndex);O.set("queryValue","");B("autocomplete-delete",Q?"smartContact":"ABContact");}},cancel:{handler:function(){}}},R=function(X){};V.common.ui.DialogHelper.createCommon(U,T,R);});}else{var J=L.currentTarget.one(".ac-value").get("text");O.set("queryValue",J);P["_selectedIndex"]=-1;O.get("host").simulate("keydown",{keyCode:13});P._currentValue=J;O.get("host").focus();}P.hide();},handleEnter:function(O,J){var M=J.get("ac"),I=J["_selectedIndex"],L,P;O.halt();var K=new G.FilterContacts();if(J.get("data").queryStr!=M.get("queryValue")){K.updateFilterItems(M.get("queryValue"));
var N=K.filterContacts(E.getSortedFlatContacts(["firstname","lastname","email"]));J.setAttrs({query:M.get("queryValue"),data:N}).drawMarkUp().setAlign().show();}if(I!=-1){L=J.item(I);if(L){P=L.one(".ac-value").get("text");M.set("queryValue",P);}J["_selectedIndex"]=-1;M.get("host").focus();J.hide();}}});F.namespace("contacts.ui");F.contacts.ui.ACWidget=C;},"1.0.0",{requires:["overlay","node-event-simulate","comms-ui-autocomplete-plugin","comms-ui-autocomplete","contacts-api-utils","contacts-api","filter-contacts","common-utils","comms-intl-bidihighlight","contacts-smartcontacts-api"]});YUI.add("mail-controller-compose-text",function(A){A.namespace("mail.Controller");var J=A.common.Utils,B=A.common.persist.UserData,P={address:1,blockquote:1,body:1,caption:1,center:1,col:1,colgroup:1,dd:1,dir:1,div:1,dl:1,dt:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,li:1,menu:1,ol:1,p:1,pre:1,table:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1,ul:1};function C(S,T){var U=S.cloneNode(true),R=A.Node.getDOMNode(U),Q=F(R);if(T){Q=I(Q,true);}return Q;}function L(S,U){var Q=A.Node.create("<div>"+S+"</div>"),T=A.Node.getDOMNode(Q),R=F(T);if(U){R=I(R);}return R;}function F(R){var Q=A.UA.ie;if(!Q){K(R);}else{R.innerHTML=R.innerHTML.replace(/(((<div\s+[^>]*>)|(<div\s*>))&nbsp;<\/div>)/gi,"<BR/>");}return M(R,false,"").replace(/\n[\s\xA0]+$/,"");}function M(T,X,Y){if(T.nodeType===1||T.nodeType===11){var S=T.tagName;if(A.UA.ie&&T.tagName=="DIV"&&T.getAttribute("class")&&T.getAttribute("class")!=null&&T.getAttribute("class").indexOf("hr")!=-1){S="HR";}switch(S){case"SCRIPT":case"STYLE":case"LINK":case"OBJECT":case"EMBED":return"";case"HR":var a=T.previousSibling;return(G(a)?"":"\n")+Y+"________________________________\n"+Y;case"BR":return"\n"+Y;case"BLOCKQUOTE":Y+=">";default:var V=[];var Q=T.firstChild;var W=0;while(Q!==null){var Z=M(Q,Q.tagName==="PRE",Y);if(Q.nodeType===1){if(H(Q)==="block"&&V.length>0&&Q.tagName!=="TD"){var U=Z.match(/^[ \t\r\n\v\f]*$/);if(!U||Q.tagName==="LI"){V.push("\n"+Y);}}switch(Q.tagName){case"LI":W++;V.push("\t"+(Q.parentNode.tagName==="OL"?W+".":"*")+" ");break;}}if(Z){V.push(Z);}if(Q.nodeType===1){switch(Q.tagName){case"TD":V.push(" ");break;}}Q=Q.nextSibling;}return V.join("");}}else{if(T.nodeType===3){var V=T.nodeValue;if(!X){var a=T.previousSibling;var R=a?H(a):null;V=G(a)?V:V.replace(/\n[ \t\r\n\v\f]+/g," ");if(a===null||G(a)){V=V.replace(/^[ \t\r\n\v\f]+/,"");}else{if(R==="block"){V=V.replace(/^[ \t\r\n\v\f]+/,"\n");}else{if(R==="inline"){V=V.replace(/^[ \t\r\n\v\f]+/," ");}}}V=V.replace(/[ \t\r\n\v\f]+$/," ");}return V;}else{return"";}}}function G(Q){if(Q===null||Q.nodeType!==1){return false;}return Q.tagName==="BR";}function H(Q){if(Q===null||Q.nodeType!==1){return null;}if(Q.style.display){if(Q.style.display==="block"){return"block";}else{if(Q.style.display==="inline"){return"inline";}}}return P[Q.tagName.toLowerCase()]?"block":"inline";}function K(T){if(T.nodeType===1||T.nodeType===11){var R=T.firstChild;while(R!==null){var V=R.nextSibling;K(R);R=V;}}else{if(T.nodeType===3){var S=T.nodeValue;if(S.match(/^[ \t\r\n\v\f]*$/)){var Q=T.previousSibling;var U=Q?H(Q):"inline";if(U==="inline"&&!G(Q)){T.nodeValue=T.nodeValue.replace(/\n.*/," ");}else{T.parentNode.removeChild(T);}}}}}function I(R,Q){R=J.escapeHtml(R);R=O(R);if(Q){R=R.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;");R=R.replace(/( ){2}/g,"&nbsp;&nbsp;");}R=R.replace(/\n/ig,"<br />");return R;}function O(R){R=R.replace(/(https?:\/\/[^\s<]+)/ig,"<a target='_blank' href=''>$1</oa>");R=R.replace(/([^\/])(www\.(\w+\.)+[^\s<]+)/ig,"$1<a target='_blank' href='http://'>$2</oa>");R=R.replace(/^(www\.(\w+\.)+[^\s<]+)/ig,"<a target='_blank' href='http://'>$1</oa>");R=R.replace(/((&lt;|&gt;|[^A-Za-z0-9#_\/]){1,10})<\/oa>/g,"</oa>$1");var Q;try{Q=new RegExp("'>([^<]+?)</oa>","g");}catch(S){Q=new RegExp("'>([^<]+)","g");}R=R.replace(Q,"$1'>$1</a>");return R;}function D(W,S,U){var T,Q,V=U&&U.isRich,R,X=U&&U.text;if(!X){return"";}X=N(X,V);if(!V){X=E(X);}else{if(!S){try{R="<br>";X=X.replace(/((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))/gi,R);X=X.replace(/((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))/gi,R);X=X.replace(/((<p\s+[^>]*>)|(<p\s*>)&nbsp;<\/p>)/gi,R);X=X.replace(/(((<div\s+[^>]*>)|(<div\s*>))&nbsp;<\/div>)/gi,R);X=X.replace(/(<br\s+[^>]*>)|(<br\s*>)/gi,R);X=X.replace(/(<br\/\s+[^>]*>)|(<br\/\s*>)/gi,R);X=X.replace(/(<p\s+[^>]*>)|(<p\s*>)/gi,"");X=X.replace(/<\/p>/gi,R);X=X.replace(/(<hr\s*>)/gi,R+"________________________________"+R);X=L(X,true);}catch(T){}}}W=W||"";Q=W!="";if(X!=""){if(A.UA.ie||A.UA.webkit){if(Q){W=W+"<div></div><div>&nbsp;</div>"+X;}else{W="<div></div><div>&nbsp;</div>"+X+W;}}else{if(Q){W=W+"<div>&nbsp;</div>"+X;}else{W="<div>&nbsp;</div>"+X+W;}}}return W;}function N(R,Q){if(R!=null){if(!Q){return R.replace(/<vbr>|\n/gi,"<br />");}else{R=R.replace(/<vbr>/gi,"");}}return R||"";}function E(S){var R,Q;S=A.common.Utils.unescapeHtml(S);S=S.replace(/<hr\s*[^>]*>/gi,"<div><hr></div>");S=S.replace(/((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))/gi,"endptagpblanklineppblanklinepstartptag");S=S.replace(/((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))/gi,"endptagpblanklinepstartptag");S=S.replace(/((<p\s+[^>]*>)|(<p\s*>)&nbsp;<\/p>)/gi,"endptagpblanklinepstartptag");S=S.replace(/(((<div\s+[^>]*>)|(<div\s*>))&nbsp;<\/div>)/gi,"endptagpblanklinepstartptag");S=S.replace(/(<br\s+[^>]*>)|(<br\s*>)/gi,"brtag");S=S.replace(/(<br\/\s+[^>]*>)|(<br\/\s*>)/gi,"brtag");S=S.replace(/(<p\s+[^>]*>)|(<p\s*>)/gi,"startptag");S=S.replace(/(<p\s+[^>]*>)|(<p\s*>)/gi,"startptag");S=S.replace(/<\/p>/gi,"endptag");R=S.replace(/<div\s+[^>]*dir\s*=\s*[\'|\"]ltr[\'|\"]\s*[^>]*>/gi,"ltrstartptag");R=R.replace(/<div\s+[^>]*dir\s*=\s*[\'|\"]rtl[\'|\"]\s*[^>]*>/gi,"rtlstartptag");R=R.replace(/(<div\s+[^>]*>)|(<div\s*>)/gi,"startptag");S=R.replace(/<\/div>/gi,"endptag");Q=A.common.Utils.escapeHtml(S);Q=Q.replace(/brtag/g,"<br />");Q=Q.replace(/ltrstartptag/g,"<div dir='ltr'>");Q=Q.replace(/rtlstartptag/g,"<div dir='rtl'>");Q=Q.replace(/startptag/g,"<div>");Q=Q.replace(/endptag/g,"</div>");Q=Q.replace(/pblanklinep/g,"<br/><br/>");return Q;}A.mix(A.mail.Controller.Compose,{convertToPlain:C,convertHTMLToPlain:L,convertGuts:F,injectSignature:D});},"1.0.0",{requires:["common-persist-user-data","mail-controller-compose"]});YUI.add("mail-ui-mailcompose-base-header",function(F){var AH=F.common.Utils.substitute,B=F.Lang.trim,P=F.Node.create,L=F.mail.Controller.Compose,N=F.common.persist.UserData,AB=F.mail.persist.MetaData,p=F.common.Utils,v=F.mail.ui.PaneUtils,AH=p.substitute,i=p.escapeHtml,k=p.unescapeHtml,J=strings.str_cfg_tog_unescape_ncr,W=F.ui.Templates,b=W._shared_module_compose_message_header&&W._shared_module_compose_message_header.compose_from_address,y=F.contacts,u=y.api,D=y.utils,f="neo.pref.compose.showBcc",x="hidden",AC="focus",K="offscreen",AE="restore",n="move",S="reply_all",Q="reply_sender";var z=function(Y,AI){var AJ=this;AJ.isLozengeHighlighted=false;AJ.allLozengesSelected=false;AJ.composeView=AI;};function G(){}function q(){var AO={},AP=(N.get("externalAccounts")||{}).extAccount||[],AI=(N.get("aliases")||{}).alias||[],Y=(N.get("disposableAddresses")||{}).deaName||[],AN=AP.concat(AI,Y),AL=N.get("userSendPref"),AJ,AK,AM=AN.length;AO[AL.defaultID]=1;AO[AL.defaultFromAddress]=1;for(AK=0;AK<AM;AK++){if((AJ=AN[AK].address)){AO[AJ]=1;}}return AO;}function m(){if(F.ACWidgetInst){F.ACWidgetInst.hide();}}function r(Y){Y.removeAttribute("aria-owns");Y.removeAttribute("aria-activedescendant");}function Z(Y){Y.removeAttribute("aria-describedby");}function AG(){var Y=F.ACWidgetInst;Y.get("ac").get("host").set("aria-owns",Y.get("contentBox").generateID());}function V(Y){var AK=Y.ancestor("ul"),AJ=AK.all(".lozenge-static"),AI;if(AJ.size()>0){AI=[];AJ.each(function(AL){AI.push(AL.generateID());});}if(AI){Y.set("aria-describedby",AI.join(" "));}else{Y.removeAttribute("aria-describedby");}}function X(AJ){var AI=AJ.get("value"),AM=AI.length,AL=parseInt(AJ.ancestor(".ac-input").getStyle("width"),10)-40,AK=150,Y=17;if(AM>Y){AK+=(AM-Y)*10;if(AK>AL){AK=AL;}AJ.setStyle("width",AK+"px");}else{AJ.setStyle("width","");}}function e(AN){var Y=false,AJ=null,AI=null,AL=/(<[^<>]+@[^<>]+\.[^<>]+>)|(\([^\(\)]+@[^\(\)]+\.[^\(\)]+\))|(\[[^\[\]]+@[^\[\]]+\.[^\[\]]+\])/,AM,AK=AN.replace(/\".*\"/g,"");if(!B(AK)||AK.indexOf("@")<0){return{fail:true,email:AN,name:AN};}if(AL.test(AN)){AM=AN.match(AL);AI=AM[0];AJ=B(AN.replace(AI,""));AI=AI.substring(1,AI.length-1);}else{AI=AJ=B(AN);}if(!F.comms.Utils.isValidEmail(AI)){Y=true;}return{fail:Y,email:AI,name:AJ};}function d(AI){var AN=0,AK=0,AJ=AI.length,Y=[],AM=false,AO=false;for(AK=0;AK!=AJ;AK++){var AL=AI.charAt(AK);switch(AL){case'"':AM=!AM;break;case"&":AO=true;break;case";":if(AO){AO=false;break;}case",":if(!AM){Y.push(AI.slice(AN,AK));AN=AK+1;}}}if(AN!=AK){Y.push(AI.slice(AN,AK));}return Y;}function o(Y){var AK=this,AJ=Y.ancestor("ul"),AI=AJ.all(".hLozenge");if(AI){r(Y);Z(Y);AI.remove();}}function E(){var AI=this,Y;if(!AI.isLozengeHighlighted){return;}Y=AI.composeView.baseNode.all(".hLozenge.focus");Y.removeClass(AC);r(F.all("#to-field, #cc-field, #bcc-field"));AI.allLozengesSelected=false;AI.isLozengeHighlighted=false;}function l(AI,Y){var AK=this;AK._removeLozengeHighlights();AI.toggleClass(AC);AK.isLozengeHighlighted=true;var AJ=AI.one(".lozenge-static").generateID();Y.setAttrs({"aria-owns":AJ,"aria-activedescendant":AJ});if(!F.UA.ie&&AK.composeView.type=="fullCompose"){AI.scrollIntoView();}}function a(Y){var AK=this,AJ=Y.ancestor("ul"),AI=AJ.all(".hLozenge");if(AI){AI.addClass(AC);AK.isLozengeHighlighted=true;}AK.allLozengesSelected=true;}function T(Y){var AL=this,AJ,AI,AK;AJ=Y.ancestor();AI=B(Y.get("value"));if(!B(AI)){Y.set("value","");return;}if(AI&&AI.indexOf('"')>-1){AK=d(AI);}else{if(AI.lastIndexOf(",")===(AI.length-1)){AI=AI.substring(0,AI.length-1);}AK=AI.split(/[;,]+/);}AL._makeLozenges(AK,AJ);V(Y);Y.set("value","");}function h(AN,AL){var AO=this,AI,Y=AN.length,AJ,AM,AK;for(AI=0;AI<Y;AI++){AJ=AN[AI];B(AJ);if(AJ){AM=e(AJ);AK=AO._createLozenge(AM);AL.insert(AK,AL);AO.composeView._setDirty();}}}function s(AL){var AO,AK;if(!AL){return null;}AL.name=AL.name||AL.email;if(strings.str_cfg_tog_compose_enable_nickname){var Y=D.getContactsByEmail(AL.email),AJ;if(Y){AJ=D.getFirstFieldValue(Y[0],"nickname");if(AJ){AL.isNN=true;AL.name=AJ;}}}if(!AO){AO={email:AL.email,firstName:AL.name||AL.email};}if(AL.fail){AK=strings.str_comp_error_email_lozenge_attr;}else{AK=AL.email;}var AI,AN={label:k(AL.name),hover:k(AK),state:AL.fail?"error":"normal",data:AL,menu:null,edit:true,copy:true};AI=new F.comms.ui.Lozenge(AN);var AM=AI.getNode();AM.set("role","presentation");return AM;}function O(AN){var AO=AN.getData("lozenge");var AK=AO.data;var AM=AO.error;if(strings.str_cfg_tog_compose_enable_nickname){if(AK.name&&AK.isNN){var AJ=F.contacts.utils,AI=AJ.getContactsByEmail(AK.email),AL,Y;AL=AJ.getFirstFieldValue(AI[0],"name");Y=AL?(AL.familyName+" "+AL.givenName):"";AK.name=Y;}}if(AM){this.currentAddress=AK.email;this.validAddress=false;}else{this[this.currentField].push(AK);}}function c(){var AQ=this,AL={to:[],cc:[],bcc:[],validAddress:true,currentAddress:"",currentField:""},AO,AS,AT,AN,AU,AR,AJ,Y,AI,AP,AM,AK;AO=AQ.composeView.baseNode.one(".cm-to.ac-input").all(".hLozenge");AL.currentField="to";AO.each(O,AL);AS=AQ.composeView.baseNode.one(".cm-cc.ac-input").all(".hLozenge");AL.currentField="cc";AS.each(O,AL);AT=AQ.composeView.baseNode.one(".cm-bcc.ac-input").all(".hLozenge");AL.currentField="bcc";AT.each(O,AL);AU=((N.get("externalAccounts")||{}).extAccount||[]).length;AR=((N.get("aliases")||{}).alias||[]).length;AJ=((N.get("disposableAddresses")||{}).deaName||[]).length;if((AU>0)||(AR>0)||(AJ>0)){Y=AQ.composeView.baseNode.one(".from-select").get("value");AI=Y.lastIndexOf("<");AP=Y.lastIndexOf(">");AM=Y.substring(AI+1,AP);AK=Y.substring(0,AI-1);AL.from={email:AM,name:AK};}else{AL.from={email:N.get("userSendPref.defaultFromAddress"),name:N.get("userSendPref.defaultFromName")};}AN=AQ.composeView.baseNode.one(".cm-subject-field");if(AN){AL.subj=AN.get("value");}else{AL.subj=AQ.composeView.cdo.get("header").subject;}return AL;}function g(AQ){var AM=this,AK=AM.composeView,AJ,AS,AR,AP=AK.type=="inlineCompose"?AK.baseNode.one(".thread-recipients"):null,AN="",Y=[],AL={to:{list:AQ.to,node:".cm-to-field"},cc:{list:AQ.cc,node:".cm-cc-field"},bcc:{list:AQ.bcc,node:".cm-bcc-field"}},AO=function(AT){var AU={to:v.getConvName(AT),email:v.getAddress(AT)};
return AU;};function AI(AV,AW){var AU=AK.baseNode.one(AW),AT=AU.ancestor("li");if(AP&&AW!=".cm-bcc-field"){Y=Y.concat(AV);}F.Array.each(AV,function(AX){AJ=AM._createLozenge({name:AX.name,email:AX.email});AT.insert(AJ,AT);AK._setDirty();});V(AU);}for(AR in AL){if(AL[AR].list){AI(AL[AR].list,AL[AR].node);}}if(AP){AN=v.createRecipientList(Y,W._shared_module_thread_thread_display_rollup.recipients1,null,null,AO);AP.setContent(AN);}if(AL.cc.list&&AL.cc.list.length!=0){AM._ccSwitch(true,false);}if(AL.bcc.list&&AL.bcc.list.length!=0){AM._bccSwitch(true,false);}if(AK.type=="fullCompose"){if(AQ.from){AM._setFromMenu(AQ.from);}if(AQ.subject){AK.baseNode.one(".cm-subject-field").set("value",AQ.subject);AK._setDirty();}}}function R(AI){var AK=this,Y=AK.composeView.baseNode.all("div.ac-input input"),AJ=AK.composeView.baseNode.all("div.subject input");if(AI){Y.removeAttribute("readOnly");AJ.removeAttribute("readOnly");}else{Y.setAttribute("readOnly",true);AJ.setAttribute("readOnly",true);}}function t(AI){var AJ=this,Y=AI.name+" "+"<"+AI.email+">";AJ.composeView.baseNode.one(".from-select").set("value",Y);}function AD(Y,AR,AM,AT){var AL=this,AP,AJ,AK,AQ=strings.str_tog_loadRTLCss?"rtl":"ltr",AU,AI=AM.fromNameDir||AQ,AS,AN=AM.fromName||"",AO=AM.address||"";if(!AN&&strings.str_cfg_tog_use_default_fromname){AN=AT;}if(NeoConfig.bidi){AS=(AI==="rtl"?"\u202B":"\u202A")+AN+"\u202C";AU=(AQ==="rtl"?"\u202B":"\u202A")+"\u200E&lt;"+AO+"&gt;\u200E\u202C";AK=i(AS)+" "+AU;}else{AK=i(AN,J)+" &lt;"+AO+"&gt;";}if(AO){AP=AH(b,{isDefault:AM.isDefault,address:AK},AL.composeView.formatters,null,strings);AJ=AP.toLowerCase();Y.push(AJ);AR[AJ]=AP;}}function AA(){var AX=this,AZ,AJ,Ac=[],Aa=(N.get("aliases")||{}).alias||[],AO=Aa.length,AN=N.get("userSendPref"),AI,Ad="",Y,AP,AY,AS=strings.str_tog_loadRTLCss?"rtl":"ltr",AT=N.get("externalAccounts")||{},AU=(N.get("disposableAddresses")||{}).deaName||[],AK=AU.length,AQ=AT.extAccount||[],Ab=AQ.length,AV=AX.composeView.baseNode.one(".from-select"),AL={},AR,AM;if(AN){Ad=AN.defaultFromName||"";if(NeoConfig.bidi){AP=AN.defaultFromNameDir||AS;Y=(AP==="rtl"?"\u202B":"\u202A")+Ad+"\u202C";AY=(AS==="rtl"?"\u202B":"\u202A")+"\u200E&lt;"+AN.defaultFromAddress+"&gt;\u200E\u202C";AI=i(Y)+" "+AY;}else{AI=i(Ad,J)+" "+"&lt;"+AN.defaultFromAddress+"&gt;";}AR=AH(b,{address:AI},AX.composeView.formatters,null,strings);AM=AR.toLowerCase();Ac.push(AM);AL[AM]=AR;}for(AZ=0;AZ<Ab;AZ++){AJ=AQ[AZ];if(AJ&&AJ.mailFromAllowed){AX._buildFromAccount(Ac,AL,AJ,Ad);}}for(AZ=0;AZ<AO;AZ++){AJ=Aa[AZ];if(AJ){AX._buildFromAccount(Ac,AL,AJ,Ad);}}for(AZ=0;AZ<AK;AZ++){AJ=AU[AZ];if(AJ&&(!strings.tog_check_active_compos||AJ.activeComposition)){AX._buildFromAccount(Ac,AL,AJ,AJ.address);}}if(Ac.length>(AN?1:0)){AX.composeView.baseNode.one("div.account-select").removeClass(x);}Ac=Ac.sort(function(Af,Ae){if(Af<Ae){return -1;}if(Af>Ae){return 1;}return 0;});var AW=[];for(AZ in Ac){AW.push(AL[Ac[AZ]]);}AV.setContent(AW.join(""));F.later(10,AX,function(Ae){if(Ae>-1){AV.set("selectedIndex",Ae);}},AV.all("option").indexOf(AV.one(".nsel")));}function w(){var Y=this;Y._bindUIHeader();if(Y.composeView.type=="fullCompose"){Y._buildFromMenu();}}function j(AI){var AJ=this,Y=AB.get(f);AJ._bccSwitch(Y,false);}function AF(Y){var AL=this,AK=AL.composeView.baseNode,AJ=AK.one(".cm-bcc.ac-input").all(".hLozenge"),AI=AK.one(".cm-bcc-field");if(Y||(AJ.isEmpty()&&AI.get("value").length==0)){AL._bccSwitch(Y);AB.set(f,Y);}else{AL.composeView.confirm(null,strings.str_comp_conf_bcc,function(){AJ.each(function(AM){AM.remove();AL.composeView._setDirty();});AI.set("value","");AL._bccSwitch(false);AB.set(f,false);});}AL.composeView._resizeRTE();}function C(AI,Y){var AL=this,AJ=AL.composeView.baseNode.one(".cm-btn-show-bcc"),AK=AL.composeView.baseNode.one(".cm-bcc-group");if(typeof Y=="undefined"){Y=true;}if(AI){AK.removeClass(x);AJ.addClass(x);Y&&AL.composeView.setFocus("bcc");}else{AK.addClass(x);AJ.removeClass(x);Y&&AL.composeView.setFocus("cc");}AL.composeView.attView.reposAttachObj(n);}function U(AL){var AJ={"to-field":".cm-to","cc-field":".cm-cc","bcc-field":".cm-bcc"},AM=this,AK=AL.get("id");if(AK&&AJ[AK]){AL.removeClass("whiteout");var AI=AM.composeView.baseNode.one(AJ[AK]);if(!F.ACWidgetInst){var Y=AH(W._shared_module_offscreen_bin_compose.base,{},null,null,strings,W);F.one(document.body).append(Y);F.ACWidgetInst=new F.contacts.ui.ACWidget({acNode:AI,acTarget:AL,contentBox:"#ac-to-results"}).setAlign().render();AM._setACWidgetARIAOwns();F.ACWidgetInst.after("visibleChange",function(AQ){var AP=this.get("ac").get("host"),AN=F.ACWidgetInst.get("contentBox").one("li"),AO=(AQ.newVal&&AN)?true:false;AP.set("aria-expanded",AO);if(!AO){AP.set("aria-activedescendant","");}});F.ACWidgetInst.after("selectedIndexChange",function(AO){var AN="";if(AO.newVal>-1){AN=this.get("contentBox").one(".yui3-acwidget-selected").generateID();}this.get("ac").get("host").set("aria-activedescendant",AN);});}else{if(F.ACWidgetInst.get("ac").get("alignNode")!==AI){F.ACWidgetInst.get("ac").destructor();F.ACWidgetInst.refresh({acNode:AI,acTarget:AL,width:AI.getStyle("width")}).setAlign().render();AM._setACWidgetARIAOwns();}}F.ACWidgetInst.get("ac").on("ac:query",function(AP){var AV=this,AO=AV.get("dataSource"),AR=AP.value,AT,AQ=this.get("badResult"),AU;if(AQ){var AS=new RegExp("^"+i(AQ),"gi");if(AP.value.match(AS)){this.fire("ac:load",{results:[],query:AP.value});return;}}if(D.areContactsLoaded()){var AN=new F.comms.FilterContacts();AN.updateFilterItems(AR);AT=AN.fastMatch();AT.queryStr=AR;AU=F.bind(AV.reload,AV,AT);AU(AT);}});F.on("contacts:contactChanged",function(){F.ACWidgetInst.get("ac").set("badResult",false);});}}function I(){var AQ=this,AI=AQ.composeView.baseNode.one("input.cm-subject-field"),AR=AQ.composeView.baseNode.one("div.compose-header")||AQ.composeView.baseNode.one(".thread-reply-to-edit"),AU,AN,Y,AS,AL,AJ,AO,AM,AP,AT,AK;F.on("lozenge:highlight",function(AV){AQ.isLozengeHighlighted=true;});if(NeoConfig.useDD&&AQ.composeView.type=="fullCompose"){F.use("common-ui-lozengeDD",function(AV){AV.Lang.later(0,0,function(){var AW=new AV.common.ui.lozengeDD({composeView:AQ.composeView});
});});}F.delegate("focus",function(AX){var AZ=this,AW=AX.target,AV=AX.currentTarget,AY=AV.ancestor("div.ac-input",false);if(AY){AY.addClass(AC);AY.get("parentNode").addClass("active");}AZ.composeView._registerFocus(AV);if(AW.get("nodeName")=="INPUT"){AZ._initAutoComplete(AW);}},AR,".cm-to-field,.cm-cc-field,.cm-bcc-field",AQ);F.delegate("focus",function(AV){var AW=AV.currentTarget.ancestor("div").one(".ac-input");if(AW){AQ.composeView.focusNode=AW.get("id");}},AR,".user-search a",AQ);AR.all("div.ac-input").on("blur",function(AV){AU=AV.currentTarget;if(AU&&!AQ.composeView.keepHdrFocus){AU.removeClass(AC);AU.get("parentNode").removeClass("active");}if(!(F.one("div.ac-results:hover")||F.one("div.ac-results li.over"))){m();AQ._lozengeIt(AV.currentTarget);}});if(AQ.composeView.type=="fullCompose"){AI.after("focus",function(){AI.ancestor("div").addClass(AC);AQ.composeView._registerFocus(AI);});AI.after("blur",function(){var AV=AQ.composeView.baseNode.one(".cm-subject-field"),AW=AQ.composeView.author;AI.ancestor("div").removeClass(AC);AQ.composeView.subjectTimer=F.later(1000,AQ,function(){if(AW){Y=B(AV.get("value"));if(Y){AW.updateTabTitle(i(k(Y)));if(NeoConfig.bidi){AW.updateTabDirection(AV.getStyle("direction"));}}else{AW.updateTabTitle(AQ.composeView.title);if(NeoConfig.bidi){AW.updateTabDirection("");}}}},[],false);});}AR.delegate("click",function(AX){AX.halt();AQ.composeView.attView.reposAttachObj(K);var AV={"to_add_contacts":".cm-to","cc_add_contacts":".cm-cc","bcc_add_contacts":".cm-bcc"},AW={wspath:NeoConfig.socdirProxyPath,guid:NeoConfig.neoguid,wssid:NeoConfig.wssid,requestFn:F.common.net.SessionMgr.requestProxy,selectAll:false,lookForSelect:true,lookForInput:true,onDone:function(Ab,Ac){var AY,Ad,Aa,AZ=Ac.one("a").get("id");allLozenges=AQ.composeView.baseNode.one(AV[AZ]).all("li"),hiddenLi=allLozenges.item(allLozenges.size()-1);for(AY in Ab){Ad={name:Ab[AY].name,email:k(Ab[AY].field.value)};Aa=AQ._createLozenge(Ad);AQ.composeView._setDirty();hiddenLi.insert(Aa,hiddenLi);}AQ.composeView.attView.reposAttachObj(AE);AQ.composeView._restoreFocus();},onCancel:function(){AQ.composeView.attView.reposAttachObj(AE);}};F.use("contacts-ui-choosecontactdialog",function(AY){if(!AQ.composeView.cancelDialogLoad){AY.fire("ccd:create",AW,AX.currentTarget);}});},".btn-kiosk-choosecontact");AR.delegate("click",function(AY){var AX=AY.target,AW=AY.currentTarget,Aa=AW.getElementsByTagName("INPUT"),AV=Aa.item(Aa.size()-1),AZ;if(AX.hasClass("lozenge-edit")){return;}AZ=AW.get("scrollTop");AV.focus();if(AX.hasClass("lozenge-static")||AX.hasClass("lozenge-edit")){AW.set("scrollTop",AZ);AV.addClass("whiteout");}else{AV.removeClass("whiteout");AQ._removeLozengeHighlights();AW.set("scrollTop",AW.get("scrollHeight"));}},"div.ac-input");AR.delegate("blur",function(AW){var AX=AW.currentTarget,AV=AQ.composeView.cdo;if(AX.get("id")=="subject-field"){var AY=AX.get("value");if(AY&&AY!=""){if(AV.oComposeData&&AV.oComposeData.header&&typeof AV.oComposeData.header.subj!="undefined"&&AV.oComposeData.header.subj!==AY){AQ.composeView._setDirty();}}return;}AW.halt();if(!(F.one("div.ac-results:hover")||F.one("div.ac-results li.over"))){m();AQ._lozengeIt(AX);}},"input.cm-to-field, input.cm-cc-field, input.cm-bcc-field, input.cm-subject-field");AR.delegate("keydown",function(A1){var AV=A1.target,Ap,A7,Ai,Ae=A1.keyCode,Ad=A1.shiftKey,Aj=A1.ctrlKey,An=A1.metaKey,Ac=A1.altKey,Az=(F.UA.os=="macintosh")?An:Aj,Av=null,AW=F.ACWidgetInst,AY,Ay,AX;if((Ae===83||(Ae===89&&Ad)||(Ae===85&&Ad))&&(Aj||An)){AQ.composeView.author?AQ.composeView.author.onKeyDown(A1):AQ.composeView.onKeyDown(A1);return;}else{if(AV.hasClass("cm-subject-field")){AX=(Aj||An)&&(!Ac&&!Ad)||Ae==9;if(!AX||(Az&&Ae==86)){AQ.composeView._setDirty();}if(Ae==9&&!Ad){AV.blur();AQ.composeView.setFocus("body");A1.halt();}return;}}var Ax,Au,Am,Ak,Al,Af,At,Ab=F.mail.ui.MessagePaneUtils,A2;function Aw(){var A8=AV,BA=AQ.composeView.baseNode.one(".compose-header"),A9="";BA.all("li.focus").each(function(BB){A9+=BB.one("input").get("value");A9+="; ";});if(A9!=""){A9=A9.substring(0,A9.length-1);Ab.initializeCopyText();Ab.copyToClipboard(A9,null,document.activeElement);}}switch(Ae){case 37:case 39:Ax=AV.ancestor("div");Am=Ax.one(".hLozenge.focus");Ay=AV.get("value");AY=AV.get("id");if(AY){A7={"to_add_contacts":"to","cc_add_contacts":"cc","btn-switch-reply-mode":AR.one("#to_add_contacts"),"bcc_show_btn":AR.one("#cc_add_contacts"),"bcc_add_contacts":"bcc","bcc_hide_btn":AR.one("#bcc_add_contacts")};Ai={"cc_add_contacts":AR.one("#bcc_show_btn"),"to_add_contacts":AR.one("#btn-switch-reply-mode"),"bcc_add_contacts":AR.one("#bcc_hide_btn"),"to-field":AR.one("#to_add_contacts"),"cc-field":AR.one("#cc_add_contacts"),"bcc-field":AR.one("#bcc_add_contacts")};if(AV.get("nodeName")==="A"||(!Ay&&!Am)||(Ay&&getCursorLocation(AV)===Ay.length)){Av=(Ae==37?A7[AY]:Ai[AY]);if(Av){AQ.composeView.setFocus(Av);return;}}}if(!AV.get("value")){A1.preventDefault();if(Am){if(Ae==37){Ak=Am.previous();}else{Ak=Am.next();if(!Ak.hasClass("hLozenge")){Ak=null;AQ._removeLozengeHighlights();AV.removeClass("whiteout");}}if(Ak){AQ._removeLozengeHighlights();AQ._selectSingleLozenge(Ak,AV);}}else{if(Ae==37){Au=AV.ancestor();Ak=Au.previous();if(Ak){AQ._removeLozengeHighlights();AQ._selectSingleLozenge(Ak,AV);AV.addClass("whiteout");}}}}break;case 8:case 46:if(!AV.get("value")){Au=AV.ancestor();Ax=AV.ancestor("div");Al=Ax.all(".hLozenge.focus");Af=Al.size();A1.halt();if(AQ.allLozengesSelected){AQ.removeAllLozenges(AV);AV.removeClass("whiteout");return;}if(Af){AQ.removeARIAFocus(AV);AQ.removeARIADescription(AV);if(Af==1){Am=Al.item(0);Ak=Am.next();if(Ak==Au){Ak=Am.previous();}if(Ak){AQ._selectSingleLozenge(Ak,AV);}else{AV.removeClass("whiteout");}}else{AV.removeClass("whiteout");}AQ.composeView._setDirty();Al.detachAll();Al.remove();Al=null;}else{if(Ae==8){Ak=Au.previous();if(Ak){AQ._removeLozengeHighlights();AQ._selectSingleLozenge(Ak,AV);AV.addClass("whiteout");}}}}break;case 13:if(AV.get("nodeName")==="A"||(Aj||An)){return;}var A4=new F.comms.FilterContacts();
if(AW&&AW.isVisible()&&AW.get("data").length>0){AW.handleEnter(A1,AW);}else{A4.updateFilterItems(AV.get("value"));var A5=A4.fastMatch();if(A5&&A5.length){var Ah=A5[0];AV.set("value",P(AW.getItemMarkup(Ah)).get("text"));}else{}}A1.halt();if(!AV.get("value")){A1.preventDefault();Ax=AV.ancestor("div");Am=Ax.one(".hLozenge.focus");if(Am){Am.getData("lozenge").startEdit();}return;}var Ar=A4.decodeCategory(AV.get("value"));if(Ar){function A0(BC,BB,A9,BA,A8){switch(BB){case"amp":if(A9){return A0(BC,A9,"",BA+5,A8);}return"&";case"#39":return"'";case"quot":return'"';case"lt":return"<";case"gt":return">";case"#35":return"#";default:return"";}}var A3,Aq=[];for(A3 in Ar){var A6=Ar[A3];if(A6){var Ag="",AZ=A6.firstname&&i(A6.firstname),As=A6.middlename&&i(A6.middlename),Aa=A6.lastname&&i(A6.lastname),Ao=A6.nickname&&i(A6.nickname);Ag=AW.buildName(AZ,As,Aa,Ao);Ag=Ag+"("+A6.email+")";Aq.push(Ag.replace(/&((?:[a-zA-Z]+)|(?:#[0-9]+));(?:([a-zA-Z]+|(?:#[0-9]+));)?|([;,])/gi,A0));}}AQ._makeLozenges(Aq,AV.ancestor());AQ.addARIADescription(AV);AV.set("value","");}else{AQ._lozengeIt(AV);}break;case 32:At=(A2=AW.get("data"))&&A2.length;if((Aj||An)||!AV.get("value")){return;}if(At>=2){return;}else{if(At==1){A1.halt();if(AW&&AW.isVisible()){AV.simulate("keydown",{keyCode:13});}}else{A1.halt();AQ._lozengeIt(AV);}}break;case 65:if((!Aj&&!An)||AV.get("value")){return;}A1.halt();AQ._selectAllLozenges(AV);AV.addClass("whiteout");break;case 38:break;case 9:if(!AV.get("value")&&!AW.isVisible()){return;}At=(A2=AW.get("data"))&&A2.length;if(!Aj&&!An&&!Ac){if(At>=1){A1.halt();}AQ.composeView.keepHdrFocus=true;AV.simulate("keydown",{keyCode:13});}break;case 67:if(Az){A1.stopPropagation();Aw();}break;case 86:if(Az){setTimeout(function(){AQ.updateTextField(AV);},0);}break;default:AV.removeClass("whiteout");if(!(Az||Ad)){AQ._removeLozengeHighlights();}break;}},".cm-to-field,.cm-cc-field,.cm-bcc-field,.cm-subject-field,a");AR.on("keyup",function(AY){var AZ=AY.target,AW=AZ.get("value"),AX=AW.length,AV=AW[AX-1];if(!(AZ.hasClass("cm-to-field")||AZ.hasClass("cm-cc-field")||AZ.hasClass("cm-bcc-field"))){return;}if(AX>0){AQ.composeView._setDirty();}if(AV===";"||AV===","){AY.halt();AW=B(AW);if(AW.length==1){AZ.set("value","");return;}if(!AW){return;}AQ._lozengeIt(AZ);}AQ.updateTextField(AZ);AQ.composeView.attView.reposAttachObj(n);});AR.delegate("change",function(){AQ.composeView._setDirty();},".cm-to-field,.cm-cc-field,.cm-bcc-field");}function H(Y,AI){var AJ=Y.action==S;if(AJ){AI.removeClass("ico-thread-reply");AI.addClass("ico-thread-reply-all");}else{AI.removeClass("ico-thread-reply-all");AI.addClass("ico-thread-reply");}}function M(){var AL=this,AP=AL.composeView.cdo.oComposeData.origin,Y=AL.composeView.baseNode,AI,AM=Y.one(".cm-to-field"),AO=Y.one(".cm-cc-field"),AK=Y.all(".replyall-toggle-btn a"),AJ=AP.action||0,AN;if(AJ!=S&&AJ!=Q){return;}if(AJ==S){AP.action=Q;AK.set("text",strings.str_comp_btn_reply_all);p.rocketstats.stat("SwitchReplyMode","Reply_To_Sender");}else{AP.action=S;AK.set("text",strings.str_comp_btn_reply_sender);p.rocketstats.stat("SwitchReplyMode","Reply_All");}if(AL.composeView.type=="inlineCompose"){H(AP,AK);}AL.removeAllLozenges(AM);AL.removeAllLozenges(AO);AN=L.getHeaderContent(AP);AI=Y.one(".cm-subject-field");if(AI){AN.subject=AI.get("value");}AL.setHeader(AN);AL.composeView._restoreFocus();}function A(){var AS=this,AW=AS.composeView.cdo.oComposeData.origin,AP=AW&&AW.oMsg&&AW.oMsg.header,AQ=AW&&AW.oMsg&&AW.oMsg.body,Y=AP&&((AP.to?AP.to.length:0)+(AP.cc?AP.cc.length:0))||0,AN=AW.action,AV,AU,AJ=1,AL=AS.composeView.baseNode,AK=AL.all(".replyall-toggle-btn"),AO,AI={},AX,AT,AM=1,AR;if(AW.fid=="Sent"&&AN==Q){AW.action=S;}if((AN!=S&&AN!=Q)||!AQ||!Y){return;}if(AP.replyto){AR=AP.replyto.length;for(AO=0;AO<AR;AO++){AI[AP.replyto[AO].email]=1;}}AX=AP.to.concat(AP.cc);AV=AS.getAllAccountEmails()||{};AR=AX.length;for(AO=0;AO<AR;AO++){AU=AX[AO].email||"";if(AT&&AU!=AT){AM=0;}AT=AU;if((AU in AV||AU in AI)){AJ=0;}else{AJ=1;}}if(AN&&AJ&&!AM&&AL.one(".replyall-toggle-btn")){AK.removeClass("hidden");if(AS.composeView.type=="inlineCompose"){H(AW,AL.all(".replyall-toggle-btn a"));}AL.delegate("click",M,".replyall-toggle-btn a",AS);}}F.mix(z.prototype,{NAME:"HeaderBase",render:w,getHeader:c,setHeader:g,enableHeader:R,getAllAccountEmails:q,allowEditing:j,_bindUIHeader:I,hideACWidget:m,_cmdBccSwitch:AF,_setFromMenu:t,removeAllLozenges:o,_removeLozengeHighlights:E,_createLozenge:s,enableSwitchReplyButton:A,switchReplyMode:M,_lozengeIt:T,_makeLozenges:h,_selectSingleLozenge:l,_selectAllLozenges:a,_tokenizeAddresses:d,removeARIAFocus:r,_setACWidgetARIAOwns:AG,removeARIADescription:Z,addARIADescription:V,updateTextField:X,_buildFromAccount:AD,_buildFromMenu:AA,createAddress:e,_initAutoComplete:U,_bccSwitch:C,_ccSwitch:function(){}});F.namespace("mail.compose");F.mail.compose.HeaderBase=z;},"1.0.0",{requires:["comms-ui-lozenge","ac-widget","_shared_module_offscreen_bin_compose","mail-controller-compose","mail-controller-compose-text","contacts-api","_shared_module_compose_message_header"]});YUI.add("mail-ui-mailcompose",function(D){var T=D.common.Utils.substitute,V=D.Lang.trim,L=D.Node.create,Z=D.mail.Controller.Compose,J=D.common.persist.UserData,E=D.common.Utils,I=D.ui.Templates;var W=function(Y,a,c,b){var d=this;d.header=new D.mail.compose.HeaderBase(Y,d);d.cdo=Y;d.isDraft=a;d.title=strings.str_tabs_compose;d.parent=null;d.baseNode=null;d.compArea=null;d.loadingArea=null;d.type="compose";d.dirty=false;d.focusNode=null;d.author=c;d.attachmentsLoading=[];d.attView=null;d.loadingTimer=null;d.allowEdit=false;d.allowSend=true;d.richFontInfo={fontFamily:null,fontSize:null};d.draftMID=null;d.saveTimer=null;d.subjectTimer=null;d.hasHardDraft=false;d.blockSave=false;d.lastSave=null;d.lastSaveType=null;d.isSending=false;d.isSaving=false;d.cancelDialogLoad=false;d.contentLoaded=false;d.stopwatch=b?b.stopwatch:null;d.suppressDialog=false;d.formatters={page_well_email:function(){return T(I._shared_module_rte_well_tabs_compose.base,{},d.wellTabFormatters,null,strings,I);},page_well_format:function(){return T(I._shared_module_rte_well_content_format.base,{},d.formatters,null,strings,I);},page_well_emoticons:function(){return T(I._shared_module_rte_well_content_emoticons.base,{},d.formatters,null,strings,I);},page_well_attachments:function(){return T(I._shared_module_rte_well_content_attachments.base,{},d.formatters,null,strings,I);},page_compose_email:function(){return T(I._shared_module_rte_well_content_format.page_compose_email,{},d.formatters,null,strings,I);},make_reply_all:function(){var g=d.cdo.oComposeData.origin,e=g.action,f={title:(e=="reply_all"||g.fid=="Sent")?strings.str_comp_btn_reply_sender:strings.str_comp_btn_reply_all};return((e!="reply_all"&&e!="reply_sender")?"":T(I._shared_module_compose_message_header.make_reply_all,f,0,0,strings));},spellCheckEnabled:function(){if(strings.str_tog_spellcheckEnabled){return T(I._shared_module_rte_well_content_format.spellCheckEnabled,{HiddenClassName:""},d.formatters,null,strings,I);}else{return T(I._shared_module_rte_well_content_format.spellCheckEnabled,{HiddenClassName:" hidden"},d.formatters,null,strings,I);}},is_rtl:function(){var e;if(NeoConfig.bidi){e=strings.str_tog_loadRTLCss?I._shared_module_rte_well_content_format.is_rtl:I._shared_module_rte_well_content_format.is_rtl_else;return T(e,{},d.formatters,null,strings,I);}else{return"";}},bidi:function(){if(NeoConfig.bidi){return T(I._shared_module_rte_well_content_format.bidi,{},d.formatters,null,strings,I);}else{return"";}},page_compose_conversation:function(){return"";},compose_from_address:function(){return T(I._shared_module_compose_message_header.compose_from_address,{},d.formatters,null,strings,I);},timestamp_id:function(){return(new Date()).getTime();},fromSelected:function(e){return(e.isDefault?' selected="selected" class="nsel"':"");},fromAddress:function(e){if(typeof e=="string"){return e;}else{if(typeof e=="object"&&typeof e.address=="string"){return e.address;}}return"";},global_path_img:function(){return NeoConfig.globalPathImg+"/u/assets/img";},display_av_logo:function(){return NeoConfig.avLogoUrl?T(I._shared_module_rte_well_content_file_count.display_av_logo,{},d.formatters,null,strings,I):"";},antivirus_logo_path_img:function(){return NeoConfig.avLogoUrl;},page_compose_email_else:function(){return"hidden";},intl_fonts:function(){function f(i,h){return T(I._shared_module_rte_well_content_format.intl_fonts,{},{font_value:function(){return i;},font_name:function(){return h;}},null,strings,I);}var e="";if(strings.str_cfg_intl_fonts){var g=D.JSON.parse(strings.str_cfg_intl_fonts);D.Array.each(g,function(h){e+=f(h.value,h.name);});}return e;}};SAVE_TIME_LIMIT=(NeoConfig.autoSaveInSec||120)*1000;W.superclass.constructor.call(d);d.cdo.after("saveactionChange",function(f){var e=f.newVal;if(e&&d.cdo){if(e.failure<0){d.saveFailure(e);}else{d.saveSuccess(e);}}});};function U(){var Y=this;W.superclass.ondestroy.call(this,arguments);}function K(){var Y=this;return Y.dirty;}function B(){var Y=this;return Y.draftMID==null?false:true;}function H(e,d,c,b,Y){var f=this,a=e?e:strings.str_comp_dialogheader;if(f.suppressDialog===true){c();return;}D.use("common-ui-dialog-helper",function(h){var g={hd:a,bd:d,suppressRestoreFocus:true};h.common.ui.DialogHelper.confirm(g,{ok:{text:Y,handler:c},cancel:{handler:function(){f._restoreFocus();if(b){b();}}}});});if(f.hiliteCP){f.hiliteCP.hide();}if(f.textCP){f.textCP.hide();}}function S(){var c=this,a=c.attachmentsLoading,Y,b;if(!a){return 0;}Y=a.length;for(b=0;b<Y;b++){if((a[b]*1)){return 1;}}return 0;}function R(Y){var a=this;a.focusNode=Y;if(a.author){a.author.set("focusNode",Y);}}function O(){var Y=this;Y.setFocus(Y.focusNode);}function X(){var Y=this;Y.dirty=true;if(!Y.saveTimer){Y.resetSaveTimer();}}function A(a){var Y=this;if(!a){a=SAVE_TIME_LIMIT;}if(Y.saveTimer){Y.saveTimer.cancel();}if(!NeoConfig.isAMT){Y.saveTimer=D.later(a,Y,function(){Y._invokeSaveDraft({auto:true});},[],false);}}function N(){var Y=this;if(Y.saveTimer){Y.saveTimer.cancel();Y.saveTimer=null;}}function P(a){var d=this,b,c={},Y;if(d.isSaving&&(!a||!a.forceOverwrite)){return;}else{if(!d.contentLoaded){return;}}a=a||{};if(!a.forceSave){if(a.auto&&(d.blockSave||!d.dirty)){d.resetSaveTimer();return;}}d.isSaving=true;d.blockSave=true;if(!a.retry){b=d.assembleSendBody(true);Y={header:d._getHeader(true),textcontent:b.text,content:b.html};d.cdo.updateData(Y);}a.auto?c.auto=true:"";c.cdo=d.cdo;c.author=d.author;c.mid=d.draftMID;c.saveBeforeSend=(a.saveBeforeSend?a.saveBeforeSend:false);Z.save(c);}function G(d){var f=this,b,c,a,Y,e;if(f.cdo==null){return;}b=f.cdo.get("attachments");d=d||{};if(f.dirty!=="ForceClose"&&!f.areAttachmentsPending()){f.dirty=false;}if(b){Y=b.length;for(e=0;e<Y;e++){c=b[e].original;if(c){c.mid=d.mid;c.fid="Draft";}}f.cdo.set("attachments",b);if(f.cdo.get("isRichText")){a=f.getRTEDocNode();a.all("img").each(function(g){var h=g.get("src");if(h.indexOf("ya/download")!=-1&&h.indexOf("fid=Draft")!=-1){h=h.replace(/mid=.*?([&'">])/,"mid="+encodeURIComponent(d.mid)+"$1");
g.set("src",h);}});}}f.lastSave=E.dateFormatter(new Date(),strings.str_tog_dateformat_rsstime_l10n);f.lastSaveType=d.auto?1:0;if(f.type==="inlineCompose"){f.updateSaveText();}else{if(f.author.get("active")){f.updateToolbar();}}f.draftMID=d.mid;d.auto?"":f.hasHardDraft=true;f.resetSaveTimer();f.blockSave=false;f.isSaving=false;f.fire("compose:saveSuccess");if(d.sendAfterSave){f._invokeSend(false,{keepDraft:true});}}function C(b,a){var c=this,Y=b?b:strings.str_comp_dialogheader;if(c.allowSend){D.use("common-ui-dialog-helper",function(f){c.allowSend=false;var e={hd:Y,bd:a,suppressRestoreFocus:true};var d=function(){c.allowSend=true;c._restoreFocus();};f.common.ui.DialogHelper.alert(e,{ok:{handler:d},cancel:{handler:d}});});}else{c._restoreFocus();}}function M(b){var c=this,Y=c.lastSaveType;b=b||{};c.lastSaveType=-1;c.blockSave=false;c.isSaving=false;if(Y!==-1){if(!b.mid){c.draftMID=null;c.hasHardDraft=false;}c._invokeSaveDraft({auto:b.auto,forceOverwrite:true,retry:true});return;}if(c.type==="inlineCompose"){c.updateSaveText();}else{if(c.author.get("active")){c.updateToolbar();}}if(!b.auto){var a=c.allowSend;c.allowSend=true;c._alertProblem(strings.str_comp_title_saveasdraftfail,strings.str_comp_saveasdraftfail);c.allowSend=a;}c.fire("compose:saveFail");}function Q(){var c=this,Y=c.richFontInfo,b=Y.fontFamily,a=Y.fontSize;if(!b){b=Z.getStyleFontFamily(false);}if(!a){a=Z.getStyleFontSize(false);}return{fontFamily:b,fontSize:a,foreColor:Y.foreColor,backColor:Y.backColor};}function F(Y){var e=this,d=e.baseNode.one(".attachment-button-attach");e.cancelDialogLoad=true;if(e.hiliteCP){e.hiliteCP.hide();}if(e.textCP){e.textCP.hide();}if(e.dirty==="ForceClose"){return true;}var b=e.isDirty()||(e.draftMID&&!e.hasHardDraft&&!Y),a=e.areAttachmentsPending();if(a){b=e.dirty=1;}if(b){var c='<span id="{{btnID}}ModalOverlay" class="btn left right {{default}}"><a href="#" data-action="{{btnID}}">{{btnLabel}}</a></span>';D.use("common-ui-dialog-helper",function(f){var n=T(c,{btnID:"SaveDraft","default":"default",btnLabel:strings.str_comp_savetodrafts}),i=T(c,{btnID:"DontSave",btnLabel:(a?strings.str_comp_closewithoutsaving:strings.str_comp_abandon)}),g=T(c,{btnID:"Continue","default":(a?"default":""),btnLabel:(a?strings.str_comp_returntomessage:strings.str_comp_keepwriting)}),l=n+i+g,m=(a?strings.str_comp_close_attachmentprocessing:strings.str_comp_close_confirm);if(a){l=g+i;}var h={modal_classes:"lg",hd:strings.str_comp_close,bd:m,ft:l,suppressRestoreFocus:true};var j={SaveDraft:{handler:function(){e._invokeSaveDraft();if(e.header){e.header.hideACWidget();}e.blockSave=true;e.dirty="ForceClose";var o=e.cdo.after("saveactionChange",function(p){o.detach();e.author.set("close",1);d.fire("compose:close");});}},DontSave:{handler:function(){if(e.header){e.header.hideACWidget();}e.blockSave=true;e.dirty="ForceClose";if(!e.hasHardDraft&&e.draftMID){f.use("mail-controller-messages-ops",function(o){o.mail.Controller.Messages.remove({fid:"Draft",mid:e.draftMID,force:true},{failure:function(){},success:function(){}});});}e.author.set("close",1,{noScroll:true});d.fire("compose:close");if(Y){Y();}}},Continue:{handler:function(){e._restoreFocus();e.blockSave=false;e.cancelDialogLoad=false;}}};var k=function(o){if(o){e.setFocus("to");}f.common.ui.DialogHelper.createCommon(h,j,function(p){p.set&&p.set("adAction","disableRetriggerOnOk");});};if(e.author.get("active")!==1){e.author.set("active",1,{noScroll:true,forceActive:true,cbk:function(){k(true);}});}else{k();}e.blockSave=true;});}else{d.fire("compose:close");}return !b;}D.extend(W,D.mail.ui.BaseWidget);D.mix(W.prototype,{NAME:"MailCompose",isDirty:K,_setDirty:X,_getHeader:function(){return this.header.getHeader();},_setHeader:function(Y){this.header.setHeader(Y);},isSaved:B,areAttachmentsPending:S,resetSaveTimer:A,canWeClose:F,getRichFontInfo:Q,saveSuccess:G,saveFailure:M,_alertProblem:C,_invokeSaveDraft:P,_cancelSaveTimer:N,confirm:H,_registerFocus:R,_restoreFocus:O,ondestroy:U},true);D.namespace("mail.ui");D.mail.ui.MailCompose=W;},"1.0.0",{requires:["autocomplete_css","common-persist-user-data","mail-persist-meta-data","_shared_module_compose_message_header","mail-controller-compose","mail-ui-mailcompose-base-header","rocket-stats","comms-utils"]});YUI.add("mail-ui-composeview-attach",function(C){C.namespace("mail");var Q={"application/pdf":"pdf","application/mspowerpoint":"ppt","application/vnd.ms-powerpoint":"ppt","application/excel":"xls","application/vnd.ms-excel":"xls","application/msword":"doc","application/vnd.ms-msword":"doc","application/x-trof-msvideo":"video","video/mpeg":"video","video/x-ms-wmv":"video","video/mov":"video","video/movie":"video","video/quicktime":"video","audio/wav":"music","audio/x-wav":"music","audio/mpeg":"music","audio/mp3":"music","audio/mid":"music","audio/realaudio":"music","audio/x-pn-realaudio":"music","image/bmp":"img","image/gif":"img","image/jpe":"img","image/jpeg":"img","image/jpg":"img","image/png":"img","image/tiff":"img","application/x-compressed":"zip","application/x-stuffit":"zip","application/x-tar":"zip","application/x-gzip":"zip"},N={"LOZENGE":0,"ICON":1},E=C.ui.Templates,D=C.common.Utils,W=D.substitute,S=D.escapeHtml,H=window.strings||{},V=C.common.persist.UserData,a=V.get("userFeaturePref.attachTotalSize"),R=V.get("userFeaturePref.attachFiles"),L=Math.round(a/1048576),b="hidden",K="attachmentVisible";function f(i,Y){Y=Y||"str_rte_attachments_";return H[Y+i]||"";}C.mail.AttachmentView=function(n,m,i){var j=this,l,o,p,k;j.cdo=n;if(!j.handles){j.handles=[];}handles=j.handles;j.tab=m;j.tagPane=i&&i.tagPane?i.tagPane:".attachments-pane";j.tagWell=i&&i.tagWell?i.tagWell:".attachments-well";j.uiAttBar=m.one(j.tagPane);if(j.uiAttBar){j.uiAttRemoveAll=j.uiAttBar.one(".attachment-button-removeall");j.uiAttCount=o=j.uiAttBar.one(".attachments-count");j.uiAttSize=p=j.uiAttBar.one(".attachments-size");j.uiAttAVLogo=j.uiAttBar.one(".file-count img");j.uiAttMessage=j.uiAttBar.one(".error");j.uiAttBtnForm=j.uiAttBar.one(".attachment-button-form")||null;j.uiAttBtnDisabled=j.uiAttBar.one(".attachment-button-disabled");}j.uiAttPane=m.one(j.tagWell);if(j.uiAttPane){j.uiAttList=k=j.uiAttPane.one(".file-attach");j.uiAttWelcome=j.uiAttPane.one(".attachments-welcome");}if(k&&o&&p){var Y=m.one("div.rte li.active a");k.setAttrs({"aria-labelledby":(Y?Y.generateID():""),"aria-describedby":(o.generateID()+" "+p.generateID())});}j.errorFlags={tooMany:false,tooBig:false};j.attachPaneHidden=true;j.attachXY=null;j.uploaderConfig={"attView":j,"tab":m,"cdo":n,"attForm":j.uiAttBtnForm,"attInput":j.tab.one(".attachment-button-file")};j.toggleUploaderHandle=C.on("compose:toggleUploaderType",F,j);C.mail.UploaderService.create(j.uploaderConfig,null,i?i.type:null);j.updateSizeAndCount();handles.push(j.cdo.on("CDO_ATTACHMENT_ADDED",function(r,q){j.addAttachment(q);j.updateSizeAndCount();}));handles.push(j.cdo.on("CDO_ATTACHMENT_DELETED",function(r,q){j.removeAttachment(q);j.updateSizeAndCount();}));handles.push(j.cdo.on("CDO_ATTACHMENT_PROCESSED",function(s,q){j.enableAttachment(q);j.updateSizeAndCount();function r(t){var u=t.state;return(u&&!u.processed&&!u.uploaded&&!u.cancelled);}if(!j.cdo._getAttachmentsCount(r)){j.checkOverLimit();}}));handles.push(j.cdo.on("CDO_ATTACHMENT_SIZE_VIOLATION",function(){j.attachError("size");}));handles.push(j.cdo.on("CDO_ATTACHMENT_COUNT_VIOLATION",function(){j.attachError("count");}));handles.push(j.cdo.on("CDO_ATTACHMENT_UPLOAD_PROGRESS",function(s,r,q){j.updateAttachmentProgress(r,q);}));handles.push(j.cdo.on("CDO_THUMBNAIL_GENERATED",function(t,q,s){var r=j.uiAttList.all(".file-container").item(q),u=r.one("div");if(!u){r.insert(C.Node.create("<div></div>"),0);u=r.one("div");}u.setStyle("background","url('"+s.src+"') no-repeat 0px "+((63-s.height)/2)+"px");r.ancestor("li").addClass("image");}));handles.push(j.cdo.on("CDO_UPLOADER_CLEANUP",function(){var q=j.cdo.get("attachments"),s,r;for(s=0;q&&s<q.length;s++){r=q[s];if(r&&r.timeout){clearTimeout(r.timeout);r.timeout=null;}if(r&&r.state&&!r.processed&&!r.state.cancelled){r.processed=true;r.state.failed=1;j.enableAttachment(s);}}j.updateSizeAndCount();}));if(j.uiAttRemoveAll){handles.push(j.uiAttRemoveAll.on("click",function(q){j.cdo._removeAllAttachments();q.preventDefault();}));}if(j.uiAttBtnDisabled){handles.push(j.uiAttBtnDisabled.on("click",function(){j.checkOverLimit(1);}));}if(j.uiAttAVLogo){handles.push(j.uiAttAVLogo.on("click",function(){C.fire("globalUltBeaconEvent",{action:"attch_upload_av_click"});window.open(NeoConfig.avTargetUrl);}));}};function T(Y){var i=this;if(Y=="icon"){i.iconType=N.ICON;i.uiAttList.addClass("icons");i.uiAttList.removeClass("lozenges");}else{i.iconType=N.LOZENGE;i.uiAttList.removeClass("icons");i.uiAttList.addClass("lozenges");}}function X(k,i){var n=this,m=C.mail.AttachmentView.attachErrorSize,j=i?C.all(".file-attach li").item(i):null,Y={"count":W(f("num_files_exceeded","str_comp_attach_"),{},{max_allowed:function(){return R;}}),"size":W(f("size_exceeded","str_comp_attach_"),{},{max_size_MB:function(){return L;}}),"averror":f("noAVScanWarning")+(j?j.get("title"):""),"virus":f("alert_virus")},l=Y[k];if(j){j.set("title",l||"");}n.updateSizeAndCount();if(k==="size"&&m&&m(n.cdo)){}else{if(l){C.use("common-ui-dialog-helper",function(o){o.common.ui.DialogHelper.alert({hd:(k=="virus")?f("alert_virus_title"):f("error","str_comp_attach_"),bd:l,restoreFocusNode:n.uiAttBar});});}}D.rocketstats.intlStat("ATTACH_ERROR",k);}function c(){if(this.cdo.get("inline_attachments")){this.cdo.set("inline_attachments",0);return;}var n=this,m=n.cdo._getAttachmentsCount(),Y=(m==1)?f("file_single"):W(f("num_files"),{},{file_attach_num_files:function(){return m;}}),r=n.cdo._getAttachmentsSize(),t=0,q=0,u,k,p,o,j,s=(m==1)?H["str_comp_remove"]:H["str_comp_removeall"];if(m){if(n.uiAttWelcome){n.uiAttWelcome.addClass(b);}n.uiAttList.removeClass(b);if(n.uiAttRemoveAll){n.uiAttRemoveAll.removeClass(b).one("a").setContent(s).set("title",s);}n.uiAttPane.removeClass(b);if(n.uiAttCount){n.uiAttCount.removeClass(b);}if(n.uiAttSize){n.uiAttSize.removeClass(b);}}else{n.uiAttList.addClass(b);if(n.uiAttRemoveAll){n.uiAttRemoveAll.addClass(b);}if(n.uiAttMessage){n.uiAttMessage.addClass(b);}n.uiAttPane.addClass(b);if(n.uiAttCount){n.uiAttCount.setContent("");
}if(n.uiAttSize){n.uiAttSize.setContent("");}n.toggleOverLimit(0);if(n.uiAttWelcome){n.uiAttWelcome.removeClass(b);}return;}if(n.uiAttCount){n.uiAttCount.setContent(Y);}if(n.uiAttSize){n.uiAttSize.setContent(W(f("sizes"),{},{transferred_size:function(){return g(r);},total_size:function(){return L+" "+H["str_rte_attachments_megabyte"];}}));}n.errorFlags.tooMany=m>R;n.errorFlags.tooBig=r>a;if(r>a){n.toggleOverLimit(2);}else{if(m>=R||r===a){n.toggleOverLimit(1);}else{n.toggleOverLimit(0);}}u=n.uiAttPane.all(".file-attach .transfer-error")._nodes;for(k=0,j=u.length;k<j;k++){p=C.one(u[k]);o=p.hasClass("lozenge")?p.get("parentNode"):p;if(!o.hasClass(b)){t++;if(p.hasClass("transfer-virus")){q++;}}}if(n.uiAttMessage){if(q){n.uiAttMessage.setContent((q==1)?f("virus_single"):W(f("virus_mult"),{},{num_virus_files:function(){return q;}}));n.uiAttMessage.removeClass(b);}else{if(t){n.uiAttMessage.setContent((t==1)?f("error_single"):W(f("error_mult"),{},{num_error_files:function(){return t;}}));n.uiAttMessage.removeClass(b);}else{n.uiAttMessage.addClass(b);if(NeoConfig.intl==="jp"){if(r>a){n.uiAttMessage.setContent(H.str_comp_attach_size_exceeded);n.uiAttMessage.removeClass(b);}else{if(m>R){n.uiAttMessage.setContent(H.str_comp_attach_num_files_exceeded);n.uiAttMessage.removeClass(b);}}}}}}}function e(Y){var i=this;if(i.errorFlags.tooBig){i.attachError("size");}else{if(i.errorFlags.tooMany||Y){i.attachError("count");}else{return false;}}return true;}function P(q,t){var p=this,r=p.tab.one(".file-attach"),n=p.cdo.get("attachments")[q],Y=n.state||{},m=n.size||{},i,v=Y.processed?"":" processing",o,x,j,s,l,k,w,u;m=Y.resampled?m.sampled:m.original;m=g(m);if(n.original&&Y.uploaded){n.processed=true;}if(NeoConfig.bidi){C.use("comms-intl-bidi",function(y){i=y.Intl.detectDirection(unescape(n.filename));});}t=t||C.mail.UploaderService.DEFAULT_UPLOADER;if(t==C.mail.UploaderService.UPLOADER_TYPE_FORM||t==C.mail.UploaderService.UPLOADER_TYPE_FLASH){o="_shared_module_rte_well_content_attach_item";x=E[o].browser_plus_attach_else;j=C.Node.create(W(x,n,{filename:function(y){return S(y.filename.split("\\").pop());},in_progress1:function(){return n.original?"":E[o].in_progress1;},transfer_error1:function(){return Y.failed?E[o].transfer_error1:"";},transfer_warn1:function(){return Y.failCause?E[o].transfer_warn1:"";},retry:function(){return W(E[o].retry,0,0,0,H);}},null,H));if((C.UA.ie>0)&&(C.UA.ie<8)){j.removeClass(b);j.setStyle("float","left");p.uiAttPane.setStyle("paddingBottom","6px");}j.one("a").set("title",(n.filename.split("\\").pop()||"")+" ("+m+")");p.handles.push(j.one(".lozengeremove").on("click",function(){if(j.hasClass("downloading")&&p.uploader._cancel){p.uploader._cancel(q);}p.cdo._removeAttachment(q);}));w=j.one(".lozengeretry");if(w){if(!C.UA.webkit&&t==C.mail.UploaderService.UPLOADER_TYPE_FORM){w.addClass("hidden");}else{p.handles.push(w.on("click",function(){var y=w.getAttribute("retries")||0;w.setAttribute("retries",++y);p.retryOrSwitchAttachmentMode(q,y);}));}}if(i){j.one(".btn").setAttribute("dir",i).addClass(i);}p.handles.push(j.on("click",function(y){if(!j.hasClass("downloading")){p.downloadAttachment(q);}}));r.append(j);if(C.mail.UploaderService.debug){p.handles.push(j.on("click",function(y){if(y.altKey){C.mail.UploaderService.logIt(p.cdo.get("attachments")[q]);}}));}}p.dirty=true;}function J(Y){var j=this,i;i=j.uiAttList.all("li")&&j.uiAttList.all("li").item(Y);if(i){i.addClass(b);i.removeClass(K);}j.uploader&&j.uploader.removeAttachment&&j.uploader.removeAttachment(Y);}function B(i,Y){var m=this,l,k,j;l=m.uiAttList.all("li")&&m.uiAttList.all("li").item(i);if(l){k=!!l.one(".lozenge");j=k?".lozengeProgress":".progress";l.one(j).setStyle("width",Y+"%");l.one(j).set("aria-valuenow",Y);}}function Z(i){var s=this,u="",p=H.str_rte_attachments_click_to_retry+".",q="",m="",n=s.uiAttList.all("li")&&s.uiAttList.all("li").item(i),t,w,l,o,z,k,r,Y="",y,v,j=C.mail.UploaderService;if(!n){return;}t=!!n.one(".lozenge");if(t){n=n.one(".lozenge").get("parentNode");}else{n.one(".file-container").removeClass("processing");n.one(".prog-indicator").addClass(b);}w=s.cdo.get("attachments")[i];o=w.state||{};z=o.failCause;if(o.failed){n.addClass("transfer-error");if(t){n.all(".lozenge").addClass("lozengeerror");}if(z==="virus"){n.addClass("transfer-virus");u=f("virusWarning");}else{if(z==="size"){n.removeClass("downloading");n.one(".lozenge a").set("title",f("alert_size"));}else{if(!t){n.one(".retry").removeClass(b);}u=f("attachFailedWarning");}}if((C.UA.webkit||j.type!=j.UPLOADER_TYPE_FORM)&&z!="virus"&&(v=n.one(".lozengeretry"))){v.removeClass(b);}s.attachError(z,i);}else{if(z){if(t){l=n.one("a");l.addClass("lozengewarn");u=f("noAVScanWarning");}else{n.addClass("transfer-warning");if(j.DEFAULT_UPLOADER!=j.UPLOADER_TYPE_FORM||C.UA.webkit){n.one(".lozengeretry").removeClass(b);}s.attachError(w.state.failCause,i);}}else{if(t){if(n.hasClass("transfer-error")){n.removeClass("transfer-error");}if((y=n.all(".lozenge"))&&y.hasClass("lozengeerror")){y.removeClass("lozengeerror");if(v=n.one(".lozengeretry")){v.addClass("hidden");}if(o.retry){n.addClass("downloading");}}}}}if(t){k=w.size;r=w.filename;if(!o.retry){n.removeClass("downloading");}k=o.resampled?k.sampled:k.original;k=g(k);try{Y=decodeURIComponent(r||"");}catch(x){Y=decodeURIComponent(escape(r)||"")||"";}if(z=="yui_progress_timeout"){q=" YUI Upload Progress Timeout.";}if(NeoConfig.bidi&&H.str_tog_loadRTLCss){m=u+" "+Y+" \u202b("+k+")\u202c.";}else{m=u+" "+Y+" ("+k+").";}y=n.one(".lozenge");y&&y.one("a").set("title",m);}else{C.use("event-mouseenter",function(){n.on("mouseenter",function(){n.addClass("over");});n.on("mouseleave",function(){n.removeClass("over");});});}if(n.hasClass(b)){s.cdo._removeAttachment(i);}}function O(j,Y,k){var m=this,l,i=!(C.UA.webkit);if(m.uploader.uploaderType==C.mail.UploaderService.UPLOADER_TYPE_YUI&&Y>1){C.use("common-ui-dialog-helper","_shared_module_offscreen_bin_modal_btn_ok",function(n){n.common.ui.DialogHelper.custom({hd:H.str_comp_attach_reattach_title,bd:H.str_comp_attach_reattach_body,ft:W(E._shared_module_offscreen_bin_modal_btn_ok.base,0,0,0,H,E)},{"ok":{handler:function(){n.fire("compose:toggleUploaderType",{form:1,destroy:k});
l=m.uiAttList.all(".lozengeretry");if(l&&i){l.addClass("hidden");}}}});});}else{if(Y>3){C.use("common-ui-dialog-helper",function(n){n.common.ui.DialogHelper.alert({hd:H.str_comp_attach_reattach_failure_title,bd:H.str_comp_attach_reattach_failure_body},{"ok":{handler:function(){m.cdo._removeAttachment(j);}}});});}else{m.uploader.retryAttachment&&m.uploader.retryAttachment(j);}}}function h(o){var m=this,i=m.uploader.uiForm.one("span"),j=C.mail.UploaderService,p,n=m.uploaderConfig,k=o.flashCrash||0,q=o.destroy||0,r=o.callback||0,l=o.skipDefault||0,Y;if(l){n.skipDefault=l;}if(k){j.rs.intlStat("UploaderService","UploaderYUI_FlashCrash");}if(q){i.fire("yuiuploader:destroy");}else{if(!l){m.reposAttachObj("offscreen");}}if(r){p=r;}else{p=function(s){j.rs.intlStat("UploaderService","UploaderInstanceSwitchedTo_"+s.uploaderType);};}if(m.prevUploader&&m.prevUploader.uploaderType=="form"){Y=m.uploader;m.uploader=m.prevUploader;m.prevUploader=Y;j.type=j.UPLOADER_TYPE_FORM;m.uploader.inputChangeHandle=m.uploader.uiForm.one(".attachment-button-file").on("change",function(s){m.uploader.handleFileInput(s);});}else{m.prevUploader=m.uploader;j.create(n,p,j.UPLOADER_TYPE_FORM);}m.prevUploader&&m.prevUploader.detachEvents&&m.prevUploader.detachEvents();}function U(){var k=this,i=C.mail.UploaderService,Y,j=0;i.rs.intlStat("UploaderService","SwitchToFlashUploader");i.logIt("compose-attach: Switch to FLASH uploader");if(k.prevUploader&&k.prevUploader.uploaderType=="yui"){Y=k.uploader;k.uploader=k.prevUploader;k.prevUploader=Y;i.rs.intlStat("UploaderService","UploaderInstanceSwitchedTo_YUI");if(k.tab.getStyle("visibility")=="visible"){k.reposAttachObj("restore");}i.type=i.UPLOADER_TYPE_YUI;k.prevUploader&&k.prevUploader.inputChangeHandle&&k.prevUploader.inputChangeHandle.detach();k.uploader.bindEvents&&k.uploader.bindEvents();j=1;}else{i.logIt("compose-attach: switch to Flash - existing uploader not found");i.rs.intlStat("UploaderService","ExistingFlashUploaderNotFound");}return j;}function G(i,Y){i.addClass("active");Y.hasClass("active")&&Y.removeClass("active");}function F(n){var m=this,j=C.mail.UploaderService,k="#switch-form",Y="#switch-flash",o,i=n.node||C.one("#menu-attach-options"),l=n.flashCrash||0,p=n.destroy||0;if(n.form&&m.type!=j.UPLOADER_TYPE_FORM){j.rs.intlStat("UploaderService","ToggleFormActivated");m.type=j.UPLOADER_TYPE_FORM;m.switchToFormUploader({flashCrash:l,destroy:p});if(!C.UA.webkit){o=m.tab.all(".lozengeretry");o&&o.addClass("hidden");}i&&G(i.one(k),i.one(Y));if(m.uiAttBar.one(".attachment-button-attach a")){m.uiAttBar.one(".attachment-button-attach a").setContent(H.str_comp_attach_singular);}else{m.uiAttBar.one(".attachment-button-attach i").setContent(H.str_comp_attach_singular);}}else{if(n.flash&&m.type!=j.UPLOADER_TYPE_YUI){j.rs.intlStat("UploaderService","ToggleFlashActivated");i&&G(i.one(Y),i.one(k));m.type=j.UPLOADER_TYPE_YUI;if(m.switchToFlashUploader()){if(m.uiAttBar.one(".attachment-button-attach a")){m.uiAttBar.one(".attachment-button-attach a").setContent(H.str_comp_attach);}else{m.uiAttBar.one(".attachment-button-attach i").setContent(H.str_comp_attach);}}else{i&&G(i.one(k),i.one(Y));m.type=j.UPLOADER_TYPE_FORM;}}}}function g(i){var Y=H["str_rte_attachments_bytes"];if(i>1048575){i/=1048576;Y=H["str_rte_attachments_megabyte"];}else{if(i>1023){i/=1024;Y=H["str_rte_attachments_kilobyte"];}}if(isNaN(i)){i=0;}return Math.round(i)+" "+Y;}function d(Y){var l=this,i=l.cdo.get("attachments")[Y],k=i&&i.state||0,j=[];if(k.uploaded&&!k.failed&&!k.cancelled){l.cdo.fire("compose:downloadAttachment",Y);}}function M(n){var m=this,k=m.saveUiBtnStyle,j=n===2?"addClass":"removeClass",l=n>0?"addClass":"removeClass",Y=n>0?"removeClass":"addClass",i=C.one(".yuiUploadBox")||null;if(m.uiAttBtnDisabled){m.uiAttBtnDisabled[Y](b);}if(m.uiAttSize){m.uiAttSize[j]("overlimit");}if(m.uiAttBtnForm){m.uiAttBtnForm[l](b);}if(i){if(n>0){if(!k){m.saveUiBtnStyle=i.getAttribute("style");}i.setAttribute("style","position:absolute;top:0;left:0;width:1px;height:1px;");}else{if(typeof k!=="undefined"){i.setAttribute("style",k);}}}}function I(j){var i=j&&j.state||{},k=j.mimetype||"",Y="";k=unescape(k);if(i.failed){Y="transfer-error ";if(i.failCause=="virus"){Y+="virus ";}}if(k){if(Q[k]){Y+=Q[k];}else{Y+="no-type";}}else{Y+="no-type";}return Y;}function A(j,l){var m=this,Y=C.mail.UploaderService.DEFAULT_UPLOADER,i=C.mail.UploaderService.UPLOADER_TYPE_FLASH;OFFSCREEN="offscreen",RESTORE="restore",MOVE="move";if(Y=="yui"&&m.uiAttBar){var k=m.uiAttBar.one(".attachment-button-attach");l=l||k.getXY();if(!m.attachXY){m.attachXY=k.getXY();}if(j==OFFSCREEN||m.attachPaneHidden){if(m.attachXY[0]!=0||m.attachXY[1]!=0){m.attachXY=[0,0];k.fire("compose:reposAttachObj",{x:0,y:0,resize:true,width:"1px",height:"1px"});}}else{if((l[0]!=m.attachXY[0]||l[1]!=m.attachXY[1])&&(m.type==i||!m.type)){m.attachXY=[l[0],l[1]];if(j==RESTORE){k.fire("compose:reposAttachObj",{x:l[0],y:l[1],resize:true,height:k.getStyle("height"),width:k.getStyle("width")});}else{k.fire("compose:reposAttachObj",{x:l[0],y:l[1],resize:false});}}}}}C.mail.AttachmentView.prototype={setAttachmentStyle:T,addAttachment:P,removeAttachment:J,enableAttachment:Z,downloadAttachment:d,toggleOverLimit:M,updateAttachmentProgress:B,updateSizeAndCount:c,getIconClass:I,attachError:X,checkOverLimit:e,retryOrSwitchAttachmentMode:O,switchToFormUploader:h,switchToFlashUploader:U,toggleUploaderType:F,reposAttachObj:A};},"1.0.0",{requires:["rocket-stats"]});YUI.add("selector-css3",function(a){a.Selector._reNth=/^(?:([\-]?\d*)(n){1}|(odd|even)$)*([\-+]?\d*)$/;a.Selector._getNth=function(d,o,q,h){a.Selector._reNth.test(o);var m=parseInt(RegExp.$1,10),c=RegExp.$2,j=RegExp.$3,k=parseInt(RegExp.$4,10)||0,p=[],l=a.Selector._children(d.parentNode,q),f;if(j){m=2;f="+";c="n";k=(j==="odd")?1:0;}else{if(isNaN(m)){m=(c)?1:0;}}if(m===0){if(h){k=l.length-k+1;}if(l[k-1]===d){return true;}else{return false;}}else{if(m<0){h=!!h;m=Math.abs(m);}}if(!h){for(var e=k-1,g=l.length;e<g;e+=m){if(e>=0&&l[e]===d){return true;}}}else{for(var e=l.length-k,g=l.length;e>=0;e-=m){if(e<g&&l[e]===d){return true;}}}return false;};a.mix(a.Selector.pseudos,{"root":function(b){return b===b.ownerDocument.documentElement;},"nth-child":function(b,c){return a.Selector._getNth(b,c);},"nth-last-child":function(b,c){return a.Selector._getNth(b,c,null,true);},"nth-of-type":function(b,c){return a.Selector._getNth(b,c,b.tagName);},"nth-last-of-type":function(b,c){return a.Selector._getNth(b,c,b.tagName,true);},"last-child":function(c){var b=a.Selector._children(c.parentNode);return b[b.length-1]===c;},"first-of-type":function(b){return a.Selector._children(b.parentNode,b.tagName)[0]===b;},"last-of-type":function(c){var b=a.Selector._children(c.parentNode,c.tagName);return b[b.length-1]===c;},"only-child":function(c){var b=a.Selector._children(c.parentNode);return b.length===1&&b[0]===c;},"only-of-type":function(c){var b=a.Selector._children(c.parentNode,c.tagName);return b.length===1&&b[0]===c;},"empty":function(b){return b.childNodes.length===0;},"not":function(b,c){return !a.Selector.test(b,c);},"contains":function(b,c){var d=b.innerText||b.textContent||"";return d.indexOf(c)>-1;},"checked":function(b){return(b.checked===true||b.selected===true);},enabled:function(b){return(b.disabled!==undefined&&!b.disabled);},disabled:function(b){return(b.disabled);}});a.mix(a.Selector.operators,{"^=":"^{val}","$=":"{val}$","*=":"{val}"});a.Selector.combinators["~"]={axis:"previousSibling"};},"@VERSION@",{requires:["dom-base","selector-native","selector-css2"]});YUI.add("stylesheet",function(b){var k=b.config.doc,c=k.createElement("p"),g=c.style,e=b.Lang.isString,n={},j={},l=("cssFloat" in g)?"cssFloat":"styleFloat",h,a,m,o="opacity",q="float",f="";a=(o in g)?function(d){d.opacity=f;}:function(d){d.filter=f;};g.border="1px solid red";g.border=f;m=g.borderLeft?function(d,s){var r;if(s!==l&&s.toLowerCase().indexOf(q)!=-1){s=l;}if(e(d[s])){switch(s){case o:case"filter":a(d);break;case"font":d.font=d.fontStyle=d.fontVariant=d.fontWeight=d.fontSize=d.lineHeight=d.fontFamily=f;break;default:for(r in d){if(r.indexOf(s)===0){d[r]=f;}}}}}:function(d,p){if(p!==l&&p.toLowerCase().indexOf(q)!=-1){p=l;}if(e(d[p])){if(p===o){a(d);}else{d[p]=f;}}};function i(x,s){var A,v,z,y={},p,B,u,w,d,t;if(!(b.instanceOf(this,i))){return new i(x,s);}if(x){if(b.Node&&x instanceof b.Node){v=x._node;}else{if(x.nodeName){v=x;}else{if(e(x)){if(x&&j[x]){return j[x];}v=k.getElementById(x.replace(/^#/,f));}}}if(v&&j[b.stamp(v)]){return j[b.stamp(v)];}}if(!v||!/^(?:style|link)$/i.test(v.nodeName)){v=k.createElement("style");v.type="text/css";}if(e(x)){if(x.indexOf("{")!=-1){if(v.styleSheet){v.styleSheet.cssText=x;}else{v.appendChild(k.createTextNode(x));}}else{if(!s){s=x;}}}if(!v.parentNode||v.parentNode.nodeName.toLowerCase()!=="head"){A=(v.ownerDocument||k).getElementsByTagName("head")[0];A.appendChild(v);}z=v.sheet||v.styleSheet;p=z&&("cssRules" in z)?"cssRules":"rules";u=("deleteRule" in z)?function(r){z.deleteRule(r);}:function(r){z.removeRule(r);};B=("insertRule" in z)?function(D,C,r){z.insertRule(D+" {"+C+"}",r);}:function(D,C,r){z.addRule(D,C,r);};for(w=z[p].length-1;w>=0;--w){d=z[p][w];t=d.selectorText;if(y[t]){y[t].style.cssText+=";"+d.style.cssText;u(w);}else{y[t]=d;}}i.register(b.stamp(v),this);if(s){i.register(s,this);}b.mix(this,{getId:function(){return b.stamp(v);},enable:function(){z.disabled=false;return this;},disable:function(){z.disabled=true;return this;},isEnabled:function(){return !z.disabled;},set:function(E,D){var G=y[E],F=E.split(/\s*,\s*/),C,r;if(F.length>1){for(C=F.length-1;C>=0;--C){this.set(F[C],D);}return this;}if(!i.isValidSelector(E)){return this;}if(G){G.style.cssText=i.toCssText(D,G.style.cssText);}else{r=z[p].length;D=i.toCssText(D);if(D){B(E,D,r);y[E]=z[p][r];}}return this;},unset:function(E,D){var G=y[E],F=E.split(/\s*,\s*/),r=!D,H,C;if(F.length>1){for(C=F.length-1;C>=0;--C){this.unset(F[C],D);}return this;}if(G){if(!r){D=b.Array(D);g.cssText=G.style.cssText;for(C=D.length-1;C>=0;--C){m(g,D[C]);}if(g.cssText){G.style.cssText=g.cssText;}else{r=true;}}if(r){H=z[p];for(C=H.length-1;C>=0;--C){if(H[C]===G){delete y[E];u(C);break;}}}}return this;},getCssText:function(D){var E,C,r;if(e(D)){E=y[D.split(/\s*,\s*/)[0]];return E?E.style.cssText:null;}else{C=[];for(r in y){if(y.hasOwnProperty(r)){E=y[r];C.push(E.selectorText+" {"+E.style.cssText+"}");}}return C.join("\n");}}});}h=function(r,t){var s=r.styleFloat||r.cssFloat||r[q],d=b.Lang.trim,v;try{g.cssText=t||f;}catch(u){c=k.createElement("p");g=c.style;g.cssText=t||f;}if(s&&!r[l]){r=b.merge(r);delete r.styleFloat;delete r.cssFloat;delete r[q];r[l]=s;}for(v in r){if(r.hasOwnProperty(v)){try{g[v]=d(r[v]);}catch(p){}}}return g.cssText;};b.mix(i,{toCssText:((o in g)?h:function(d,p){if(o in d){d=b.merge(d,{filter:"alpha(opacity="+(d.opacity*100)+")"});delete d.opacity;}return h(d,p);}),register:function(d,p){return !!(d&&p instanceof i&&!j[d]&&(j[d]=p));},isValidSelector:function(p){var d=false;if(p&&e(p)){if(!n.hasOwnProperty(p)){n[p]=!/\S/.test(p.replace(/\s+|\s*[+~>]\s*/g," ").replace(/([^ ])\[.*?\]/g,"$1").replace(/([^ ])::?[a-z][a-z\-]+[a-z](?:\(.*?\))?/ig,"$1").replace(/(?:^| )[a-z0-6]+/ig," ").replace(/\\./g,f).replace(/[.#]\w[\w\-]*/g,f));}d=n[p];}return d;}},true);b.StyleSheet=i;},"@VERSION@");YUI.add("comms-intl-bidi",function(A){A.mix(A.namespace("Intl"),{_rtlChars:"[\uD83A\uD83B][\uDC00-\uDFFF]|[\u0590\u05BE\u05C0\u05C3\u05C6\u05C8-\u05FF\u0604\u0605\u0608\u060B\u060D\u061B-\u064A\u065F\u066D-\u066F\u0671-\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u070E\u0710\u0712-\u072F\u074B-\u07A5\u07B1-\u07EA\u07F4\u07F5\u07FA-\u0815\u081A\u0824\u0828\u082E-\u08FF\u200F\uFB1D\uFB1F-\uFB28\uFB2A-\uFD3D\uFD40-\uFDCF\uFDF0-\uFDFC\uFDFE\uFDFF\uFE70-\uFEFE]|\uD803[\uDC00-\uDE5F\uDE7F-\uDFFF]|\uD802[\uDC00-\uDD1E\uDD20-\uDE00\uDE04\uDE07-\uDE0B\uDE10-\uDE37\uDE3B-\uDE3E\uDE40-\uDF38\uDF40-\uDFFF]",_neutralChars:"[\uDB40-\uDB43][\uDC00-\uDFFF]|\uD802[\uDD1F\uDE01-\uDE03\uDE05\uDE06\uDE0C-\uDE0F\uDE38-\uDE3A\uDE3F\uDF39-\uDF3F]|\uD804[\uDC80\uDC81\uDCB3-\uDCB6\uDCB9\uDCBA]|\uD803[\uDE60-\uDE7E]|\uD800[\uDD01\uDD40-\uDD8A\uDD90-\uDD9B\uDDFD]|[\uD83F\uD87F\uD8BF\uD8FF\uD93F\uD97F\uD9BF\uD9FF\uDA3F\uDA7F\uDABF\uDAFF\uDB3F\uDB7F\uDBBF\uDBFF][\uDFFE\uDFFF]|\uD83C[\uDC00-\uDC2B\uDC30-\uDC93\uDD00-\uDD0A]|[\u0000-\u0040\u005B-\u0060\u007B-\u00A9\u00AB-\u00B4\u00B6-\u00B9\u00BB-\u00BF\u00D7\u00F7\u02B9\u02BA\u02C2-\u02CF\u02D2-\u02DF\u02E5-\u02ED\u02EF-\u036F\u0374\u0375\u037E\u0384\u0385\u0387\u03F6\u0483-\u0489\u058A\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0600-\u0603\u0606\u0607\u0609\u060A\u060C\u060E-\u061A\u064B-\u065E\u0660-\u066C\u0670\u06D6-\u06E4\u06E7-\u06ED\u06F0-\u06F9\u070F\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07F6-\u07F9\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0900-\u0902\u093C\u0941-\u0948\u094D\u0951-\u0955\u0962\u0963\u0981\u09BC\u09C1-\u09C4\u09CD\u09E2\u09E3\u09F2\u09F3\u09FB\u0A01\u0A02\u0A3C\u0A41\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81\u0A82\u0ABC\u0AC1-\u0AC5\u0AC7\u0AC8\u0ACD\u0AE2\u0AE3\u0AF1\u0B01\u0B3C\u0B3F\u0B41-\u0B44\u0B4D\u0B56\u0B62\u0B63\u0B82\u0BC0\u0BCD\u0BF3-\u0BFA\u0C3E-\u0C40\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C78-\u0C7E\u0CBC\u0CCC\u0CCD\u0CE2\u0CE3\u0CF1\u0CF2\u0D41-\u0D44\u0D4D\u0D62\u0D63\u0DCA\u0DD2-\u0DD4\u0DD6\u0E31\u0E34-\u0E3A\u0E3F\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39-\u0F3D\u0F71-\u0F7E\u0F80-\u0F84\u0F86\u0F87\u0F90-\u0F97\u0F99-\u0FBC\u0FC6\u102D-\u1030\u1032-\u1037\u1039\u103A\u103D\u103E\u1058\u1059\u105E-\u1060\u1071-\u1074\u1082\u1085\u1086\u108D\u109D\u135F\u1390-\u1399\u1400\u1680\u169B\u169C\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B7-\u17BD\u17C6\u17C9-\u17D3\u17DB\u17DD\u17F0-\u17F9\u1800-\u180E\u18A9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193B\u1940\u1944\u1945\u19DE-\u19FF\u1A17\u1A18\u1A56\u1A58-\u1A5E\u1A60\u1A62\u1A65-\u1A6C\u1A73-\u1A7C\u1A7F\u1B00-\u1B03\u1B34\u1B36-\u1B3A\u1B3C\u1B42\u1B6B-\u1B73\u1B80\u1B81\u1BA2-\u1BA5\u1BA8\u1BA9\u1C2C-\u1C33\u1C36\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE0\u1CE2-\u1CE8\u1CED\u1DC0-\u1DE6\u1DFD-\u1DFF\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u2000-\u200D\u2010-\u2070\u2074-\u207E\u2080-\u208E\u20A0-\u20B8\u20D0-\u20F0\u2100\u2101\u2103-\u2106\u2108\u2109\u2114\u2116-\u2118\u211E-\u2123\u2125\u2127\u2129\u212E\u213A\u213B\u2140-\u2144\u214A-\u214D\u2150-\u215F\u2189\u2190-\u2335\u237B-\u2394\u2396-\u23E8\u2400-\u2426\u2440-\u244A\u2460-\u249B\u24EA-\u26AB\u26AD-\u26CD\u26CF-\u26E1\u26E3\u26E8-\u26FF\u2701-\u2704\u2706-\u2709\u270C-\u2727\u2729-\u274B\u274D\u274F-\u2752\u2756-\u275E\u2761-\u2794\u2798-\u27AF\u27B1-\u27BE\u27C0-\u27CA\u27CC\u27D0-\u27FF\u2900-\u2B4C\u2B50-\u2B59\u2CE5-\u2CEA\u2CEF-\u2CF1\u2CF9-\u2CFF\u2DE0-\u2E31\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFB\u3000-\u3004\u3008-\u3020\u302A-\u3030\u3036\u3037\u303D-\u303F\u3099-\u309C\u30A0\u30FB\u31C0-\u31E3\u321D\u321E\u3250-\u325F\u327C-\u327E\u32B1-\u32BF\u32CC-\u32CF\u3377-\u337A\u33DE\u33DF\u33FF\u4DC0-\u4DFF\uA490-\uA4C6\uA60D-\uA60F\uA66F-\uA673\uA67C-\uA67F\uA6F0\uA6F1\uA700-\uA721\uA788\uA802\uA806\uA80B\uA825\uA826\uA828-\uA82B\uA838\uA839\uA874-\uA877\uA8C4\uA8E0-\uA8F1\uA926-\uA92D\uA947-\uA951\uA980-\uA982\uA9B3\uA9B6-\uA9B9\uA9BC\uAA29-\uAA2E\uAA31\uAA32\uAA35\uAA36\uAA43\uAA4C\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uABE5\uABE8\uABED\uFB1E\uFB29\uFD3E\uFD3F\uFDD0-\uFDEF\uFDFD\uFE00-\uFE19\uFE20-\uFE26\uFE30-\uFE52\uFE54-\uFE66\uFE68-\uFE6B\uFEFF\uFF01-\uFF20\uFF3B-\uFF40\uFF5B-\uFF65\uFFE0-\uFFE6\uFFE8-\uFFEE\uFFF0-\uFFFF]|\uD835[\uDEDB\uDF15\uDF4F\uDF89\uDFC3\uDFCE-\uDFFF]|\uD834[\uDD67-\uDD69\uDD73-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE00-\uDE45\uDF00-\uDF56]",_initializeBidiPatterns:function(){this._rtlPattern=new RegExp("^(?:"+this._neutralChars+")*(?:"+this._rtlChars+")");this._neturalPattern=new RegExp("^(?:"+this._neutralChars+")*$");},setBidiChars:function(B,C){if(B!==undefined){this._rtlChars=B;}if(C!==undefined){this._neutralChars=C;}this._initializeBidiPatterns();},detectDirection:function(C,B){if(this._rtlPattern.test(C)){return"rtl";}else{if(B==="ltr"){return"ltr";}else{if(this._neturalPattern.test(C)){if(B==="rtl"){return"rtl";}else{return"";}}else{return"ltr";}}}}});A.Intl._initializeBidiPatterns();A.mix(A.namespace("Intl"),{bidiDirection:A.Intl.detectDirection});},"1.0.0");YUI.add("comms-node-setdir",function(B){var A={ltr:"rtl",rtl:"ltr"};B.Node.addMethod("setDirection",function(E,F){var D,C;if(F==="ltr"||F==="rtl"){D=B.one(E);C=D.getStyle("direction");D.setAttribute("dir",F);D.setStyle("direction","");D.removeClass(B.ClassNameManager.getClassName(A[F]));D.addClass(B.ClassNameManager.getClassName(F));if(F!==C){B.fire("directionChange",{target:D,dir:F});}}return D;});},"1.0.0",{requires:["classnamemanager","node-base","node-style"]});YUI.add("comms-bidi-textentry",function(B){function A(){A.superclass.constructor.apply(this,arguments);}A.NS="bidiTextEntry";A.NAME="bidiTextEntry";B.extend(A,B.Plugin.Base,{initializer:function(C){var E=this.get("host"),D;E.BIDI_DISABLED=false;E.PREVIOUS_DIRECTION=E.getStyle("direction");if(!E.PREVIOUS_DIRECTION){E.PREVIOUS_DIRECTION=E.getAttribute("dir");}E.DETECT_DEFAULT_DIRECTION=(C&&C.detect_default_direction===true);if(!E.DETECT_DEFAULT_DIRECTION){E.setDirection(E.PREVIOUS_DIRECTION);}else{D=B.Intl.detectDirection(E.get("value"));E.setDirection(D);E.PREVIOUS_DIRECTION=D;}this.afterHostEvent("valueChange",function(H){var G=this.get("host"),J,I=G.BIDI_DISABLED,F=G.PREVIOUS_DIRECTION,K;if(I){return;}K=G.getAttribute("dir");if(F!=K){G.BIDI_DISABLED=true;return;}J=B.Intl.detectDirection(H.newVal);if(J==="rtl"||J=="ltr"){G.PREVIOUS_DIRECTION=J;}G.setDirection(J);});}});B.namespace("Plugin");B.Plugin.BidiTextEntry=A;B.Plugin.BidiTextInput=A;},"1.0.0",{requires:["plugin","event-valuechange","comms-intl-bidi","comms-node-setdir"]});YUI.add("frame",function(d){var a=function(){a.superclass.constructor.apply(this,arguments);},c=":last-child",b="body";d.extend(a,d.Base,{_ready:null,_rendered:null,_iframe:null,_instance:null,_create:function(e){var k,j,g,i;this._iframe=d.Node.create(a.HTML);this._iframe.setStyle("visibility","hidden");this._iframe.set("src",this.get("src"));this.get("container").append(this._iframe);this._iframe.set("height","99%");var f="",h=((this.get("extracss"))?'<style id="extra_css">'+this.get("extracss")+"</style>":"");f=d.substitute(a.PAGE_HTML,{DIR:this.get("dir"),LANG:this.get("lang"),TITLE:this.get("title"),META:a.META,LINKED_CSS:this.get("linkedcss"),CONTENT:this.get("content"),BASE_HREF:this.get("basehref"),DEFAULT_CSS:a.DEFAULT_CSS,EXTRA_CSS:h});if(d.config.doc.compatMode!="BackCompat"){f=a.getDocType()+"\n"+f;}else{}g=this._resolveWinDoc();g.doc.open();g.doc.write(f);g.doc.close();if(!g.doc.documentElement){var l=d.later(1,this,function(){if(g.doc&&g.doc.documentElement){e(g);l.cancel();}},null,true);}else{e(g);}},_resolveWinDoc:function(f){var e=(f)?f:{};e.win=d.Node.getDOMNode(this._iframe.get("contentWindow"));e.doc=d.Node.getDOMNode(this._iframe.get("contentWindow.document"));if(!e.doc){e.doc=d.config.doc;}if(!e.win){e.win=d.config.win;}return e;},_onDomEvent:function(h){var g,f;if(!d.Node.getDOMNode(this._iframe)){return;}h.frameX=h.frameY=0;if(h.pageX>0||h.pageY>0){if(h.type.substring(0,3)!=="key"){f=this._instance.one("win");g=this._iframe.getXY();h.frameX=g[0]+h.pageX-f.get("scrollLeft");h.frameY=g[1]+h.pageY-f.get("scrollTop");}}h.frameTarget=h.target;h.frameCurrentTarget=h.currentTarget;h.frameEvent=h;this.fire("dom:"+h.type,h);},initializer:function(){this.publish("ready",{emitFacade:true,defaultFn:this._defReadyFn});},destructor:function(){var e=this.getInstance();e.one("doc").detachAll();e=null;this._iframe.remove();},_DOMPaste:function(i){var g=this.getInstance(),f="",h=g.config.win;if(i._event.originalTarget){f=i._event.originalTarget;}if(i._event.clipboardData){f=i._event.clipboardData.getData("Text");}if(h.clipboardData){f=h.clipboardData.getData("Text");if(f===""){if(!h.clipboardData.setData("Text",f)){f=null;}}}i.frameTarget=i.target;i.frameCurrentTarget=i.currentTarget;i.frameEvent=i;if(f){i.clipboardData={data:f,getData:function(){return f;}};}else{i.clipboardData=null;}this.fire("dom:paste",i);},_defReadyFn:function(){var e=this.getInstance();d.each(a.DOM_EVENTS,function(g,f){var h=d.bind(this._onDomEvent,this),i=((d.UA.ie&&a.THROTTLE_TIME>0)?d.throttle(h,a.THROTTLE_TIME):h);if(!e.Node.DOM_EVENTS[f]){e.Node.DOM_EVENTS[f]=1;}if(g===1){if(f!=="focus"&&f!=="blur"&&f!=="paste"){if(f.substring(0,3)==="key"){e.on(f,i,e.config.doc);}else{e.on(f,h,e.config.doc);}}}},this);e.Node.DOM_EVENTS.paste=1;e.on("paste",d.bind(this._DOMPaste,this),e.one("body"));e.on("focus",d.bind(this._onDomEvent,this),e.config.win);e.on("blur",d.bind(this._onDomEvent,this),e.config.win);e._use=e.use;e.use=d.bind(this.use,this);this._iframe.setStyles({visibility:"inherit"});e.one("body").setStyle("display","block");if(d.UA.ie){this._fixIECursors();}},_fixIECursors:function(){var h=this.getInstance(),f=h.all("table"),g=h.all("br"),e;if(f.size()&&g.size()){e=f.item(0).get("sourceIndex");g.each(function(l){var j=l.get("parentNode"),k=j.get("children"),i=j.all(">br");if(j.test("div")){if(k.size()>2){l.replace(h.Node.create("<wbr>"));}else{if(l.get("sourceIndex")>e){if(i.size()){l.replace(h.Node.create("<wbr>"));}}else{if(i.size()>1){l.replace(h.Node.create("<wbr>"));}}}}});}},_onContentReady:function(h){if(!this._ready){this._ready=true;var g=this.getInstance(),f=d.clone(this.get("use"));this.fire("contentready");if(h){g.config.doc=d.Node.getDOMNode(h.target);}f.push(d.bind(function(){if(g.Selection){g.Selection.DEFAULT_BLOCK_TAG=this.get("defaultblock");}if(this.get("designMode")){if(d.UA.ie){g.config.doc.body.contentEditable="true";this._ieSetBodyHeight();g.on("keyup",d.bind(this._ieSetBodyHeight,this),g.config.doc);}else{g.config.doc.designMode="on";}}this.fire("ready");},this));g.use.apply(g,f);g.one("doc").get("documentElement").addClass("yui-js-enabled");}},_ieHeightCounter:null,_ieSetBodyHeight:function(k){if(!this._ieHeightCounter){this._ieHeightCounter=0;}this._ieHeightCounter++;var j=false;if(!k){j=true;}if(k){switch(k.keyCode){case 8:case 13:j=true;break;}if(k.ctrlKey||k.shiftKey){j=true;}}if(j){try{var i=this.getInstance();var g=this._iframe.get("offsetHeight");var f=i.config.doc.body.scrollHeight;if(g>f){g=(g-15)+"px";i.config.doc.body.style.height=g;}else{i.config.doc.body.style.height="auto";}}catch(k){if(this._ieHeightCounter<100){d.later(200,this,this._ieSetBodyHeight);}else{}}}},_resolveBaseHref:function(e){if(!e||e===""){e=d.config.doc.location.href;if(e.indexOf("?")!==-1){e=e.substring(0,e.indexOf("?"));}e=e.substring(0,e.lastIndexOf("/"))+"/";}return e;},_getHTML:function(e){if(this._ready){var f=this.getInstance();e=f.one("body").get("innerHTML");}return e;},_setHTML:function(e){if(this._ready){var f=this.getInstance();f.one("body").set("innerHTML",e);}else{this.on("contentready",d.bind(function(g,i){var h=this.getInstance();h.one("body").set("innerHTML",g);},this,e));}return e;},_getLinkedCSS:function(e){if(!d.Lang.isArray(e)){e=[e];}var f="";if(!this._ready){d.each(e,function(g){if(g!==""){f+='<link rel="stylesheet" href="'+g+'" type="text/css">';}});}else{f=e;}return f;},_setLinkedCSS:function(e){if(this._ready){var f=this.getInstance();f.Get.css(e);}return e;},_setExtraCSS:function(e){if(this._ready){var g=this.getInstance(),f=g.one("#extra_css");f.remove();g.one("head").append('<style id="extra_css">'+e+"</style>");}return e;},_instanceLoaded:function(f){this._instance=f;this._onContentReady();var g=this._instance.config.doc;if(this.get("designMode")){if(!d.UA.ie){try{g.execCommand("styleWithCSS",false,false);g.execCommand("insertbronreturn",false,false);}catch(e){}}}},use:function(){var g=this.getInstance(),f=d.Array(arguments),e=false;if(d.Lang.isFunction(f[f.length-1])){e=f.pop();
}if(e){f.push(function(){e.apply(g,arguments);});}g._use.apply(g,f);},delegate:function(g,f,e,i){var h=this.getInstance();if(!h){return false;}if(!i){i=e;e="body";}return h.delegate(g,f,e,i);},getInstance:function(){return this._instance;},render:function(e){if(this._rendered){return this;}this._rendered=true;if(e){this.set("container",e);}this._create(d.bind(function(i){var k,l,f=d.bind(function(m){this._instanceLoaded(m);},this),h=d.clone(this.get("use")),g={debug:false,win:i.win,doc:i.doc},j=d.bind(function(){g=this._resolveWinDoc(g);k=YUI(g);k.host=this.get("host");try{k.use("node-base",f);if(l){clearInterval(l);}}catch(m){l=setInterval(function(){j();},350);}},this);h.push(j);d.use.apply(d,h);},this));return this;},_handleFocus:function(){var h=this.getInstance(),g=new h.Selection();if(g.anchorNode){var j=g.anchorNode,i;if(j.test("p")&&j.get("innerHTML")===""){j=j.get("parentNode");}i=j.get("childNodes");if(i.size()){if(i.item(0).test("br")){g.selectNode(j,true,false);}else{if(i.item(0).test("p")){j=i.item(0).one("br.yui-cursor");if(j){j=j.get("parentNode");}if(!j){j=i.item(0).get("firstChild");}if(!j){j=i.item(0);}if(j){g.selectNode(j,true,false);}}else{var e=h.one("br.yui-cursor");if(e){var f=e.get("parentNode");if(f){g.selectNode(f,true,false);}}}}}}},focus:function(e){if(d.UA.ie&&d.UA.ie<9){try{d.one("win").focus();this.getInstance().one("win").focus();}catch(g){}if(e===true){this._handleFocus();}if(d.Lang.isFunction(e)){e();}}else{try{d.one("win").focus();d.later(100,this,function(){this.getInstance().one("win").focus();if(e===true){this._handleFocus();}if(d.Lang.isFunction(e)){e();}});}catch(f){}}return this;},show:function(){this._iframe.setStyles({position:"static",left:""});if(d.UA.gecko){try{this._instance.config.doc.designMode="on";}catch(f){}this.focus();}return this;},hide:function(){this._iframe.setStyles({position:"absolute",left:"-999999px"});return this;}},{THROTTLE_TIME:100,DOM_EVENTS:{dblclick:1,click:1,paste:1,mouseup:1,mousedown:1,keyup:1,keydown:1,keypress:1,activate:1,deactivate:1,beforedeactivate:1,focusin:1,focusout:1},DEFAULT_CSS:"body { background-color: #fff; font: 13px/1.22 arial,helvetica,clean,sans-serif;*font-size:small;*font:x-small; } a, a:visited, a:hover { color: blue !important; text-decoration: underline !important; cursor: text !important; } img { cursor: pointer !important; border: none; }",HTML:'<iframe border="0" frameBorder="0" marginWidth="0" marginHeight="0" leftMargin="0" topMargin="0" allowTransparency="true" width="100%" height="99%"></iframe>',PAGE_HTML:'<html dir="{DIR}" lang="{LANG}"><head><title>{TITLE}</title>{META}<base href="{BASE_HREF}"/>{LINKED_CSS}<style id="editor_css">{DEFAULT_CSS}</style>{EXTRA_CSS}</head><body>{CONTENT}</body></html>',getDocType:function(){var e=d.config.doc.doctype,f=a.DOC_TYPE;if(e){f="<!DOCTYPE "+e.name+((e.publicId)?" "+e.publicId:"")+((e.systemId)?" "+e.systemId:"")+">";}else{if(d.config.doc.all){e=d.config.doc.all[0];if(e.nodeType){if(e.nodeType===8){if(e.nodeValue){if(e.nodeValue.toLowerCase().indexOf("doctype")!==-1){f="<!"+e.nodeValue+">";}}}}}}return f;},DOC_TYPE:'<!DOCTYPE HTML PUBLIC "-/'+"/W3C/"+"/DTD HTML 4.01/"+'/EN" "http:/'+'/www.w3.org/TR/html4/strict.dtd">',META:'<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta http-equiv="X-UA-Compatible" content="IE=7">',NAME:"frame",ATTRS:{title:{value:"Blank Page"},dir:{value:"ltr"},lang:{value:"en-US"},src:{value:"javascript"+((d.UA.ie)?":false":":")+";"},designMode:{writeOnce:true,value:false},content:{value:"<br>",setter:"_setHTML",getter:"_getHTML"},basehref:{value:false,getter:"_resolveBaseHref"},use:{writeOnce:true,value:["substitute","node","node-style","selector-css3"]},container:{value:"body",setter:function(e){return d.one(e);}},node:{readOnly:true,value:null,getter:function(){return this._iframe;}},id:{writeOnce:true,getter:function(e){if(!e){e="iframe-"+d.guid();}return e;}},linkedcss:{value:"",getter:"_getLinkedCSS",setter:"_setLinkedCSS"},extracss:{value:"",setter:"_setExtraCSS"},host:{value:false},defaultblock:{value:"p"}}});d.Frame=a;},"@VERSION@",{skinnable:false,requires:["base","node","selector-css3","substitute","yui-throttle"]});YUI.add("selection",function(b){var a="textContent",d="innerHTML",c="fontFamily";if(b.UA.ie){a="nodeValue";}b.Selection=function(o){var j,p,f,g,e,l;if(b.config.win.getSelection){j=b.config.win.getSelection();}else{if(b.config.doc.selection){j=b.config.doc.selection.createRange();}}this._selection=j;if(j.pasteHTML){this.isCollapsed=(j.compareEndPoints("StartToEnd",j))?false:true;if(this.isCollapsed){this.anchorNode=this.focusNode=b.one(j.parentElement());if(o){f=b.config.doc.elementFromPoint(o.clientX,o.clientY);}e=j.duplicate();if(!f){p=j.parentElement();g=p.childNodes;for(l=0;l<g.length;l++){if(e.inRange(j)){if(!f){f=g[l];}}}}this.ieNode=f;if(f){if(f.nodeType!==3){if(f.firstChild){f=f.firstChild;}if(f&&f.tagName&&f.tagName.toLowerCase()==="body"){if(f.firstChild){f=f.firstChild;}}}this.anchorNode=this.focusNode=b.Selection.resolve(f);e.moveToElementText(j.parentElement());var m=j.compareEndPoints("StartToStart",e),q=0;if(m){q=Math.abs(j.move("character",-9999));}this.anchorOffset=this.focusOffset=q;this.anchorTextNode=this.focusTextNode=b.one(f);}}else{if(j.htmlText&&j.htmlText!==""){var k=b.Node.create(j.htmlText);if(k&&k.get("id")){var h=k.get("id");this.anchorNode=this.focusNode=b.one("#"+h);}else{if(k){k=k.get("childNodes");this.anchorNode=this.focusNode=k.item(0);}}}}}else{this.isCollapsed=j.isCollapsed;this.anchorNode=b.Selection.resolve(j.anchorNode);this.focusNode=b.Selection.resolve(j.focusNode);this.anchorOffset=j.anchorOffset;this.focusOffset=j.focusOffset;this.anchorTextNode=b.one(j.anchorNode);this.focusTextNode=b.one(j.focusNode);}if(b.Lang.isString(j.text)){this.text=j.text;}else{if(j.toString){this.text=j.toString();}else{this.text="";}}};b.Selection.removeFontFamily=function(f){f.removeAttribute("face");var e=f.getAttribute("style").toLowerCase();if(e===""||(e=="font-family: ")){f.removeAttribute("style");
}if(e.match(b.Selection.REG_FONTFAMILY)){e=e.replace(b.Selection.REG_FONTFAMILY,"");f.setAttribute("style",e);}};b.Selection.filter=function(e){var h=(new Date()).getTime();var g=b.all(b.Selection.ALL),k=b.all("strong,em"),n=b.config.doc,p,f={},i="",l;var j=(new Date()).getTime();g.each(function(r){var q=b.Node.getDOMNode(r);if(q.style[c]){f["."+r._yuid]=q.style[c];r.addClass(r._yuid);b.Selection.removeFontFamily(q);}});var o=(new Date()).getTime();b.all(".hr").addClass("yui-skip").addClass("yui-non");if(b.UA.ie){p=n.getElementsByTagName("hr");b.each(p,function(t){var r=n.createElement("div");r.className="hr yui-non yui-skip";r.setAttribute("readonly",true);r.setAttribute("contenteditable",false);if(t.parentNode){t.parentNode.replaceChild(r,t);}var q=r.style;q.border="1px solid #ccc";q.lineHeight="0";q.height="0";q.fontSize="0";q.marginTop="5px";q.marginBottom="5px";q.marginLeft="0px";q.marginRight="0px";q.padding="0";});}b.each(f,function(r,q){i+=q+" { font-family: "+r.replace(/"/gi,"")+"; }";});b.StyleSheet(i,"editor");k.each(function(u,q){var r=u.get("tagName").toLowerCase(),s="i";if(r==="strong"){s="b";}b.Selection.prototype._swap(k.item(q),s);});l=b.all("ol,ul");l.each(function(r,q){var s=r.all("li");if(!s.size()){r.remove();}});if(e){b.Selection.filterBlocks();}var m=(new Date()).getTime();};b.Selection.filterBlocks=function(){var f=(new Date()).getTime();var n=b.config.doc.body.childNodes,h,g,q=false,k=true,e,r,t,p,m,o,u;if(n){for(h=0;h<n.length;h++){g=b.one(n[h]);if(!g.test(b.Selection.BLOCKS)){k=true;if(n[h].nodeType==3){o=n[h][a].match(b.Selection.REG_CHAR);u=n[h][a].match(b.Selection.REG_NON);if(o===null&&u){k=false;}}if(k){if(!q){q=[];}q.push(n[h]);}}else{q=b.Selection._wrapBlock(q);}}q=b.Selection._wrapBlock(q);}r=b.all(b.Selection.DEFAULT_BLOCK_TAG);if(r.size()===1){t=r.item(0).all("br");if(t.size()===1){if(!t.item(0).test(".yui-cursor")){t.item(0).remove();}var j=r.item(0).get("innerHTML");if(j===""||j===" "){r.set("innerHTML",b.Selection.CURSOR);e=new b.Selection();e.focusCursor(true,true);}if(t.item(0).test(".yui-cursor")&&b.UA.ie){t.item(0).remove();}}}else{r.each(function(s){var i=s.get("innerHTML");if(i===""){s.remove();}});}if(!b.UA.ie){}var l=(new Date()).getTime();};b.Selection.REG_FONTFAMILY=/font-family: ;/;b.Selection.REG_CHAR=/[a-zA-Z-0-9_!@#\$%\^&*\(\)-=_+\[\]\\{}|;':",.\/<>\?]/gi;b.Selection.REG_NON=/[\s|\n|\t]/gi;b.Selection.REG_NOHTML=/<\S[^><]*>/g;b.Selection._wrapBlock=function(f){if(f){var e=b.Node.create("<"+b.Selection.DEFAULT_BLOCK_TAG+"></"+b.Selection.DEFAULT_BLOCK_TAG+">"),h=b.one(f[0]),g;for(g=1;g<f.length;g++){e.append(f[g]);}h.replace(e);e.prepend(h);}return false;};b.Selection.unfilter=function(){var g=b.all("body [class]"),h="",f,i,e=b.one("body");g.each(function(j){if(j.hasClass(j._yuid)){j.setStyle(c,j.getStyle(c));j.removeClass(j._yuid);if(j.getAttribute("class")===""){j.removeAttribute("class");}}});f=b.all(".yui-non");f.each(function(j){if(!j.hasClass("yui-skip")&&j.get("innerHTML")===""){j.remove();}else{j.removeClass("yui-non").removeClass("yui-skip");}});i=b.all("body [id]");i.each(function(j){if(j.get("id").indexOf("yui_3_")===0){j.removeAttribute("id");j.removeAttribute("_yuid");}});if(e){h=e.get("innerHTML");}b.all(".hr").addClass("yui-skip").addClass("yui-non");return h;};b.Selection.resolve=function(f){if(f&&f.nodeType===3){try{f=f.parentNode;}catch(e){f="body";}}return b.one(f);};b.Selection.getText=function(f){var e=f.get("innerHTML").replace(b.Selection.REG_NOHTML,"");e=e.replace("<span><br></span>","").replace("<br>","");return e;};b.Selection.DEFAULT_BLOCK_TAG="p";b.Selection.ALL="[style],font[face]";b.Selection.BLOCKS="p,div,ul,ol,table,style";b.Selection.TMP="yui-tmp";b.Selection.DEFAULT_TAG="span";b.Selection.CURID="yui-cursor";b.Selection.CUR_WRAPID="yui-cursor-wrapper";b.Selection.CURSOR='<span><br class="yui-cursor"></span>';b.Selection.hasCursor=function(){var e=b.all("#"+b.Selection.CUR_WRAPID);return e.size();};b.Selection.cleanCursor=function(){var f,e="br.yui-cursor";f=b.all(e);if(f.size()){f.each(function(g){var i=g.get("parentNode.parentNode.childNodes"),h;if(i.size()){g.remove();}else{h=b.Selection.getText(i.item(0));if(h!==""){g.remove();}}});}};b.Selection.prototype={text:null,isCollapsed:null,anchorNode:null,anchorOffset:null,anchorTextNode:null,focusNode:null,focusOffset:null,focusTextNode:null,_selection:null,_wrap:function(g,e){var f=b.Node.create("<"+e+"></"+e+">");f.set(d,g.get(d));g.set(d,"");g.append(f);return b.Node.getDOMNode(f);},_swap:function(g,e){var f=b.Node.create("<"+e+"></"+e+">");f.set(d,g.get(d));g.replace(f,g);return b.Node.getDOMNode(f);},getSelected:function(){b.Selection.filter();b.config.doc.execCommand("fontname",null,b.Selection.TMP);var f=b.all(b.Selection.ALL),e=[];f.each(function(h,g){if(h.getStyle(c)==b.Selection.TMP){h.setStyle(c,"");b.Selection.removeFontFamily(h);if(!h.test("body")){e.push(b.Node.getDOMNode(f.item(g)));}}});return b.all(e);},insertContent:function(e){return this.insertAtCursor(e,this.anchorTextNode,this.anchorOffset,true);},insertAtCursor:function(l,g,i,o){var q=b.Node.create("<"+b.Selection.DEFAULT_TAG+' class="yui-non"></'+b.Selection.DEFAULT_TAG+">"),f,j,h,p,k=this.createRange(),n;if(g&&g.test("body")){n=b.Node.create("<span></span>");g.append(n);g=n;}if(k.pasteHTML){if(i===0&&g&&!g.previous()&&g.get("nodeType")===3){g.insert(l,"before");if(k.moveToElementText){k.moveToElementText(b.Node.getDOMNode(g.previous()));}k.collapse(false);k.select();return g.previous();}else{p=b.Node.create(l);try{k.pasteHTML('<span id="rte-insert"></span>');}catch(m){}f=b.one("#rte-insert");if(f){f.set("id","");f.replace(p);if(k.moveToElementText){k.moveToElementText(b.Node.getDOMNode(p));}k.collapse(false);k.select();return p;}else{b.on("available",function(){f.set("id","");f.replace(p);if(k.moveToElementText){k.moveToElementText(b.Node.getDOMNode(p));}k.collapse(false);k.select();},"#rte-insert");}}}else{if(i>0){f=g.get(a);j=b.one(b.config.doc.createTextNode(f.substr(0,i)));h=b.one(b.config.doc.createTextNode(f.substr(i)));
g.replace(j,g);p=b.Node.create(l);if(p.get("nodeType")===11){n=b.Node.create("<span></span>");n.append(p);p=n;}j.insert(p,"after");if(h){p.insert(q,"after");q.insert(h,"after");this.selectNode(q,o);}}else{if(g.get("nodeType")===3){g=g.get("parentNode");}p=b.Node.create(l);l=g.get("innerHTML").replace(/\n/gi,"");if(l===""||l==="<br>"){g.append(p);}else{if(p.get("parentNode")){g.insert(p,"before");}else{b.one("body").prepend(p);}}if(g.get("firstChild").test("br")){g.get("firstChild").remove();}}}return p;},wrapContent:function(f){f=(f)?f:b.Selection.DEFAULT_TAG;if(!this.isCollapsed){var h=this.getSelected(),k=[],g,i,j,e;h.each(function(o,l){var m=o.get("tagName").toLowerCase();if(m==="font"){k.push(this._swap(h.item(l),f));}else{k.push(this._wrap(h.item(l),f));}},this);g=this.createRange();j=k[0];i=k[k.length-1];if(this._selection.removeAllRanges){g.setStart(k[0],0);g.setEnd(i,i.childNodes.length);this._selection.removeAllRanges();this._selection.addRange(g);}else{if(g.moveToElementText){g.moveToElementText(b.Node.getDOMNode(j));e=this.createRange();e.moveToElementText(b.Node.getDOMNode(i));g.setEndPoint("EndToEnd",e);}g.select();}k=b.all(k);return k;}else{return b.all([]);}},replace:function(k,i){var f=this.createRange(),j,e,g,h;if(f.getBookmark){g=f.getBookmark();e=this.anchorNode.get("innerHTML").replace(k,i);this.anchorNode.set("innerHTML",e);f.moveToBookmark(g);h=b.one(f.parentElement());}else{j=this.anchorTextNode;e=j.get(a);g=e.indexOf(k);e=e.replace(k,"");j.set(a,e);h=this.insertAtCursor(i,j,g,true);}return h;},remove:function(){this._selection.removeAllRanges();return this;},createRange:function(){if(b.config.doc.selection){return b.config.doc.selection.createRange();}else{return b.config.doc.createRange();}},selectNode:function(i,k,f){if(!i){return;}f=f||0;i=b.Node.getDOMNode(i);var g=this.createRange();if(g.selectNode){g.selectNode(i);this._selection.removeAllRanges();this._selection.addRange(g);if(k){try{this._selection.collapse(i,f);}catch(h){this._selection.collapse(i,0);}}}else{if(i.nodeType===3){i=i.parentNode;}try{g.moveToElementText(i);}catch(j){}if(k){g.collapse(((f)?false:true));}g.select();}return this;},setCursor:function(){this.removeCursor(false);return this.insertContent(b.Selection.CURSOR);},getCursor:function(){return b.all("#"+b.Selection.CURID);},removeCursor:function(e){var f=this.getCursor();if(f){if(e){f.removeAttribute("id");f.set("innerHTML",'<br class="yui-cursor">');}else{f.remove();}}return f;},focusCursor:function(g,e){if(g!==false){g=true;}if(e!==false){e=true;}var f=this.removeCursor(true);if(f){f.each(function(h){this.selectNode(h,g,e);},this);}},toString:function(){return"Selection Object";}};},"@VERSION@",{skinnable:false,requires:["node"]});YUI.add("exec-command",function(b){var a=function(){a.superclass.constructor.apply(this,arguments);};b.extend(a,b.Base,{_lastKey:null,_inst:null,command:function(f,e){var d=a.COMMANDS[f];if(d){return d.call(this,f,e);}else{return this._command(f,e);}},_command:function(g,f){var d=this.getInstance();try{try{d.config.doc.execCommand("styleWithCSS",null,1);}catch(j){try{d.config.doc.execCommand("useCSS",null,0);}catch(i){}}d.config.doc.execCommand(g,null,f);}catch(h){}},getInstance:function(){if(!this._inst){this._inst=this.get("host").getInstance();}return this._inst;},initializer:function(){b.mix(this.get("host"),{execCommand:function(e,d){return this.exec.command(e,d);},_execCommand:function(e,d){return this.exec._command(e,d);}});this.get("host").on("dom:keypress",b.bind(function(d){this._lastKey=d.keyCode;},this));}},{NAME:"execCommand",NS:"exec",ATTRS:{host:{value:false}},COMMANDS:{wrap:function(f,d){var e=this.getInstance();return(new e.Selection()).wrapContent(d);},inserthtml:function(f,d){var e=this.getInstance();if(e.Selection.hasCursor()||b.UA.ie){return(new e.Selection()).insertContent(d);}else{this._command("inserthtml",d);}},insertandfocus:function(h,e){var g=this.getInstance(),d,f;if(g.Selection.hasCursor()){e+=g.Selection.CURSOR;d=this.command("inserthtml",e);f=new g.Selection();f.focusCursor(true,true);}else{this.command("inserthtml",e);}return d;},insertbr:function(j){var i=this.getInstance(),h=new i.Selection(),d="<var>|</var>",e=null,g=(b.UA.webkit)?"span.Apple-style-span,var":"var";if(h._selection.pasteHTML){h._selection.pasteHTML(d);}else{this._command("inserthtml",d);}var f=function(l){var k=i.Node.create("<br>");l.insert(k,"before");return k;};i.all(g).each(function(m){var l=true;if(b.UA.webkit){l=false;if(m.get("innerHTML")==="|"){l=true;}}if(l){e=f(m);if((!e.previous()||!e.previous().test("br"))&&b.UA.gecko){var k=e.cloneNode();e.insert(k,"after");e=k;}m.remove();}});if(b.UA.webkit&&e){f(e);h.selectNode(e);}},insertimage:function(e,d){return this.command("inserthtml",'<img src="'+d+'">');},addclass:function(f,d){var e=this.getInstance();return(new e.Selection()).getSelected().addClass(d);},removeclass:function(f,d){var e=this.getInstance();return(new e.Selection()).getSelected().removeClass(d);},forecolor:function(f,g){var e=this.getInstance(),d=new e.Selection(),h;if(!b.UA.ie){this._command("useCSS",false);}if(e.Selection.hasCursor()){if(d.isCollapsed){if(d.anchorNode&&(d.anchorNode.get("innerHTML")==="&nbsp;")){d.anchorNode.setStyle("color",g);h=d.anchorNode;}else{h=this.command("inserthtml",'<span style="color: '+g+'">'+e.Selection.CURSOR+"</span>");d.focusCursor(true,true);}return h;}else{return this._command(f,g);}}else{this._command(f,g);}},backcolor:function(f,g){var e=this.getInstance(),d=new e.Selection(),h;if(b.UA.gecko||b.UA.opera){f="hilitecolor";}if(!b.UA.ie){this._command("useCSS",false);}if(e.Selection.hasCursor()){if(d.isCollapsed){if(d.anchorNode&&(d.anchorNode.get("innerHTML")==="&nbsp;")){d.anchorNode.setStyle("backgroundColor",g);h=d.anchorNode;}else{h=this.command("inserthtml",'<span style="background-color: '+g+'">'+e.Selection.CURSOR+"</span>");d.focusCursor(true,true);}return h;}else{return this._command(f,g);}}else{this._command(f,g);}},hilitecolor:function(){return a.COMMANDS.backcolor.apply(this,arguments);
},fontname2:function(f,g){this._command("fontname",g);var e=this.getInstance(),d=new e.Selection();if(d.isCollapsed&&(this._lastKey!=32)){if(d.anchorNode.test("font")){d.anchorNode.set("face",g);}}},fontsize2:function(f,h){this._command("fontsize",h);var e=this.getInstance(),d=new e.Selection();if(d.isCollapsed&&d.anchorNode&&(this._lastKey!=32)){if(b.UA.webkit){if(d.anchorNode.getStyle("lineHeight")){d.anchorNode.setStyle("lineHeight","");}}if(d.anchorNode.test("font")){d.anchorNode.set("size",h);}else{if(b.UA.gecko){var g=d.anchorNode.ancestor(e.Selection.DEFAULT_BLOCK_TAG);if(g){g.setStyle("fontSize","");}}}}},insertunorderedlist:function(d){this.command("list","ul");},insertorderedlist:function(d){this.command("list","ol");},list:function(v,z){var f=this.getInstance(),h,u="dir",e="yui3-touched",m,k,l,g,o,q,i,j,x,d,t=(f.host.editorPara?true:false),r=new f.Selection();v="insert"+((z==="ul")?"un":"")+"orderedlist";if(b.UA.ie&&!r.isCollapsed){k=r._selection;h=k.htmlText;l=f.Node.create(h);if(l.test("li")||l.one("li")){this._command(v,null);return;}if(l.test(z)){g=k.item?k.item(0):k.parentElement();o=f.one(g);d=o.all("li");q="<div>";d.each(function(n){if(t){q+="<p>"+n.get("innerHTML")+"</p>";}else{q+=n.get("innerHTML")+"<br>";}});q+="</div>";i=f.Node.create(q);if(o.get("parentNode").test("div")){o=o.get("parentNode");}if(o&&o.hasAttribute(u)){if(t){i.all("p").setAttribute(u,o.getAttribute(u));}else{i.setAttribute(u,o.getAttribute(u));}}if(t){o.replace(i.get("innerHTML"));}else{o.replace(i);}if(k.moveToElementText){k.moveToElementText(i._node);}k.select();}else{j=b.one(k.parentElement());if(!j.test(f.Selection.BLOCKS)){j=j.ancestor(f.Selection.BLOCKS);}if(j){if(j.hasAttribute(u)){m=j.getAttribute(u);}}if(h.indexOf("<br>")>-1){h=h.split(/<br>/i);}else{var y=f.Node.create(h),p=y.all("p");if(p.size()){h=[];p.each(function(s){h.push(s.get("innerHTML"));});}else{h=[h];}}x="<"+z+' id="ie-list">';b.each(h,function(s){var n=f.Node.create(s);if(n.test("p")){if(n.hasAttribute(u)){m=n.getAttribute(u);}s=n.get("innerHTML");}x+="<li>"+s+"</li>";});x+="</"+z+">";k.pasteHTML(x);g=f.config.doc.getElementById("ie-list");g.id="";if(m){g.setAttribute(u,m);}if(k.moveToElementText){k.moveToElementText(g);}k.select();}}else{if(b.UA.ie){j=f.one(r._selection.parentElement());if(j.test("p")){if(j&&j.hasAttribute(u)){m=j.getAttribute(u);}h=b.Selection.getText(j);if(h===""){var w="";if(m){w=' dir="'+m+'"';}x=f.Node.create(b.Lang.sub("<{tag}{dir}><li></li></{tag}>",{tag:z,dir:w}));j.replace(x);r.selectNode(x.one("li"));}else{this._command(v,null);}}else{this._command(v,null);}}else{f.all(z).addClass(e);if(r.anchorNode.test(f.Selection.BLOCKS)){j=r.anchorNode;}else{j=r.anchorNode.ancestor(f.Selection.BLOCKS);}if(!j){j=r.anchorNode.one(f.Selection.BLOCKS);}if(j&&j.hasAttribute(u)){m=j.getAttribute(u);}if(j&&j.test(z)){h=f.Node.create("<div/>");g=j.all("li");g.each(function(n){if(t){h.append("<p>"+n.get("innerHTML")+"</p>");}else{h.append(n.get("innerHTML")+"<br>");}});if(m){if(t){h.all("p").setAttribute(u,m);}else{h.setAttribute(u,m);}}if(t){j.replace(h.get("innerHTML"));}else{j.replace(h);}r.selectNode(h.get("firstChild"));}else{this._command(v,null);}x=f.all(z);if(m){if(x.size()){x.each(function(s){if(!s.hasClass(e)){s.setAttribute(u,m);}});}}x.removeClass(e);}}},justify:function(i,j){if(b.UA.webkit){var h=this.getInstance(),g=new h.Selection(),d=g.anchorNode;var f=d.getStyle("backgroundColor");this._command(j);g=new h.Selection();if(g.anchorNode.test("div")){var e="<span>"+g.anchorNode.get("innerHTML")+"</span>";g.anchorNode.set("innerHTML",e);g.anchorNode.one("span").setStyle("backgroundColor",f);g.selectNode(g.anchorNode.one("span"));}}else{this._command(j);}},justifycenter:function(d){this.command("justify","justifycenter");},justifyleft:function(d){this.command("justify","justifyleft");},justifyright:function(d){this.command("justify","justifyright");},justifyfull:function(d){this.command("justify","justifyfull");}}});var c=function(j,v,r){var k=this.getInstance(),t=k.config.doc,h=t.selection.createRange(),g=t.queryCommandValue(j),l,f,i,e,n,u,q;if(g){l=h.htmlText;f=new RegExp(r,"g");i=l.match(f);if(i){l=l.replace(r+";","").replace(r,"");h.pasteHTML('<var id="yui-ie-bs">');e=t.getElementById("yui-ie-bs");n=t.createElement("div");u=t.createElement(v);n.innerHTML=l;if(e.parentNode!==k.config.doc.body){e=e.parentNode;}q=n.childNodes;e.parentNode.replaceChild(u,e);b.each(q,function(d){u.appendChild(d);});h.collapse();if(h.moveToElementText){h.moveToElementText(u);}h.select();}}this._command(j);};if(b.UA.ie){a.COMMANDS.bold=function(){c.call(this,"bold","b","FONT-WEIGHT: bold");};a.COMMANDS.italic=function(){c.call(this,"italic","i","FONT-STYLE: italic");};a.COMMANDS.underline=function(){c.call(this,"underline","u","TEXT-DECORATION: underline");};}b.namespace("Plugin");b.Plugin.ExecCommand=a;},"@VERSION@",{skinnable:false,requires:["frame"]});YUI.add("editor-tab",function(c){var b=function(){b.superclass.constructor.apply(this,arguments);},a="host";c.extend(b,c.Base,{_onNodeChange:function(f){var d="indent";if(f.changedType==="tab"){if(!f.changedNode.test("li, li *")){f.changedEvent.halt();f.preventDefault();if(f.changedEvent.shiftKey){d="outdent";}this.get(a).execCommand(d,"");}}},initializer:function(){this.get(a).on("nodeChange",c.bind(this._onNodeChange,this));}},{NAME:"editorTab",NS:"tab",ATTRS:{host:{value:false}}});c.namespace("Plugin");c.Plugin.EditorTab=b;},"@VERSION@",{skinnable:false,requires:["editor-base"]});YUI.add("createlink-base",function(b){var a={};a.STRINGS={PROMPT:"Please enter the URL for the link to point to:",DEFAULT:"http://"};b.namespace("Plugin");b.Plugin.CreateLinkBase=a;b.mix(b.Plugin.ExecCommand.COMMANDS,{createlink:function(i){var h=this.get("host").getInstance(),e,c,g,f,d=prompt(a.STRINGS.PROMPT,a.STRINGS.DEFAULT);if(d){f=h.config.doc.createElement("div");d=d.replace(/"/g,"").replace(/'/g,"");d=h.config.doc.createTextNode(d);f.appendChild(d);d=f.innerHTML;this.get("host")._execCommand(i,d);
g=new h.Selection();e=g.getSelected();if(!g.isCollapsed&&e.size()){c=e.item(0).one("a");if(c){e.item(0).replace(c);}if(b.UA.gecko){if(c.get("parentNode").test("span")){if(c.get("parentNode").one("br.yui-cursor")){c.get("parentNode").insert(c,"before");}}}}else{this.get("host").execCommand("inserthtml",'<a href="'+d+'">'+d+"</a>");}}return c;}});},"@VERSION@",{skinnable:false,requires:["editor-base"]});YUI.add("editor-base",function(d){var c=function(){c.superclass.constructor.apply(this,arguments);},b=":last-child",a="body";d.extend(c,d.Base,{frame:null,initializer:function(){var e=new d.Frame({designMode:true,title:c.STRINGS.title,use:c.USE,dir:this.get("dir"),extracss:this.get("extracss"),linkedcss:this.get("linkedcss"),defaultblock:this.get("defaultblock"),host:this}).plug(d.Plugin.ExecCommand);e.after("ready",d.bind(this._afterFrameReady,this));e.addTarget(this);this.frame=e;this.publish("nodeChange",{emitFacade:true,bubbles:true,defaultFn:this._defNodeChangeFn});},destructor:function(){this.frame.destroy();this.detachAll();},copyStyles:function(h,g){if(h.test("a")){return;}var e=["color","fontSize","fontFamily","backgroundColor","fontStyle"],f={};d.each(e,function(i){f[i]=h.getStyle(i);});if(h.ancestor("b,strong")){f.fontWeight="bold";}if(h.ancestor("u")){if(!f.textDecoration){f.textDecoration="underline";}}g.setStyles(f);},_lastBookmark:null,_resolveChangedNode:function(i){var h=this.getInstance(),f,e,g;if(h&&i&&i.test("html")){f=h.one(a).one(b);while(!g){if(f){e=f.one(b);if(e){f=e;}else{g=true;}}else{g=true;}}if(f){if(f.test("br")){if(f.previous()){f=f.previous();}else{f=f.get("parentNode");}}if(f){i=f;}}}if(!i){i=h.one(a);}return i;},_defNodeChangeFn:function(t){var j=(new Date()).getTime();var q=this.getInstance(),i,u,p=q.Selection.DEFAULT_BLOCK_TAG;if(d.UA.ie){try{i=q.config.doc.selection.createRange();if(i.getBookmark){this._lastBookmark=i.getBookmark();}}catch(g){}}t.changedNode=this._resolveChangedNode(t.changedNode);switch(t.changedType){case"keydown":if(!d.UA.gecko){if(!c.NC_KEYS[t.changedEvent.keyCode]&&!t.changedEvent.shiftKey&&!t.changedEvent.ctrlKey&&(t.changedEvent.keyCode!==13)){}}break;case"tab":if(!t.changedNode.test("li, li *")&&!t.changedEvent.shiftKey){t.changedEvent.frameEvent.preventDefault();if(d.UA.webkit){this.execCommand("inserttext","\t");}else{if(d.UA.gecko){this.frame.exec._command("inserthtml",c.TABKEY);}else{if(d.UA.ie){this.execCommand("inserthtml",c.TABKEY);}}}}break;case"backspace-up":if(d.UA.webkit&&t.changedNode){t.changedNode.set("innerHTML",t.changedNode.get("innerHTML"));}break;}if(d.UA.webkit&&t.commands&&(t.commands.indent||t.commands.outdent)){var v=q.all(".webkit-indent-blockquote");if(v.size()){v.setStyle("margin","");}}var o=this.getDomPath(t.changedNode,false),f={},n,h,l=[],m="",k="";if(t.commands){f=t.commands;}var s=false;d.each(o,function(A){var w=A.tagName.toLowerCase(),B=c.TAG2CMD[w];if(B){f[B]=1;}var z=A.currentStyle||A.style;if((""+z.fontWeight)=="normal"){s=true;}if((""+z.fontWeight)=="bold"){f.bold=1;}if(d.UA.ie){if(z.fontWeight>400){f.bold=1;}}if(z.fontStyle=="italic"){f.italic=1;}if(z.textDecoration=="underline"){f.underline=1;}if(z.textDecoration=="line-through"){f.strikethrough=1;}var C=q.one(A);if(C.getStyle("fontFamily")){var y=C.getStyle("fontFamily").split(",")[0].toLowerCase();if(y){n=y;}if(n){n=n.replace(/'/g,"").replace(/"/g,"");}}h=c.NORMALIZE_FONTSIZE(C);var x=A.className.split(" ");d.each(x,function(D){if(D!==""&&(D.substr(0,4)!=="yui_")){l.push(D);}});m=c.FILTER_RGB(C.getStyle("color"));var e=c.FILTER_RGB(z.backgroundColor);if(e!=="transparent"){if(e!==""){k=e;}}});if(s){delete f.bold;delete f.italic;}t.dompath=q.all(o);t.classNames=l;t.commands=f;if(!t.fontFamily){t.fontFamily=n;}if(!t.fontSize){t.fontSize=h;}if(!t.fontColor){t.fontColor=m;}if(!t.backgroundColor){t.backgroundColor=k;}var r=(new Date()).getTime();},getDomPath:function(g,e){var i=[],f,h=this.frame.getInstance();f=h.Node.getDOMNode(g);while(f!==null){if((f===h.config.doc.documentElement)||(f===h.config.doc)||!f.tagName){f=null;break;}if(!h.DOM.inDoc(f)){f=null;break;}if(f.nodeName&&f.nodeType&&(f.nodeType==1)){i.push(f);}if(f==h.config.doc.body){f=null;break;}f=f.parentNode;}if(i.length===0){i[0]=h.config.doc.body;}if(e){return h.all(i.reverse());}else{return i.reverse();}},_afterFrameReady:function(){var e=this.frame.getInstance();this.frame.on("dom:mouseup",d.bind(this._onFrameMouseUp,this));this.frame.on("dom:mousedown",d.bind(this._onFrameMouseDown,this));this.frame.on("dom:keydown",d.bind(this._onFrameKeyDown,this));if(d.UA.ie){this.frame.on("dom:activate",d.bind(this._onFrameActivate,this));this.frame.on("dom:beforedeactivate",d.bind(this._beforeFrameDeactivate,this));}this.frame.on("dom:keyup",d.bind(this._onFrameKeyUp,this));this.frame.on("dom:keypress",d.bind(this._onFrameKeyPress,this));this.frame.on("dom:paste",d.bind(this._onPaste,this));e.Selection.filter();this.fire("ready");},_beforeFrameDeactivate:function(h){if(h.frameTarget.test("html")){return;}var g=this.getInstance(),f=g.config.doc.selection.createRange();if(f.compareEndPoints&&!f.compareEndPoints("StartToEnd",f)){f.pasteHTML('<var id="yui-ie-cursor">');}},_onFrameActivate:function(i){if(i.frameTarget.test("html")){return;}var h=this.getInstance(),g=new h.Selection(),f=g.createRange(),j=h.all("#yui-ie-cursor");if(j.size()){j.each(function(m){m.set("id","");if(f.moveToElementText){try{f.moveToElementText(m._node);var k=f.move("character",-1);if(k===-1){f.move("character",1);}f.select();f.text="";}catch(l){}}m.remove();});}},_onPaste:function(f){this.fire("nodeChange",{changedNode:f.frameTarget,changedType:"paste",changedEvent:f.frameEvent});},_onFrameMouseUp:function(f){this.fire("nodeChange",{changedNode:f.frameTarget,changedType:"mouseup",changedEvent:f.frameEvent});},_onFrameMouseDown:function(f){this.fire("nodeChange",{changedNode:f.frameTarget,changedType:"mousedown",changedEvent:f.frameEvent});},_currentSelection:null,_currentSelectionTimer:null,_currentSelectionClear:null,_onFrameKeyDown:function(h){var g,f;
if(!this._currentSelection){if(this._currentSelectionTimer){this._currentSelectionTimer.cancel();}this._currentSelectionTimer=d.later(850,this,function(){this._currentSelectionClear=true;});g=this.frame.getInstance();f=new g.Selection(h);this._currentSelection=f;}else{f=this._currentSelection;}g=this.frame.getInstance();f=new g.Selection();this._currentSelection=f;if(f&&f.anchorNode){this.fire("nodeChange",{changedNode:f.anchorNode,changedType:"keydown",changedEvent:h.frameEvent});if(c.NC_KEYS[h.keyCode]){this.fire("nodeChange",{changedNode:f.anchorNode,changedType:c.NC_KEYS[h.keyCode],changedEvent:h.frameEvent});this.fire("nodeChange",{changedNode:f.anchorNode,changedType:c.NC_KEYS[h.keyCode]+"-down",changedEvent:h.frameEvent});}}},_onFrameKeyPress:function(g){var f=this._currentSelection;if(f&&f.anchorNode){this.fire("nodeChange",{changedNode:f.anchorNode,changedType:"keypress",changedEvent:g.frameEvent});if(c.NC_KEYS[g.keyCode]){this.fire("nodeChange",{changedNode:f.anchorNode,changedType:c.NC_KEYS[g.keyCode]+"-press",changedEvent:g.frameEvent});}}},_onFrameKeyUp:function(h){var g=this.frame.getInstance(),f=new g.Selection(h);if(f&&f.anchorNode){this.fire("nodeChange",{changedNode:f.anchorNode,changedType:"keyup",selection:f,changedEvent:h.frameEvent});if(c.NC_KEYS[h.keyCode]){this.fire("nodeChange",{changedNode:f.anchorNode,changedType:c.NC_KEYS[h.keyCode]+"-up",selection:f,changedEvent:h.frameEvent});}}if(this._currentSelectionClear){this._currentSelectionClear=this._currentSelection=null;}},execCommand:function(j,l){var g=this.frame.execCommand(j,l),i=this.frame.getInstance(),h=new i.Selection(),f={},k={changedNode:h.anchorNode,changedType:"execcommand",nodes:g};switch(j){case"forecolor":k.fontColor=l;break;case"backcolor":k.backgroundColor=l;break;case"fontsize":k.fontSize=l;break;case"fontname":k.fontFamily=l;break;}f[j]=1;k.commands=f;this.fire("nodeChange",k);return g;},getInstance:function(){return this.frame.getInstance();},render:function(e){this.frame.set("content",this.get("content"));this.frame.render(e);return this;},focus:function(e){this.frame.focus(e);return this;},show:function(){this.frame.show();return this;},hide:function(){this.frame.hide();return this;},getContent:function(){var e="",f=this.getInstance();if(f&&f.Selection){e=f.Selection.unfilter();}e=e.replace(/ _yuid="([^>]*)"/g,"");return e;}},{NORMALIZE_FONTSIZE:function(g){var e=g.getStyle("fontSize"),f=e;switch(e){case"-webkit-xxx-large":e="48px";break;case"xx-large":e="32px";break;case"x-large":e="24px";break;case"large":e="18px";break;case"medium":e="16px";break;case"small":e="13px";break;case"x-small":e="10px";break;}if(f!==e){g.setStyle("fontSize",e);}return e;},TABKEY:'<span class="tab">&nbsp;&nbsp;&nbsp;&nbsp;</span>',FILTER_RGB:function(h){if(h.toLowerCase().indexOf("rgb")!=-1){var k=new RegExp("(.*?)rgb\\s*?\\(\\s*?([0-9]+).*?,\\s*?([0-9]+).*?,\\s*?([0-9]+).*?\\)(.*?)","gi");var f=h.replace(k,"$1,$2,$3,$4,$5").split(",");if(f.length==5){var j=parseInt(f[1],10).toString(16);var i=parseInt(f[2],10).toString(16);var e=parseInt(f[3],10).toString(16);j=j.length==1?"0"+j:j;i=i.length==1?"0"+i:i;e=e.length==1?"0"+e:e;h="#"+j+i+e;}}return h;},TAG2CMD:{"b":"bold","strong":"bold","i":"italic","em":"italic","u":"underline","sup":"superscript","sub":"subscript","img":"insertimage","a":"createlink","ul":"insertunorderedlist","ol":"insertorderedlist"},NC_KEYS:{8:"backspace",9:"tab",13:"enter",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",46:"delete"},USE:["substitute","node","selector-css3","selection","stylesheet"],NAME:"editorBase",STRINGS:{title:"Rich Text Editor"},ATTRS:{content:{value:'<br class="yui-cursor">',setter:function(e){if(e.substr(0,1)==="\n"){e=e.substr(1);}if(e===""){e='<br class="yui-cursor">';}if(e===" "){if(d.UA.gecko){e='<br class="yui-cursor">';}}return this.frame.set("content",e);},getter:function(){return this.frame.get("content");}},dir:{writeOnce:true,value:"ltr"},linkedcss:{value:"",setter:function(e){if(this.frame){this.frame.set("linkedcss",e);}return e;}},extracss:{value:false,setter:function(e){if(this.frame){this.frame.set("extracss",e);}return e;}},defaultblock:{value:"p"}}});d.EditorBase=c;},"@VERSION@",{skinnable:false,requires:["base","frame","node","exec-command","selection"]});YUI.add("editor-lists",function(f){var e=function(){e.superclass.constructor.apply(this,arguments);},b="li",c="ol",d="ul",a="host";f.extend(e,f.Base,{_onNodeChange:function(l){var j=this.get(a).getInstance(),g,o,p,h,i,m,n=false,q,k=false;if(l.changedType==="tab"){if(l.changedNode.test(b+", "+b+" *")){l.changedEvent.halt();l.preventDefault();o=l.changedNode;i=l.changedEvent.shiftKey;m=o.ancestor(c+","+d);q=d;if(m.get("tagName").toLowerCase()===c){q=c;}if(!o.test(b)){o=o.ancestor(b);}if(i){if(o.ancestor(b)){o.ancestor(b).insert(o,"after");n=true;k=true;}}else{if(o.previous(b)){h=j.Node.create("<"+q+"></"+q+">");o.previous(b).append(h);h.append(o);n=true;}}}if(n){if(!o.test(b)){o=o.ancestor(b);}o.all(e.REMOVE).remove();if(f.UA.ie){o=o.append(e.NON).one(e.NON_SEL);}(new j.Selection()).selectNode(o,true,k);}}},initializer:function(){this.get(a).on("nodeChange",f.bind(this._onNodeChange,this));}},{NON:'<span class="yui-non">&nbsp;</span>',NON_SEL:"span.yui-non",REMOVE:"br",NAME:"editorLists",NS:"lists",ATTRS:{host:{value:false}}});f.namespace("Plugin");f.Plugin.EditorLists=e;},"@VERSION@",{skinnable:false,requires:["editor-base"]});YUI.add("editor-bidi",function(a){var b=function(){b.superclass.constructor.apply(this,arguments);},i="host",h="dir",f="BODY",d="nodeChange",e="bidiContextChange",c=f+" > p",g="style";a.extend(b,a.Base,{lastDirection:null,firstEvent:null,_checkForChange:function(){var k=this.get(i),m=k.getInstance(),l=new m.Selection(),j,n;if(l.isCollapsed){j=b.blockParent(l.focusNode);if(j){n=j.getStyle("direction");if(n!==this.lastDirection){k.fire(e,{changedTo:n});this.lastDirection=n;}}}else{k.fire(e,{changedTo:"select"});this.lastDirection=null;}},_afterNodeChange:function(j){if(this.firstEvent||b.EVENTS[j.changedType]){this._checkForChange();
this.firstEvent=false;}},_afterMouseUp:function(j){this._checkForChange();this.firstEvent=false;},initializer:function(){var j=this.get(i);this.firstEvent=true;j.after(d,a.bind(this._afterNodeChange,this));j.after("dom:mouseup",a.bind(this._afterMouseUp,this));}},{EVENTS:{"backspace-up":true,"pageup-up":true,"pagedown-down":true,"end-up":true,"home-up":true,"left-up":true,"up-up":true,"right-up":true,"down-up":true,"delete-up":true},BLOCKS:a.Selection.BLOCKS,DIV_WRAPPER:"<DIV></DIV>",blockParent:function(l,k){var j=l,n,m;if(!j){j=a.one(f);}if(!j.test(b.BLOCKS)){j=j.ancestor(b.BLOCKS);}if(k&&j.test(f)){n=a.Node.create(b.DIV_WRAPPER);j.get("children").each(function(p,o){if(o===0){m=p;}else{n.append(p);}});m.replace(n);n.prepend(m);j=n;}return j;},_NODE_SELECTED:"bidiSelected",addParents:function(m){var j,l,k;for(j=0;j<m.length;j+=1){m[j].setData(b._NODE_SELECTED,true);}for(j=0;j<m.length;j+=1){l=m[j].get("parentNode");if(!l.test(f)&&!l.getData(b._NODE_SELECTED)){k=true;l.get("children").some(function(n){if(!n.getData(b._NODE_SELECTED)){k=false;return true;}});if(k){m.push(l);l.setData(b._NODE_SELECTED,true);}}}for(j=0;j<m.length;j+=1){m[j].clearData(b._NODE_SELECTED);}return m;},NAME:"editorBidi",NS:"editorBidi",ATTRS:{host:{value:false}},RE_TEXT_ALIGN:/text-align:\s*\w*\s*;/,removeTextAlign:function(j){if(j){if(j.getAttribute(g).match(b.RE_TEXT_ALIGN)){j.setAttribute(g,j.getAttribute(g).replace(b.RE_TEXT_ALIGN,""));}if(j.hasAttribute("align")){j.removeAttribute("align");}}return j;}});a.namespace("Plugin");a.Plugin.EditorBidi=b;a.Plugin.ExecCommand.COMMANDS.bidi=function(m,s){var p=this.getInstance(),k=new p.Selection(),r=this.get(i).get(i).editorBidi,j,n,o,t,l;if(!r){a.error("bidi execCommand is not available without the EditorBiDi plugin.");return;}p.Selection.filterBlocks();if(k.isCollapsed){n=b.blockParent(k.anchorNode);if(!n){n=p.one("body").one(p.Selection.BLOCKS);}n=b.removeTextAlign(n);if(!s){l=n.getAttribute(h);if(!l||l=="ltr"){s="rtl";}else{s="ltr";}}n.setAttribute(h,s);if(a.UA.ie){var q=n.all("br.yui-cursor");if(q.size()===1&&n.get("childNodes").size()==1){q.remove();}}j=n;}else{o=k.getSelected();t=[];o.each(function(u){t.push(b.blockParent(u));});t=p.all(b.addParents(t));t.each(function(v){var u=s;v=b.removeTextAlign(v);if(!u){l=v.getAttribute(h);if(!l||l=="ltr"){u="rtl";}else{u="ltr";}}v.setAttribute(h,u);});j=t;}r._checkForChange();return j;};},"@VERSION@",{skinnable:false,requires:["editor-base"]});YUI.add("editor-para",function(a){var d=function(){d.superclass.constructor.apply(this,arguments);},k="host",f="body",c="nodeChange",j="parentNode",b=f+" > p",h="p",g="<br>",i="firstChild",e="li";a.extend(d,a.Base,{_fixFirstPara:function(){var p=this.get(k),r=p.getInstance(),q,s,l=r.config.doc.body,o=l.innerHTML,m=((o.length)?true:false);if(o===g){o="";m=false;}l.innerHTML="<"+h+">"+o+r.Selection.CURSOR+"</"+h+">";s=r.one(b);q=new r.Selection();q.selectNode(s,true,m);},_onNodeChange:function(R){var F=this.get(k),q=F.getInstance(),x,D,C,T,O,H=q.Selection.DEFAULT_BLOCK_TAG,z,o,s,P,v,l,G,M,u,N,V,S,J,B,A,Q=":last-child";switch(R.changedType){case"enter-up":var m=((this._lastPara)?this._lastPara:R.changedNode),U=m.one("br.yui-cursor");if(this._lastPara){delete this._lastPara;}if(U){if(U.previous()||U.next()){if(U.ancestor(h)){U.remove();}}}if(!m.test(H)){var E=m.ancestor(H);if(E){m=E;E=null;}}if(m.test(H)){var I=m.previous(),L,w,y=false;if(I){L=I.one(Q);while(!y){if(L){w=L.one(Q);if(w){L=w;}else{y=true;}}else{y=true;}}if(L){F.copyStyles(L,m);}}}break;case"enter":if(a.UA.ie){if(R.changedNode.test("br")){R.changedNode.remove();}else{if(R.changedNode.test("p, span")){var U=R.changedNode.one("br.yui-cursor");if(U){U.remove();}}}}if(a.UA.webkit){if(R.changedEvent.shiftKey){F.execCommand("insertbr");R.changedEvent.preventDefault();}}if(R.changedNode.test("li")&&!a.UA.ie){x=q.Selection.getText(R.changedNode);if(x===""){C=R.changedNode.ancestor("ol,ul");var K=C.getAttribute("dir");if(K!==""){K=' dir = "'+K+'"';}C=R.changedNode.ancestor(q.Selection.BLOCKS);T=q.Node.create("<p"+K+">"+q.Selection.CURSOR+"</p>");C.insert(T,"after");R.changedNode.remove();R.changedEvent.halt();O=new q.Selection();O.selectNode(T,true,false);}}if(a.UA.gecko&&F.get("defaultblock")!=="p"){C=R.changedNode;if(!C.test(e)&&!C.ancestor(e)){if(!C.test(H)){C=C.ancestor(H);}T=q.Node.create("<"+H+"></"+H+">");C.insert(T,"after");O=new q.Selection();if(O.anchorOffset){z=O.anchorNode.get("textContent");D=q.one(q.config.doc.createTextNode(z.substr(0,O.anchorOffset)));o=q.one(q.config.doc.createTextNode(z.substr(O.anchorOffset)));P=O.anchorNode;P.setContent("");l=P.cloneNode();l.append(o);G=false;u=P;while(!G){u=u.get(j);if(u&&!u.test(H)){M=u.cloneNode();M.set("innerHTML","");M.append(l);s=u.get("childNodes");var r=false;s.each(function(n){if(r){M.append(n);}if(n===P){r=true;}});P=u;l=M;}else{G=true;}}o=l;O.anchorNode.append(D);if(o){T.append(o);}}if(T.get(i)){T=T.get(i);}T.prepend(q.Selection.CURSOR);O.focusCursor(true,true);x=q.Selection.getText(T);if(x!==""){q.Selection.cleanCursor();}R.changedEvent.preventDefault();}}break;case"keyup":if(a.UA.gecko){if(q.config.doc&&q.config.doc.body&&q.config.doc.body.innerHTML.length<20){if(!q.one(b)){this._fixFirstPara();}}}break;case"backspace-up":case"backspace-down":case"delete-up":if(!a.UA.ie){N=q.all(b);S=q.one(f);if(N.item(0)){S=N.item(0);}V=S.one("br");if(V){V.removeAttribute("id");V.removeAttribute("class");}D=q.Selection.getText(S);D=D.replace(/ /g,"").replace(/\n/g,"");B=S.all("img");if(D.length===0&&!B.size()){if(!S.test(h)){this._fixFirstPara();}J=null;if(R.changedNode&&R.changedNode.test(h)){J=R.changedNode;}if(!J&&F._lastPara&&F._lastPara.inDoc()){J=F._lastPara;}if(J&&!J.test(h)){J=J.ancestor(h);}if(J){if(!J.previous()&&J.get(j)&&J.get(j).test(f)){R.changedEvent.frameEvent.halt();}}}if(a.UA.webkit){if(R.changedNode){S=R.changedNode;if(S.test("li")&&(!S.previous()&&!S.next())){x=S.get("innerHTML").replace(g,"");if(x===""){if(S.get(j)){S.get(j).replace(q.Node.create(g));R.changedEvent.frameEvent.halt();
R.preventDefault();q.Selection.filterBlocks();}}}}}}if(a.UA.gecko){T=R.changedNode;A=q.config.doc.createTextNode(" ");T.appendChild(A);T.removeChild(A);}break;}if(a.UA.gecko){if(R.changedNode&&!R.changedNode.test(H)){J=R.changedNode.ancestor(H);if(J){this._lastPara=J;}}}},_afterEditorReady:function(){var m=this.get(k),n=m.getInstance(),l;if(n){n.Selection.filterBlocks();l=n.Selection.DEFAULT_BLOCK_TAG;b=f+" > "+l;h=l;}},_afterContentChange:function(){var l=this.get(k),m=l.getInstance();if(m&&m.Selection){m.Selection.filterBlocks();}},_afterPaste:function(){var l=this.get(k),n=l.getInstance(),m=new n.Selection();a.later(50,l,function(){n.Selection.filterBlocks();});},initializer:function(){var l=this.get(k);if(l.editorBR){a.error("Can not plug EditorPara and EditorBR at the same time.");return;}l.on(c,a.bind(this._onNodeChange,this));l.after("ready",a.bind(this._afterEditorReady,this));l.after("contentChange",a.bind(this._afterContentChange,this));if(a.Env.webkit){l.after("dom:paste",a.bind(this._afterPaste,this));}}},{NAME:"editorPara",NS:"editorPara",ATTRS:{host:{value:false}}});a.namespace("Plugin");a.Plugin.EditorPara=d;},"@VERSION@",{skinnable:false,requires:["editor-base"]});YUI.add("editor-br",function(c){var d=function(){d.superclass.constructor.apply(this,arguments);},a="host",b="li";c.extend(d,c.Base,{_onKeyDown:function(j){if(j.stopped){j.halt();return;}if(j.keyCode==13){var g=this.get(a),i=g.getInstance(),h=new i.Selection(),f="";if(h){if(c.UA.ie){if(!h.anchorNode||(!h.anchorNode.test(b)&&!h.anchorNode.ancestor(b))){h._selection.pasteHTML("<br>");h._selection.collapse(false);h._selection.select();j.halt();}}if(c.UA.webkit){if(!h.anchorNode.test(b)&&!h.anchorNode.ancestor(b)){g.frame._execCommand("insertlinebreak",null);j.halt();}}}}},_afterEditorReady:function(){var e=this.get(a).getInstance();try{e.config.doc.execCommand("insertbronreturn",null,true);}catch(f){}if(c.UA.ie||c.UA.webkit){e.on("keydown",c.bind(this._onKeyDown,this),e.config.doc);}},_onNodeChange:function(h){switch(h.changedType){case"backspace-up":case"backspace-down":case"delete-up":var g=this.get(a).getInstance();var i=h.changedNode;var f=g.config.doc.createTextNode(" ");i.appendChild(f);i.removeChild(f);break;}},initializer:function(){var e=this.get(a);if(e.editorPara){c.error("Can not plug EditorBR and EditorPara at the same time.");return;}e.after("ready",c.bind(this._afterEditorReady,this));if(c.UA.gecko){e.on("nodeChange",c.bind(this._onNodeChange,this));}}},{NAME:"editorBR",NS:"editorBR",ATTRS:{host:{value:false}}});c.namespace("Plugin");c.Plugin.EditorBR=d;},"@VERSION@",{skinnable:false,requires:["editor-base"]});YUI.add("editor",function(a){},"@VERSION@",{skinnable:false,use:["frame","selection","exec-command","editor-base","editor-para","editor-br","editor-bidi","editor-tab","createlink-base"]});YUI.add("comms-editor-autobidi",function(D){var B=function(){B.superclass.constructor.apply(this,arguments);},A="host",C="text";D.extend(B,D.Base,{autoBidiOff:false,watchForAction:true,redetectDirection:false,disableAutoBidi:false,throttledFindEmptyParas:null,findEmptyParas:function(){var F=this.get(A).getInstance();if(F){var E=F.Selection.DEFAULT_BLOCK_TAG;if(F.all(E).size()==0){E=B.PARAGRAPHS;}F.all(E).each(function(H){var G=H.get(C);if(G===""||G===" "||G==="\u00A0"){H.setData(B.AUTO_BIDI,true);}});}},_onKeyDown:function(E){if(this.watchForAction&&!(E.crtlKey||E.metaKey)){this.throttledFindEmptyParas();this.watchForAction=false;}},autoBidi:function(J){var I,H,G,F,E;if(((J&&J.keyCode&&!B.NODETECT_KEYS[J.keyCode])||(J&&J.type&&J.type==="paste"))&&!this.autoBidiOff&&!this.disableAutoBidi){I=this.get(A).getInstance();E=I.Selection.DEFAULT_BLOCK_TAG;H=new I.Selection();G=H.anchorNode;if(G&&!(G.test(B.PARAGRAPHS))){G=G.ancestor(B.PARAGRAPHS);}if((G&&G.getData(B.AUTO_BIDI))||(G&&this.redetectDirection)){F=D.Intl.detectDirection(G.get(C));if(F){G.setAttribute("dir",F);G.setData(B.AUTO_BIDI,false);this.redetectDirection=false;}}}},_afterNodeChange:function(E){if(E.changedType==="mouseup"||(E.changedType==="keydown"&&(E.changedEvent.crtlKey||E.changedEvent.metaKey))){this.watchForAction=true;this.redetectDirection=true;}if(B.AFFECTING_EVENTS[E.changedType]){this.watchForAction=true;this.disableAutoBidi=false;}else{if(B.REDIRECTING_EVENTS[E.changedType]&&!this.disableAutoBidi){this.redetectDirection=true;}else{if(E.changedType!="keydown"&&E.changedType!="keyup"){D.later(50,this,this.autoBidi,E.changedEvent);}}}},_disableAutoBidi:function(){this.watchForAction=false;this.disableAutoBidi=true;},_turnAutoBidiOff:function(E){this.autoBidiOff=E.status;},initializer:function(){var E=this.get(A);E.after("nodeChange",D.bind(this._afterNodeChange,this));E.frame.on("dom:keydown",D.bind(this._onKeyDown,this));E.on("disableautobidi",D.bind(this._disableAutoBidi,this));E.on("turnautobidioff",D.bind(this._turnAutoBidiOff,this));this.throttledFindEmptyParas=D.throttle(D.bind(this.findEmptyParas,this),150);}},{PARAGRAPHS:"P, DIV, UL, OL",AUTO_BIDI:"autobidi",AFFECTING_EVENTS:{"enter":true,"backspace":true,"delete":true},REDIRECTING_EVENTS:{"home":true,"left":true,"right":true},NODETECT_KEYS:{8:"backspace",9:"tab",13:"enter",16:"shift",18:"alt",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",46:"delete"},NAME:"editorAutoBidi",NS:"editorAutoBidi",ATTRS:{host:{value:false}}});D.namespace("Plugin");D.Plugin.EditorAutoBidi=B;},"1.0.0",{requires:["editor-base","selection","comms-intl-bidi"]});YUI.add("_shared_module_compose_loading",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_compose_loading={base:'<div id="loadingpane" class="cm-loadingpane"> {{start}} {{slow}} {{error}} {{populate}}</div>',start:"<h2>{{str_comp_loading}}</h2> ",slow:'<h2>{{str_comp_loadslow}} <span class="btn left right small"><a href="#" class="retryOrigin">{{str_comp_loadretry}}</a></span></h2> ',error:'<h2>{{str_comp_loaderr}} <span class="btn left right small"><a href="#" class="retryOrigin">{{str_comp_loadretry}}</a></span></h2> ',populate:"<h2>{{str_comp_loadpopulate}}</h2> "};},"1.0.0");YUI.add("_shared_module_offscreen_bin_compose_menu_list",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_offscreen_bin_compose_menu_list={base:'<div id="menu-list" class="optionMenu"> <ul> <li data-action="insertunorderedlist"><a href="#" title="{{str_rte_bullet_list_attr}}"><span>{{str_rte_bullet_list}}</span></a></li> <li data-action="insertnumberedlist"><a href="#" title="{{str_rte_numbered_list_attr}}"><span>{{str_rte_numbered_list}}</span></a></li> </ul></div>'};},"1.0.0");YUI.add("_shared_module_offscreen_bin_compose_menu_text_align",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_offscreen_bin_compose_menu_text_align={base:'<div id="menu-text-align" class="optionMenu"> <ul> <li data-action="align-l"><a href="#"><span>{{str_rte_align_l}}</span></a></li> <li data-action="align-c"><a href="#"><span>{{str_rte_align_c}}</span></a></li> <li data-action="align-r"><a href="#"><span>{{str_rte_align_r}}</span></a></li> </ul></div>'};},"1.0.0");YUI.add("mail-ui-fullcompose",function(AQ){var At=AQ.Lang.trim,U=AQ.Node.create,S=AQ.mail.Controller.Compose,AZ=[],AV=AQ.common.Utils,W=AV.substitute,Ab=AV.escapeHtml,I=AV.unescapeHtml,Au=AQ.ui.Templates,h=Au._shared_module_compose,Ak=Au._shared_module_rte_well_tabs_compose,c=Au._shared_module_rte_well_content_format.page_inoutdent_menu,Ap=AQ.common.persist.UserData,J=AQ.mail.persist.MetaData,AU="hidden",AR="focus",Af=500,As=(NeoConfig.fullPage?270:100),q="",Ah="neo.pref.compose.wellDisplay",d={none:{well:null,tab:null,isRTE:true},atch:{well:".attachments-pane",tab:".rte .attachments",isRTE:false},emo:{well:".emoticons-pane",tab:".rte .emoticons",isRTE:true},fmt:{well:".format-pane",tab:".rte .rich-text",isRTE:true}},V={"align-l":"justifyleft","align-c":"justifycenter","align-r":"justifyright",inserthrule:"inserthorizontalrule",insertlink:"createlink",setfontstyle:"fontname",setfontsize:"fontsize",insertnumberedlist:"insertorderedlist",color:"notyet",hilitecolor:"notyet"},Ay=Au._shared_module_compose_loading,g=[10,13,16,18,24,32,48],T=[8,10,12,14,18,24,36],A1=2000,E=7000,AO=AQ.EditorBase.NC_KEYS,Av="offscreen",AW="restore",Z="move",z=AQ.contacts,f=z.api,j=z.utils;var AP=function(Y,A3,A5,A4){var A6=this;AP.superclass.constructor.apply(A6,arguments);A6.lastACEl=null;A6.header=new AQ.mail.compose.HeaderBase(Y,A6);A6.acInputs=null;A6.firstRender=true;A6.rte=null;A6.tab=null;A6.rtSwitch=null;A6.rtSwitch2=null;A6.rteArea=null;A6.rteHasContent=false;A6.formatButtons=null;A6.fontFamilyOptions=null;A6.fontSizeOptions=null;A6.spellCheckView=null;A6.scView=null;A6.slowOriginReqTimer=null;A6.rteReady=false;A6.contentInitialized=null;A6.resizeNode=null;A6.keepHdrFocus=false;A6.formatShortcutTimer=null;A6.mouseFocusEvent=false;A6.composeViewRendered=false;A6.resizeHandle=null;A6.resizeRTEHeight=0;A6.resizeNestCount=0;A6.initialResize=false;A6.type="fullCompose";A6.evt=[];A6.wellTabFormatters={page_well_format:function(){return q=="format"?Ak.page_well_format:"";},page_well_emoticons:function(){return q=="emoticons"?Ak.page_well_emoticons:"";},page_well_attachments:function(){return q=="attachments"?Ak.page_well_attachments:"";},page_well_photos:function(){return q=="photos"?Ak.page_well_photos:"";},page_compose_email:function(){return W(Ak.page_compose_email,{},A6.wellTabFormatters,null,strings,Au);}};A6.loadFormatters={start:function(A8,A7){return(A7=="start")?W(Ay.start,null,null,null,strings):"";},slow:function(A8,A7){return(A7=="slow")?W(Ay.slow,null,null,null,strings):"";},error:function(A8,A7){return(A7=="err")?W(Ay.error,null,null,null,strings):"";},populate:function(A8,A7){return(A7=="pop")?W(Ay.populate,null,null,null,strings):"";}};A6.tbFormatters={lastsaved:function(){if(A6.lastSaveType===-1){return W(strings.str_comp_saveasdraftfail,0,0,0,{autosave_time:A6.lastSave});}else{if(A6.lastSave){if(A6.lastSaveType===1){return W(strings.str_comp_autosave,0,0,0,{autosave_time:A6.lastSave});}else{return W(strings.str_comp_saved,0,0,0,{saved_time:A6.lastSave});}}}return"";}};if(NeoConfig.bidi){AQ.use("comms-intl-bidihighlight");}};function k(){var A3=this,Y;if(A3.isSending){return;}Y=U(W(Au._shared_module_toolbar_compose.base,{},A3.tbFormatters,0,strings,Au));A3.author.attachToolbar(new AQ.mail.ui.Toolbar({root:Y}));}function AG(A4){var A5=this,Y,A3;if(A4.newVal){A5.updateToolbar();if(AQ.UA.ie&&A5.rte){A5.rte.frame._iframe.setStyle("display","block");}if(A5.composeViewRendered){if(A5.isDraft){Y="draft";}else{A3=(A5.cdo&&A5.cdo.get&&A5.cdo.get("origin"));Y=A3?A3.action:null;}Y=Y||"new";AQ.Lang.later(90,null,function(){A5.fire("darlaEvent",{action:"compose_"+Y});});}A5.attView&&A5.attView.reposAttachObj(AW);if(AQ.UA.ie){A5._resizeComposePage();}}else{if(A5.rte){A5.rte.frame._iframe.setStyle("visibility","inherit");if(AQ.UA.ie){A5.rte.frame._iframe.setStyle("display","none");}A5.header.hideACWidget();if(A5.dirty&&A5.dirty!=="ForceClose"&&NeoConfig.saveOnHideCompose){A5._invokeSaveDraft({auto:true});AV.rocketstats.stat("savemessage","switchingTab");}}if(A5.hiliteCP){A5.hiliteCP.hide();}if(A5.textCP){A5.textCP.hide();}A5.attView.reposAttachObj(Av);}if(A4.cbk){A4.cbk();}}function Aq(){var A5=this,A3=A5.attView,A4=A3&&A3.uploader,Y=A5.cdo;A5.blockSave=true;if(A5.saveTimer){A5.saveTimer.cancel();}if(A5.subjectTimer){A5.subjectTimer.cancel();}A5._clearOriginTimers();if(A5.hiliteCP){A5.hiliteCP.hide();}if(A5.textCP){A5.textCP.hide();}if(A5.resizeHandle){A5.resizeHandle.detach();}if(!AQ.Lang.isNull(A5.spellCheckView)&&!AQ.Lang.isUndefined(A5.spellCheckView)){A5.spellCheckView.destroy();}delete A5.spellCheckView;if(A3){AQ.each(A3.handles,function(A6){A6.detach&&A6.detach();});if(A4&&A4.handles){AQ.each(A4.handles,function(A6){A6.detach&&A6.detach();});}if(A4&&A4.checkFlashTimeout){clearTimeout(A4.checkFlashTimeout);}A3.toggleUploaderHandle&&A3.toggleUploaderHandle.detach();delete A5.attView;}if(A5.rte){A5.rte.destroy();delete A5.rte;}if(Y){AQ.each(Y.handles,function(A6){A6.detach&&A6.detach();});AQ.each(Y.get("attachments"),function(A6){if(A6.timeout){clearTimeout(A6.timeout);A6.timeout=null;}});delete A5.cdo;}if(A5.baseNode){AQ.each(A5.evt,function(A6){A6.detach();});delete A5.evt;A5.baseNode._node&&A5.baseNode.remove().destroy(true);}}function F(A7){var A9=this,A6=A7?A7.dataAction:0,A3=(A7&&A7.rawEvent&&A7.rawEvent.shiftKey)?A7.rawEvent.shiftKey:false;switch(A6){case"send":setTimeout(function(){A9._invokeSend(true,{saveBeforeSend:A3});},0);break;case"savedraft":A9.blockSave=true;A9._invokeSaveDraft();break;case"cancelcompose":if(A9.canWeClose()&&!A9.author.get("close")){A9.author.set("close",1,{noScroll:true});}break;case"insertsignature":var A8=A9.cdo.get("isRichText"),A5,Y,A4=S.getSignature(A9.header.getHeader().from.email);if(A4){A5=A9.assembleSendBody();Y=A5.html;Y=S.injectSignature(Y,A8,A4);A9.cdo.set("content",Y,{textConvert:true});}break;default:break;}}function C(){var BA=this,BF,A7,Y,BB,A5,A3,A8,A6,A9,BE,A4,BD=BA.cdo,BC;BA.evt.push(BA.baseNode.delegate("click",function(BI){var BJ=BI.currentTarget.get("className").replace(/emoticon_(\d+)/,BA.formatters.global_path_img()+"/emoticons/emo$1.gif"),BG=BI.currentTarget.getAttribute("title"),BH;
BG=BG.replace(/"/,"&quot;").replace(/</,"&lt").replace(/>/,"&gt;").replace(/&/,"&amp;");BH='<img src="'+BJ+'" alt="'+BG+'">';BI.target.blur();BA._invokeRTECommand("insertandfocus",BH);},".emoticons-pane li"));BA.evt.push(BA.baseNode.delegate("keydown",function(BH){var BI,BG;if(BH.keyCode===13){BI=BH.target.get("nodeName");if(BI==="A"){BH.target.blur();BG=BA.baseNode.one("div.attachments-pane #attachment-button-input");BG&&BG.set("tabIndex","0");BH.target.simulate("click");BH.preventDefault();}else{if(AQ.UA.ie&&AQ.UA.ie<=9&&BI==="INPUT"){BH.preventDefault();}else{if(AQ.UA.gecko>1.92&&BI==="INPUT"){BH.target._node&&BH.target._node.click();BH.preventDefault();}}}}},"#attachment-button-input,span.attachment-button-removeall a"));if(NeoConfig.bidi){BA.baseNode.all(".cm-subject-field").plug(AQ.Plugin.BidiTextEntry);}if(!BD.handles){BD.handles=[];}BC=BD.handles;BC.push(BD.on("compose:downloadAttachment",function(BH,BG){var BI=function(){AQ.use("mail-common-downloader-v"+(NeoConfig.downloaderVersion||"1"),"mail-controller-messages",function(){var BL="Draft",BK=BA.draftMID,BJ={success:function(BT){var BS=[],BP=BD.get("attachments")[BG],BQ,BR,BO,BN=BT.attachments.length,BM;for(BM=0;BM<BN;BM++){BQ=BT.attachments[BM];if((!BP.state.cancelled)&&(At(BQ.filename)==BP.filename)){BR={fid:BL,mid:BT.mid,pid:BQ.partId,filename:BQ.filename};BO=BQ.tnefId;if(typeof BO!="undefined"){BR.tnefid=BO;}BS.push(BR);break;}}AQ.mail.common.downloader.render(BS);},failure:function(BM){}};if(BK){AQ.mail.Controller.Messages.get({fid:BL,msg:{mid:BK}},BJ);}});};if(BA.draftMID){BI();}else{BA.downloadHandle=BA.on("compose:saveSuccess",function(){BA.downloadHandle.detach();BI();});BA._invokeSaveDraft();}}));BA.evt.push(AQ.on("mousedown",function(){BA.attView.reposAttachObj(AW);},BA.baseNode.one(".attachment-button-attach")));BC.push(BD.on("compose:restoreFocus",function(){if(BA.focusNode instanceof AQ.Node){BA._restoreFocus();}else{BA.setFocus("body",0,1);}},BA));BA.evt.push(AQ.on("click",function(BG){BG.halt(false);if(BA.allowEdit){BA._cmdTextSwitch();}},BA.rtSwitch));BA.evt.push(AQ.on("click",function(BG){BG.halt(false);if(BA.allowEdit){BA._cmdTextSwitch();}},BA.rtSwitch2));BA.evt.push(AQ.on("click",function(BG){BG.halt(false);if(BA.allowEdit){BA.header._cmdBccSwitch(BG.currentTarget.get("parentNode").get("id")=="btn-show-bcc");}BA._restoreFocus();},BA.baseNode.all("span.bcc-btn a")));BA.evt.push(BA.baseNode.delegate("click",function(){BA._clearOriginTimers();BA._displayLoading();S.fetchOrigin(BD,BA.isDraft);},"a.retryOrigin"));if(BA.resizeNode){BA.evt.push(BA.resizeNode.on((AQ.UA.ie&&AQ.UA.ie<8)?"resize":"windowresize",function(){BA._resizeRTE();}));}BA.once("renderComplete",function(){BA.contentLoaded=true;AQ.use("mail-controller-sendconfirm","mail-ui-sendconfirmview-base",function(BG){});});if(NeoConfig.fullPage){BA.resizeHandle=AQ.on((AQ.UA.ie&&AQ.UA.ie<8)?"resize":"windowresize",function(){BA._resizeComposePage();});}if(NeoConfig.intl!=="jp"){BA._addFocusListeners();}BA.evt.push(BA.baseNode.delegate("keydown",function(BH){var BG;if(BH.keyCode===13){BH.halt();BA.focusNode=BH.target;BG=BH.target.one("b");BG&&BG.simulate("click");}},"div.rte-well-container a"));A4=BA.baseNode.one("#attachment-button-input");if(A4){BA.evt.push(A4.on({focus:function(BG){A4.ancestor("span").addClass("focused");},blur:function(BG){A4.ancestor("span").removeClass("focused");},click:function(BG){if(BA.attView.uploader&&BA.attView.uploader.uploaderType===AQ.mail.UploaderService.UPLOADER_TYPE_YUI&&!BA.attView.formUploader){BA.attView.switchToFormUploader({skipDefault:true});}}}));}}function AK(A5){var A8=this,A4,A6;if(A5){A8.parent=A5;A4=W(h.base,A8.cdo,A8.formatters,null,strings,Au);A5.append(A4);A8.baseNode=A5.one(".compose.content");A8.updateToolbar();A8.attView=new AQ.mail.AttachmentView(A8.cdo,A8.parent);A8.compArea=A8.baseNode.one("div.compose-message").one("div.inner");A8.rtSwitch=A8.baseNode.one("b.plaintext");A8.rtSwitch2=A8.baseNode.one("div.rich-text-switch-pane").one("a");A8.rteArea=A8.compArea.one("div.cm-rtetext");A8.loadingArea=A8.compArea.one("div.cm-loadingpane");A6=A8.baseNode.one("div.cm-plaintext");if(A6){A6.get("parentNode").removeChild(A6);}if(AQ.UA.ie){A8.resizeNode=A8.compArea.ancestor("td");}if(AQ.UA.gecko&&!NeoConfig.fullPage){A8.compArea.ancestor("td").setStyle("height","0");}A8._switchEditMode(A8._isRTEActive());A8.header.enableHeader(false);A8.baseNode.all("div.gwell").addClass(AU);if(NeoConfig.low_bandwidth){var Y=A8.baseNode.all(".rte li"),A7=Y.size(),A3;Y.item(0).addClass("end-grp");for(A3=1;A3<A7;A3++){Y.item(A3).addClass(AU);}}A8.bindUI();A8.header.render();A8.composeViewRendered=true;A8.attView.attachXY=A8.baseNode.one(".attachment-button-attach").getXY();}}function AX(A6){var A5,A4,A3,Y=-1;if(typeof A6.get("selectionEnd")==="number"){Y=A6.get("selectionEnd");}else{if(document.selection&&document.selection.createRange){A5=document.selection.createRange();A5.moveStart("character",-A6.get("value").length);Y=A5.text.length;}}return Y;}function Ag(){var A4=this;function Y(A6){var A9=A6.params,A8={attachments:1,format:1};if(!A8.hasOwnProperty(A9.tab)){return;}if(!A4.baseNode){return;}A9.tooltip=A9.tooltip||"";var A5=["<span class='btn left right menu' data-app='",A6.appInstance,"'>","<a href='#' title='",A9.tooltip,"'>",A9.label,"</a>","</span>"].join(""),A7=U(A5);A4.baseNode.one("."+A9.tab+"-pane").one(".om-buttons").append(A7);A7.on("click",function(BA){BA.preventDefault();A6.handler(AQ.stamp(A7),A4);});}function A3(A5){if(!A4.baseNode){return;}A4.baseNode.all('.om-buttons > span[data-app="'+A5+'"]').remove();}AQ.each(AZ,Y);AQ.on("om:compose_add_btn",function(){Y(AZ[AZ.length-1]);});AQ.on("om:compose_remove_btns",A3);}function Ai(){var A8=this,BA,A7,A3,A6,BD,BB,Y,A5,A9,BC=A8.cdo;A8._initializeRTE();A8.rte.render(A8.rteArea);if(NeoConfig.bidi){A8.rte.fire("turnautobidioff",{status:!A8._isRTEActive()});}A8._bindUIRTE();A8._bindCDO();if(A8._isOrigin()){A8.slowOriginReqTimer=setTimeout(function(){A8._handleSlowOriginRequest();
},E);A8.loadingTimer=setTimeout(function(){A8._displayLoading();},A1);if(AQ.UA.ie){A8.rteArea.setStyle("display","none");}if(BC&&BC.get("passive")){text=BC.get("content");A8.contentChangeAfter(text);A8.replyheaderChangeAfter();A8.replyContentChangeAfter(text);var A4={};if(BC.get("attachments")){BC._removeAllAttachments();A4.oMsg={};A4.oMsg.attachments=BC.get("attachments");A4.fid=BC.get("origin").fid;BC._addAttachments(S.convertAttachmentData(A4));}}else{S.fetchOrigin(BC,A8.isDraft,A8.stopwatch,function(){if(A8.isDraft&&BC&&BC.oComposeData&&BC.oComposeData.origin&&BC.oComposeData.origin.oMsg){A8.draftMID=BC.oComposeData.origin.oMsg.mid;}});}if(A8.isDraft){AQ.Lang.later(90,null,function(){A8.fire("darlaEvent",{action:"compose_draft"});});A8.hasHardDraft=true;A8.draftMID=BC.oComposeData.origin.oMsg.mid;}else{A9=BC.get("origin");AQ.Lang.later(90,null,function(){A8.fire("darlaEvent",{action:"compose_"+A9.action});});}A3=BC.oComposeData.origin.oMsg;A6=A3&&A3.header&&A3.header.to;BD=A8.baseNode.all("#from-field option");AQ.Array.some(A6||[],function(BE){BD.each(function(BG,BF){var BH=BG.get("value").replace(/.+\<(.+)\>/,"$1");if(BE.email==BH){AQ.later(100,A8,function(){BG.get("parentNode").set("selectedIndex",BF);});return true;}});});if(A3.header.from&&A8.isDraft){AQ.later(10,A8,function(){A8.header._setFromMenu(A3.header.from);});}}else{BA=BC.get("header");A8.header.setHeader(BA);A8._allowEditing(BC.get("content"));A8.dirty=BC.get("prePopulated");A8.setFocus((BA.to&&BA.to.length>0)?"body":"to");A8.fire("darlaEvent",{action:"compose_new"});}if(NeoConfig.fullPage){A8._resizeComposePage();A8.initialResize=true;if(A8.rteReady){A8._setRTEBorder();}}else{if(A8.rteReady){A8._resizeRTE(true);}}if(BC.get("passive")){A8.dirty=1;}Y=A8.richFontInfo.fontFamily;A5=A8.richFontInfo.fontSize;A8.fontFamilyOptions.each(function(BE){var BF=BE.get("value");if(BF===Y){BE.set("selected",true);}});if(A5){BB=parseInt(A5.replace("pt",""));BB=AQ.Array.indexOf(T,BB);if(BB>=0){A8.fontSizeOptions.item(BB).set("selected",true);}}A8._initOpenMailButtons();}function Ao(){var A7=this,A4,Y,A6,A5,A3=A7.baseNode.one("div.emoticons-pane ul");A3.plug(AQ.comms.ui.NodeFocusBase,{descendants:"li",keys:{next:"39",previous:"37"}});A7.evt.push(A3.delegate("keydown",function(A8){if(A8.keyCode===9&&!A8.shiftKey){A5=A7.baseNode.one(".attachments-well");if(A5&&!A5.hasClass(AU)){A4=A5.one('li.attachmentVisible span.left a[tabIndex="0"]');if(!A4){A4=A5.one("li.attachmentVisible span.left a");A4&&A4.set("tabIndex","0");}}else{A8.target.blur();A7.setFocus("body");A8.halt();}}else{if(AQ.UA.gecko&&A8.keyCode===9){A4=AQ.one('.rte li a[tabIndex="0"]');A4&&A7.setFocus(A4);A8.halt();}else{if(A8.keyCode===13||A8.keyCode===32){A8.target.simulate("click");A8.halt();}}}},"li"));A3=A7.baseNode.one("div.attachments-pane");A3.plug(AQ.comms.ui.NodeFocusBase,{descendants:"input[type=file],span.attachment-button-removeall a",keys:{next:"39",previous:"37"}});A7.evt.push(A3.delegate("keydown",function(A8){A4=null;if(A8.keyCode===9){if(!A8.shiftKey){A5=A7.baseNode.one(".attachments-well");if(A5&&!A5.hasClass(AU)){A4=A5.one('li.attachmentVisible span.left a[tabIndex="0"]');if(!A4){A4=A5.one("li.attachmentVisible span.left a");A4&&A4.set("tabIndex","0");}}else{A8.target.blur();A7.setFocus("body");A8.halt();}}else{A7.baseNode.all("div.rte li a").each(function(A9){if(A9.get("tabIndex")=="0"&&!A4){A4=A9;}});if(!A4){A4=A7.baseNode.one("div.rte li a");}A4.focus();A8.halt();}}},"span"));A3=A7.baseNode.one("div.rte-well-container div.rte");A3.plug(AQ.comms.ui.NodeFocusBase,{descendants:"a[role=tab]",keys:{next:"39",previous:"37"}});A7.evt.push(A3.delegate("keydown",function(A9){if(A9.keyCode===9&&!A9.shiftKey){var A8=A7.baseNode.one("div.rte-well-container .rte li.active a");if(!A8||(AQ.UA.ie&&AQ.UA.ie<8&&A8.get("target")=="attachments")){A5=A7.baseNode.one(".attachments-well");if(A5&&!A5.hasClass(AU)){A4=A5.one('li.attachmentVisible span.left a[tabIndex="0"]');if(!A4){A4=A5.one("li.attachmentVisible span.left a");A4&&A4.set("tabIndex","0");}}else{A9.target.blur();A7.setFocus("body");A9.halt();}}}},"a"));A3=A7.baseNode.one(".attachments-well");A7.evt.push(A3.delegate("keydown",function(A8){A6=null;Y=null;A4=null;switch(A8.keyCode){case 8:case 46:A8.target.blur();A8.target.set("tabIndex","-1");Y=A8.target.ancestor("li");A4=Y.previous(".attachmentVisible")||Y.next(".attachmentVisible");if(A4){A4=A4.one("span.left a");if(A4){A4.set("tabIndex","0");A7.setFocus(A4);}}else{A7.setFocus("body",0,1);}Y.one(".lozengeremove a").simulate("click");break;case 9:if(!A8.shiftKey){A8.target.blur();A7.setFocus("body");A8.halt();}break;case 37:case 38:A6="previous";case 39:case 40:A6=(A6?A6:"next");Y=A8.target.ancestor("li")[A6](".attachmentVisible");if(Y){A4=Y.one("span.left a");if(A4){A8.target.set("tabIndex","-1");A4.set("tabIndex","0");A7.setFocus(A4);}}break;}},"a"));A3=A7.baseNode.one(".rich-text-switch-pane");A7.evt.push(A3.delegate("keydown",function(A8){if(A8.keyCode===9&&!A8.shiftKey){A5=A7.baseNode.one(".attachments-well");if(A5&&!A5.hasClass(AU)){A4=A5.one('li.attachmentVisible span.left a[tabIndex="0"]');if(!A4){A4=A5.one("li.attachmentVisible span.left a");A4&&A4.set("tabIndex","0");}}else{A8.target.blur();A7.setFocus("body");A8.halt();}}else{if(A8.keyCode===13||A8.keyCode==32){if(A8.keyCode===32){A8.target.simulate("click");}A8.preventDefault();A8.target.blur();A7.setFocus("body");}}},"a"));A3=A7.baseNode.one("div.format-pane div.format-inner");A7.evt.push(A3.on("keydown",function(BB){var BA=BB.target,BD=BA.get("nodeName"),A8=BA.ancestor("span"),A9;if(!A8||(BD!="A"&&BD!="SELECT")){return;}switch(BB.keyCode){case 9:if(A8.hasClass("showFontSize")&&!BB.shiftKey){var BC=A7.baseNode.one('.format-pane .format-inner a[tabIndex="0"]');if(BC){BC.focus();}else{A7.baseNode.one(".format-pane .format-inner a").focus();}BB.halt();}else{if(A8.hasClass("showFontStyle")&&BB.shiftKey){var BC=A7.baseNode.one('.rte li a[tabIndex="0"]');if(BC){BC.focus();}else{A7.baseNode.one(".rte li a").focus();
}BB.halt();}else{if(BD=="A"&&!BB.shiftKey){A5=A7.baseNode.one(".attachments-well");if(A5&&!A5.hasClass(AU)){A4=A5.one('li.attachmentVisible span.left a[tabIndex="0"]');if(!A4){A4=A5.one("li.attachmentVisible span.left a");A4&&A4.set("tabIndex","0");}}else{BB.target.blur();A7.setFocus("body");BB.halt();}}}}break;case 13:case 32:if(BD=="A"){BA.simulate("click");}break;case 37:case 39:if(BD!="A"){return;}if(BB.keyCode===37){if(A8.one("a")&&A8.one("a").hasClass("bold")){return;}A9=A8.previous("span");}else{if(BB.keyCode===39){if(A8.get("id")==="btn-spell-langs"){return;}A9=A8.next("span");}}if(A9){A9=A9.one("a");if(A9){BA.set("tabIndex","-1");A9.set("tabIndex","0");A9.focus();}}break;default:}}));}function i(BB){var A9=this,BH=BB.keyCode,BD,BF=(BB.ctrlKey||BB.metaKey)&&(!BB.altKey&&!BB.shiftKey),A6=AQ.UA.os,Y=(BB.ctrlKey&&(A6=="windows"||A6=="win"))||(BB.metaKey&&(A6=="macintosh"||A6=="mac")),A5=Y&&BF,BA=null,A4,A8=false;switch(BH){case 85:if((Y&&BB.shiftKey)&&!AQ.UA.ie&&(!AQ.UA.gecko||AQ.UA.gecko>1.92)&&(A4=A9.baseNode.one("#attachment-button-input"))){if(!A9.baseNode.one("ul[role=tablist] li").hasClass("active")){A9._switchWell("atch",BB);}A4._node.click();BB.halt();}break;case 13:if(Y&&!BB.altKey){A8=(BB.shiftKey?true:false);BD=A9.baseNode.one(".ac-input.focus input");if(BD){BD.blur();}A9._invokeSend(false,{saveBeforeSend:A8});if(BB.frameEvent){BB.frameEvent.halt();}BB.halt();return true;}else{if(BB.target.get("nodeName")=="A"){BB.target.simulate("click");return true;}}break;case 83:if(BF){A9._invokeSaveDraft();if(BB.frameEvent){BB.frameEvent.halt();}BB.halt();return true;}break;case 89:if((BB.ctrlKey||BB.metaKey)&&BB.shiftKey){BB.halt();if(A9.allowEdit){A9._cmdTextSwitch();}return true;}break;case 219:case 221:AQ.fire("tabview:handleKeyDown",BB);break;default:break;}if(BB.frameEvent){if(BF||(NeoConfig.bidi&&BB.ctrlKey)){switch(BH){case 66:BA="bold";break;case 73:BA="italic";break;case 85:BA="underline";break;case 16:if(NeoConfig.bidi){BA="bidi";}break;case 86:A9._setDirty();break;default:break;}if(BA){if(A9._isRTEActive()){BA=A9.baseNode.one(".format-pane .btn[data-action="+BA+"]");clearTimeout(A9.formatShortcutTimer);A9.formatShortcutTimer=setTimeout(function(){A9._invokeAction(BA,"",true);},100);}BB.frameEvent.halt();return true;}}else{if(BB.shiftKey){if(BH==9){var BG=A9.baseNode.one("div.rte-well-container"),BC=BG.one("li.active b"),BE,A7=BG.one(".rich-text-switch-pane"),A3=BG.one(".attachments-well"),BI;if(A3&&!A3.hasClass(AU)){A3.all("li.attachmentVisible span.left a").each(function(BJ){if(!BE&&BJ.get("tabIndex")=="0"){BE=BJ;}});if(!BE){BE=A3.one("li.attachmentVisible span.left a");BE.set("tabIndex","0");}}else{if(!BC){A9.baseNode.all("div.rte li a").each(function(BJ){if(!BE&&BJ.get("tabIndex")=="0"){BE=BJ;}});if(!BE){BE=BG.one("li a");}}else{if(A7&&!A7.hasClass(AU)){BE=A7.one("a");}else{if(BC.hasClass("attachments")){BI=function(){A9.baseNode.all("#attachment-button-input, .attachments-pane span.attachment-button-removeall a").each(function(BJ){if(!BE&&BJ.get("tabIndex")=="0"){BE=BJ;}});if(!BE){BE=A9.baseNode.one("#attachment-button-input");}if(AQ.UA.ie&&AQ.UA.ie<8){BE&&AQ.later(0,BE,function(){A9.setFocus(BE);BE.simulate("keydown",{keyCode:9});});BE=null;}};if(A9.attView.uploader.uploaderType===AQ.mail.UploaderService.UPLOADER_TYPE_YUI&&!A9.attView.formUploader){BI();A9.attView.switchToFormUploader({skipDefault:true});}else{BI();}}else{if(BC.hasClass("emoticons")){A9.baseNode.all("div.emoticons-pane li").each(function(BJ){if(BJ.get("tabIndex")=="0"){BE=BJ;}});if(!BE){BE=A9.baseNode.one("div.emoticons-pane li");}}else{if(BC.hasClass("rich-text")){BE=A9.baseNode.one("div.format-pane .showFontStyle select");}}}}}}BE&&A9.setFocus(BE);BB.frameEvent.halt();return true;}}}}if(BF){return true;}return false;}function p(A3){var Y=AQ.Node.getDOMNode(A3);if(Y!=null){return(Y.tagName.toUpperCase()=="DIV");}return false;}function AM(){var A4=this,Y=A4.cdo,A3;if(!Y.handles){Y.handles=[];}A3=Y.handles;A3.push(Y.after("contentChange",function(A5){A4.contentChangeAfter(A5);}));A3.push(Y.after("isRichTextChange",function(A5){A4._switchEditMode(A5.newVal);}));A3.push(Y.after("replyheaderChange",function(){A4.replyheaderChangeAfter();}));A3.push(Y.after("replycontentChange",function(A5){A4.replyContentChangeAfter(A5);}));A3.push(Y.after("originerrorChange",function(A6){A4._clearOriginTimers();var A5=A6.newVal;if(A5.code!=AQ.common.net.Error.abort){A4._writeLoadingHtml("err");}}));A3.push(Y.on("CDO_ATTACHMENT_ADDED",function(A7,A6,A5){A4._setDirty();if(!A5){A4.attachmentsLoading[A6]=1;}A4._resizeRTE();}));A3.push(Y.on("CDO_ATTACHMENT_DELETED",function(A6,A5){A4._setDirty();A4._resizeRTE();A4.attachmentsLoading[A5]=0;if(AQ.UA.os=="macintosh"&&AQ.UA.chrome>=11){A4.setFocus("body",0,1);}else{A4._restoreFocus();}}));A3.push(Y.on("CDO_ATTACHMENT_PROCESSED",function(A6,A5){A4._setDirty();A4.attachmentsLoading[A5]=0;}));A3.push(Y.on("CDO_ATTACHMENT_FILES_SELECTED",function(A6){var A5=A4.baseNode.one("#attachment-button-input");if(A5){A5.blur();}if(AQ.UA.os=="macintosh"&&AQ.UA.chrome>=11){A4.setFocus("body",0,1);}else{A4._restoreFocus();}}));}function AL(Y){var A3=this;if(!Y.uiUpdate){Y.newVal?A3.setContent(Y.newVal,!Y.textConvert||AQ.UA.gecko):A3.setContent(A3.cdo.get("content"));}}function Ax(){var A3=this,Y;A3.header.setHeader(A3.cdo.get("header"));Y=A3.cdo.get("header").subject;A3.author.updateTabTitle(Ab(I(Y)));if(NeoConfig.bidi){A3.author.updateTabDirection(AQ.Intl.detectDirection(Y));}}function t(Y){var A4=this;A4._allowEditing(Y.newVal);A4.header.enableSwitchReplyButton();A4.dirty=false;var A3=A4.cdo.get("header");A4.setFocus((A3.to&&A3.to.length>0)?"body":"to");}function G(Y){var A4=this,A3;A4.rtSwitch.setContent(strings[Y?"str_rte_plaintext":"str_rte_richtext"]);if(A4.rte){A4.rte.set("extracss",A4._getExtraCSS(Y));A3=S.getDefaultFontInfo(!Y);A4.rte.frame.getInstance().one("body").setStyles({"fontSize":A3.fontSize,"fontFamily":A3.fontFamily});A4._toggleRTEWellMode(Y);if(NeoConfig.bidi){A4.rte.fire("turnautobidioff",{status:!Y});
}}}function An(){var A7=this,Y={content:A7.getContent()},A5,A6;A7.cdo.updateData(Y);if(A7._isRTEActive()){function A3(){var A8=A7.getRTEDocNode().one("body");if(A8){var A9=S.convertToPlain(A8,false);if(A9){if(AQ.UA.ie){A9=A9.replace(/\xA0/gi," ");}var BA=At(A9);return BA!="";}else{return false;}}return true;}function A4(){A7._setDirty();A5=A7.getRTEInstance();A5.Selection.cleanCursor();S.toPlainText(A7.cdo,S.convertToPlain(A7.getRTEDocNode().one("body"),true));A7.baseNode.fire("switchToPlain");A7.setFocus("body");}if(A3()){A6=true;A7.confirm(null,strings.str_comp_conf_plainText,A4);}else{A4();}}else{A7._setDirty();S.toRichText(A7.cdo);}!A6&&A7._restoreFocus();}function P(Y){var A4=this,A3=S.getDefaultFontInfo(!Y);if(Y){A4.richFontInfo.fontFamily=A3.fontFamily;A4.richFontInfo.fontSize=A3.fontSize;A4.richFontInfo.foreColor="#000";A4.richFontInfo.backColor="#fff";}return"body { color: "+A4.richFontInfo.foreColor+"; background-color: "+A4.richFontInfo.backColor+";padding: 0px; margin: 8px "+(NeoConfig.bidi?(strings.str_tog_loadRTLCss?"12px 0px 2":"2px 0px 12"):"0px 0px 12")+"px; } "+"p { margin : 0 }"+"blockquote { margin : 1em; display : block; }"+"span.mark { background:transparent url("+((!NeoConfig.isFullSSL)?"http://mail.yimg.com":"https://s.yimg.com")+"/ok/u/assets/img/rte-mark.png) repeat-x scroll center bottom; }";}function Aw(){return !NeoConfig.low_bandwidth&&this.cdo.get("isRichText");}function Az(){return(this.spellCheckView&&this._isRTEActive());}function A(){return this.rte.getContent();}function R(Y){return this.baseNode.one(".cm-"+Y+" ul li");}function r(A6,A3){var A7=this,Y="",A5=AQ.Selection.CURSOR,A4=(!AQ.Lang.isUndefined(A3))?A3:true;if(A4){Y=AQ.UA.webkit?"<div>"+A5+"</div>":"<p>"+A5+"</p>";}else{Y="";}Y+=A6;A7._initializeRTEContent(Y,A4);}function Aj(A5,A4,Y){var A7=this,A3=true,A6;if((typeof A5=="string")){A6=A7.baseNode.one(".compose-header");switch(A5){case"to":case"cc":case"bcc":case"subject":A6=A7.baseNode.one(".compose-header");A5=A6.one(".cm-"+A5+"-field");break;case"body":A5=A7.rte;A3=(Y&&AQ.UA.os=="macintosh"&&AQ.UA.chrome>=11)?0:A7.rteReady;break;}}if(A3){if(A5==A7.rte){A5.focus(A4||true);}else{A5&&A5.focus();}}A5&&A7._registerFocus(A5);}function Aa(A3){var A4=this,Y;A4._clearOriginTimers();A4.header.enableHeader(true);if(AQ.UA.ie){A4.rteArea.setStyle("display","block");}A4.rteArea.setStyle("visibility","");A4.loadingArea.addClass(AU);Y=J.get(Ah);if(AQ.Lang.isUndefined(Y)||(typeof Y!="string")||AQ.Lang.isUndefined(d[Y])){Y="fmt";J.set(Ah,Y);}if(NeoConfig.low_bandwidth){Y="none";}if(Y!="none"){A4._switchWellGuts(Y);}if(A3){A4.setContent(A3,!A4.isDraft);}A4.header.allowEditing(A3);A4._adjustLowRes();A4.allowEdit=true;A4.fire("renderComplete");}function l(){var Y=this;if(!NeoConfig.fullPage&&screen.height<=600){if(Y.compArea.ancestor("TR").getY()>Y.baseNode.get("winHeight")-30){Y._closeWellGuts();}}}function A2(Y,A3){var A8=this,A6,A5,A4;if(A8.rteReady){A8.rte.set("content",Y);A5=A8.getRTEInstance();A5.Selection.filter();if(AQ.UA.ie){A8.rte.frame._fixIECursors();}else{if(AQ.UA.gecko&&!A3){A4=A5.one("doc");while(A4.one("div")){A4=A4.one("div");}if(A4.test("div")){A4.append(AQ.Selection.CURSOR);}}}try{A6=new A5.Selection();A6.focusCursor(true,true);}catch(A7){}}else{A8.contentInitialized=Y;}}function m(Y,A4){var A6=this,A3=null,A5=A4;switch(Y){case"fontname":A3="userUIPref.composeFontFamily";break;case"fontsize":A6.fontSizeOptions.each(function(A7){if(A5==A7.get("value")){A4=A7.get("text");A3="userUIPref.composeFontSize";}});break;default:break;}if(A3&&A4){S.savePref(A3,A4);}}function a(Y,A5){var A6=this,A4,A3;if(A4=V[Y]){Y=A4;}if(Y=="notyet"){alert("not yet");}else{if(Y=="forecolor"){if(!A6._formatPane){A6._formatPane=A6.baseNode.one(".format-pane");}A3=A6._formatPane.one("#btn-forecolor i");A3.setStyle("backgroundColor",A5);}A6._setComposePreference(Y,A5);A6._invokeRTECommand(Y,A5);}}function AE(Y,A3){var A4=this;A4._setDirty();A4.setFocus("body",function(){A4.rte.execCommand(Y,A3);});}function AA(){var A4=this,A3,Y;if(!A4._formatPane){A4._formatPane=A4.baseNode.one(".format-pane");}A3=A4._formatPane.one(".btn[data-action="+"spellcheck"+"]");Y=A3.next();A3.on("click",function(A5){A4._doSpellCheck();A5.preventDefault();});Y.on("click",function(A5){A4._openSpellCheckMenu(A5);A5.preventDefault();});}function Ar(A3,A4,A6){var A5=this,Y;AQ.use("editor-lists","createlink-base",function(A7){A5.rte.plug(A7.Plugin.EditorLists);if(A5.rte){Y=A3.getAttribute("data-action");if(Y&&(Y==="color"||Y==="hilitecolor")){}else{if(Y&&Y!="menu"){if((Y=="bold")||(Y=="italic")||(Y=="underline")){A3.toggleClass("pressed");}else{if(Y&&Y==="insertlink"){A7.Plugin.CreateLinkBase.STRINGS.PROMPT=strings.str_comp_createlink_prompt;A7.Plugin.CreateLinkBase.STRINGS.DEFAULT=strings.str_comp_createlink_default;}else{if(Y&&Y==="bidi"){if(!A6){A4=A3.getAttribute("value");}A5.rte.fire("disableautobidi");}}}A5._invokeDataAction(Y,A4);}else{if(A3.hasClass("menu")){A5._showMenus(A3);}}}}});}function AJ(Y){var A8=this,A6,BB,A4,A3,BA,A9,A7,BC,BD,A5=false;if(Y.menu){return;}BB=Y.get("id");AQ.use("common-ui-menu-helper","menus_css",function(){switch(BB){case"btn-indent":A6=c;break;case"btn-text-align":A6=Au._shared_module_offscreen_bin_compose_menu_text_align.base;break;case"btn-list":A6=Au._shared_module_offscreen_bin_compose_menu_list.base;break;case"btn-forecolor":case"btn-backcolor":BA=[["000000","111111","2d2d2d","434343","5b5b5b","737373","8b8b8b","a2a2a2","b9b9b9","d0d0d0","e6e6e6","ffffff"],["7f7f00","bfbf00","ffff00","ffff40","ffff80","ffffbf","525330","898a49","aea945","c3be71","e0dcaa","fcfae1"],["407f00","60bf00","80ff00","a0ff40","c0ff80","dfffbf","3b5738","668f5a","7f9757","8a9b55","b7c296","e6ebd5"],["007f40","00bf60","00ff80","40ffa0","80ffc0","bfffdf","033d21","438059","7fa37c","8dae94","acc6b5","ddebe2"],["007f7f","00bfbf","00ffff","40ffff","80ffff","bfffff","033d3d","347d7e","609a9f","96bdc4","b5d1d7","e2f1f4"],["00407f","0060bf","0080ff","40a0ff","80c0ff","bfdfff","1b2c48","385376","57708f","7792ac","a8bed1","deebf6"],["00007f","0000bf","0000ff","4040ff","8080ff","bfbfff","212143","373e68","444f75","585e82","8687a4","d2d1e1"],["40007f","6000bf","8000ff","a040ff","c080ff","dfbfff","302449","54466f","655a7f","726284","9e8fa9","dcd1df"],["7f007f","bf00bf","ff00ff","ff40ff","ff80ff","ffbfff","4a234a","794a72","936386","9d7292","c0a0b6","ecdae5"],["7f003f","bf005f","ff007f","ff409f","ff80bf","ffbfdf","451528","823857","a94a76","bc6f95","d8a5bb","f7dde9"],["800000","c00000","ff0000","ff4040","ff8080","ffc0c0","441415","82393c","aa4d4e","bc6e6e","d8a3a4","f8dddd"],["7f3f00","bf5f00","ff7f00","ff9f40","ffbf80","ffdfbf","482c1b","855a40","b27c51","c49b71","e1c4a8","fdeee0"]];
A9=BA[0].length;A7=BA.length;A6=["<div id='menu-color-picker' class='optionMenu colorPickerMenu'>"];A3=(BB=="btn-forecolor")?"forecolor":"backcolor";for(BC=0;BC<A7;BC++){A6.push("<ul>");for(BD=0;BD<A9;BD++){A6.push("<li style='background-color:#",BA[BC][BD],";' data-action='",A3,"' data-value='#",BA[BC][BD],"'><a href='#'></a></li>");}A6.push("</ul>");}A6.push("</div>");A6=A6.join("");break;default:break;}if(A6){A4=A8._showRTEMenu(W(A6,null,null,null,strings),Y,function(BE){BE.on("menuSelected",function(BF){A8._invokeDataAction(BF.dataAction,BF.dataValue);});});}});}function O(A7,BM){var BI=this,BJ=BI.header.getHeader(),BD=true,A9=false,A8=0,BO=BI.cdo._getAttachments(),A5,Y,BA,BN,BL,BE,BK,BG=true,BB,A3=BI.getRTEInstance(),BH,BC,A6;if(BI.isSending){return;}A6=function(BP){BI.allowSend=true;if(!BP){BI.setFocus("body",0,1);}else{BI._restoreFocus();}};if(BI.allowSend){if(BI.baseNode.one(".file-attach .downloading:not(.hidden)")){AQ.use("common-ui-dialog-helper",function(BP){BI.allowSend=false;BP.common.ui.DialogHelper.alert({hd:strings.str_comp_dialogheader,bd:strings.str_comp_still_uploading,suppressRestoreFocus:true},{ok:{handler:A6},cancel:{handler:A6}});});return;}}else{return;}if(BI.attView&&BI.attView.checkOverLimit()){return;}while(BD&&BO[A8]){Y=BO[A8++].state;if(!Y.cancelled&&Y.failed){BD=false;}if(Y.failCause=="virus"){A9=true;}}if(!BD){BI._alertInvalidAttachments(A9);return;}if(!BJ.validAddress){var BF=strings.str_comp_invalidAddressA+"<br><br>"+Ab(BJ.currentAddress)+"<br><br>";BF+=W(strings.str_comp_invalidAddressB,null,null,null,strings);BI._alertProblem(strings.str_comp_title_invalidAddr,BF);return;}if(BJ.to.length<1&&BJ.cc.length<1&&BJ.bcc.length<1){BI._alertProblem(strings.str_comp_title_emptyToField,strings.str_comp_emptyToField);BI.setFocus(AQ.one("#to-field"));return;}if(BM.saveBeforeSend){BI._invokeSaveDraft({saveBeforeSend:true});return;}BH=A3.all("a");BH.each(function(BQ){var BP=BQ.get("href");if(typeof(BP)==="string"){BP=BP.replace(/&amp;/g,"&");BQ.set("href",BP);}});BB=new AV.Stopwatch("SendConfirm","start");A5=BI.assembleSendBody();var A4=function(){var BS=BI.baseNode.one(".attachment-button-attach"),BQ=BI.cdo.get("origin");if(BS){BS.fire("compose:close");}if(BI.isSending){return;}else{BI.isSending=true;}BI._cancelSaveTimer();BI.dirty=false;var BP={header:BI.header.getHeader(),content:A5.html,textcontent:A5.text};BI.cdo.updateData(BP);BA={draftMID:BI.draftMID,noScroll:A7,keepDraft:BM.keepDraft?BM.keepDraft:false,cid:BQ.oMsg&&BQ.oMsg.cid};var BR=BI.cdo.oComposeData.header;BI.author.invokeSend(BI.cdo,BA,BB);};BN=At(BJ.subj);BL=At(A5.text);if(BI.getRTEDocNode().one("body img")){BG=false;}if(BN.length<1&&BL.length<1&&BG){BE=strings.str_modal_send_msg_title;BK=strings.str_comp_invalidSubjectAndContent;BC=strings.str_comp_send;}if(BI.allowSend){if(BK){BI.allowSend=false;BI.confirm(BE,BK,function(){A4();},function(){A6(AQ.one("#subject-field"));},BC);}else{A4();}}}function o(A4,A3,Y){A4.addClass(AU);}function B(Y){Y.removeClass(AU);}function b(A5,A4){var A7=this,A6,Y,A3;if(A4){A4.preventDefault();}if(!A7.allowEdit){return;}A7._switchWellGuts(A5,A4);A7._restoreFocus();A7._resizeRTE();}function e(A7,A6){var A9=this,A8,Y,A4,A3,A5;A4=d[A7].well;if(d[A7].isRTE&&!A9._isRTEActive()){A4="div.rich-text-switch-pane";}A9._closeWellGuts();A3=A9.baseNode.one(A4);B(A3);if(A3.hasClass("attachments-pane")){A9.attView.attachPaneHidden=false;}A8=A9.cdo._getAttachmentsCount();if(A8!=0){A9.baseNode.one("div.attachments-well").removeClass(AU);}else{A9.baseNode.one("div.attachments-well").addClass(AU);}A9.baseNode.one(d[A7].tab).get("parentNode").get("parentNode").addClass("active");A5=A9.baseNode.one("div.rte li.active a");A5.set("aria-selected",true);A3.set("aria-labelledby",A5.generateID());A9._switchWellCB(A7,A6);if(A6){J.set(Ah,A7);}A7!="atch"?A9.attView.reposAttachObj(Av):A9.attView.reposAttachObj(AW);}function M(Y){var A3=this;if(Y){Y.preventDefault();}A3._closeWellGuts();A3.attView.reposAttachObj(Av);J.set(Ah,"none");A3._restoreFocus();A3._resizeRTE();}function Ad(){var A4=this,Y,A3;Y=A4.baseNode.all("div.gwell");Y.each(o);A4.attView.attachPaneHidden=true;A4.baseNode.one("div.rich-text-switch-pane").addClass(AU);if((A3=A4.baseNode.one("div.rte li.active"))){A3.removeClass("active");A3.one("a").removeAttribute("aria-selected");}}function L(Y){var A3=this;A3._toggleRTEWell(Y,".rte .emoticons",".emoticons-pane");A3._toggleRTEWell(Y,".rte .rich-text",".format-pane");}function Q(A4,A6,A7){var A9=this,A5,A3,A8,Y;if(A9.baseNode.one(A6).get("parentNode").get("parentNode").hasClass("active")){A5=A9.baseNode.one(A7);A3=A9.baseNode.one(".rich-text-switch-pane");A8=A4?A3:A5;Y=A4?A5:A3;A8.addClass(AU);Y.removeClass(AU);A9._resizeRTE();}}function K(A3,Y){var A4=this;if(A3=="fmt"){A4._initializeSpellCheck();}else{if(A3=="atch"){A4.fire("darlaEvent",{action:"attch_upload_av_display"});}}}function D(){}function AN(){var A8=this,A6,BA,BE,A3=["bold","italic","underline"],A4,BF,A7,BB,BD,A9,BC,Y,A5;A8.baseNode.all("div.gwell").addClass(AU);A8.baseNode.one("div.attachments-well").addClass(AU);Y=A8.baseNode.one("div.rte");if((A5=Y.one("li.active"))){A5.removeClass("active");A5.one("a").removeAttribute("aria-selected");}A4=Y.one("b.emoticons");BB=function(BG){if(A8.baseNode.one("div.emoticons-pane").hasClass(AU)&&(A8.baseNode.one("div.rich-text-switch-pane").hasClass("hidden")||!Y.one("b.emoticons").get("parentNode").get("parentNode").hasClass("active"))){A8._switchWell("emo",BG);}else{A8._closeWell(BG);}BG.preventDefault();};A8.evt.push(A4.on("click",BB));BF=Y.one("b.rich-text");BC=A8.baseNode.one("div.format-pane");BD=function(BG){if(BC.hasClass(AU)&&(A8.baseNode.one("div.rich-text-switch-pane").hasClass(AU)||!Y.one("b.rich-text").get("parentNode").get("parentNode").hasClass("active"))){A8._switchWell("fmt",BG);}else{A8._closeWell(BG);}BG.preventDefault();};A8.evt.push(BF.on("click",BD));A7=Y.one("b.attachments");A9=function(BG){if(A8.attView.attachPaneHidden){A8._switchWell("atch",BG);}else{A8._closeWell(BG);}BG.preventDefault();
};A8.evt.push(A7.on("click",A9));BA=BC.all("select");A8.evt.push(AQ.on("change",function(BG){A8._invokeAction(BG.currentTarget.get("parentNode"),BG.currentTarget.get("value"));},BA));A8.formatButtons=BC.all(".btn");A8.evt.push(AQ.on("click",function(BG){BG.preventDefault();A8._invokeAction(BG.currentTarget,"");},A8.formatButtons));A8.formatButtons.each(function(BH){var BI,BG=A3.length,BJ=BH.getAttribute("data-action");if(BJ){for(BI=0;BI<BG;BI++){if(A3[BI]==BJ){BH.addClass("btnpress");}}}});A8.fontFamilyOptions=BC.all("span.showFontStyle select option");A8.fontSizeOptions=BC.all("span.showFontSize select option");A8.evt.push(A8.rte.after("nodeChange",function(BI){var BH,BG=BI.changedType;if(A8._isRTEActive()){if(BG==="keypress"||(!AQ.UA.ie&&BG=="keydown")){return;}if(BG==="mouseup"){return;}if(BG==="mousedown"&&BI.changedEvent&&BI.changedEvent.which>1){return;}if(BI.changedType&&BI.changedType.toLowerCase()!="execcommand"){A8._updateRTToolbar(BI);}}}));BE=A8.baseNode.all("div.rte-pane span.close");A8.evt.push(AQ.on("click",function(BG){A8._closeWell(BG);A8._restoreFocus();},BE));A8._intlBindUIRTE();}function AT(A5){var A7=this,A6=A7.getRichFontInfo(),Y=A7.getRTEDocNode(),A4=A7.getRTEInstance(),A3;A3=A5?A7.rte.get("content"):A7.rte.getContent();if(A7._isSpellCheckActive()){AQ.mail.Controller.SpellCheck.removeAllMarkers(Y,null);}return S.assembleSendBody(Y,A6,A3);}function w(){var Y=this;if(Y._isSpellCheckActive()){return;}if(Y.spellCheckView==null){if(strings.str_tog_spellcheckEnabled){Y.spellCheckView=new AQ.mail.ui.SpellCheckView(Y,Y.cdo);Y.spellCheckView.bindCDO();}else{Y.spellCheckView=0;Y.formatButtons.each(function(A3){var A4=A3.get("id");if(A4=="spellCheck"||A4=="btn-spell-langs"){A3.addClass(AU);}});}}}function v(){var Y=this;AQ.use("mail-ui-composeview-spellcheck",function(){Y._activateSpellCheck();if(Y._isSpellCheckActive()){Y.spellCheckView.doSpellCheck();Y.setFocus("body");Y.fire("darlaEvent",{action:"spell_chk"});}});}function AD(Y){var A3=this;AQ.use("mail-ui-composeview-spellcheck",function(){A3._activateSpellCheck();if(A3._isSpellCheckActive()){A3.spellCheckView.showLangMenu(Y);}});}function y(){var A4=this,Y=A4._isRTEActive(),A3;AQ.Frame.DEFAULT_CSS="body { background-color: #fff; } a, a:visited, a:hover { color: blue !important; text-decoration: underline !important; cursor: text !important; } img { cursor: pointer !important; border: none; }";if(AQ.UA.ie){if(AQ.UA.ie>=8){AQ.Frame.getDocType=function(){return"";};}if(!NeoConfig.bidi){AQ.Frame.DOM_EVENTS.keypress=0;}}if(NeoConfig.bidi&&!AQ.UA.ie){AQ.Frame.DOM_EVENTS.keyup=1;}else{AQ.Frame.DOM_EVENTS.keyup=0;}A4.rte=new AQ.EditorBase({extracss:A4._getExtraCSS(Y),defaultblock:AQ.UA.webkit?"div":"p",dir:NeoConfig.bidi&&strings.str_tog_loadRTLCss?"rtl":"ltr"});AQ.Plugin.ExecCommand.COMMANDS.fontsize=null;A4.rte.plug(AQ.Plugin.EditorPara);if(NeoConfig.bidi){A4.rte.plug(AQ.Plugin.EditorBidi);A4.rte.plug(AQ.Plugin.EditorAutoBidi);}A4.rte.frame.after("ready",function(){var A5,A6;A4.rte.frame._iframe.setStyle("visibility","inherit");if(A4.initialResize){A4._setRTEBorder();}A4._resizeRTE();A4.rteReady=true;A4.rte.frame.getInstance().one("win").on("focus",function(){A4._registerFocus(A4.rte);});A4.rte.frame.on("dom:keydown",function(A8){var A7=false;if(A8.ctrlKey||A8.metaKey||A8.altKey||A8.shiftKey){A7=A4.author?A4.author.onKeyDown(A8):A4.onKeyDown(A8);}if(A7){A8.halt();}else{A4.rteHasContent=true;A4._setDirty();}});A4.rte.frame.on("dom:mousedown",function(A7){A4.header._removeLozengeHighlights();});A4.rte.after("dom:paste",function(A7){A4._resizeRTE(true);});if(A4.contentInitialized){A4._initializeRTEContent(A4.contentInitialized);}if(AQ.UA.ie){AQ.Node.getDOMNode(A4.getRTEDocNode().one("body")).contentEditable=true;}if(A4.focusNode){A4.setFocus(A4.focusNode);}A3=S.getDefaultFontInfo(!Y);A4.rte.frame.getInstance().one("body").setStyles({"fontSize":A3.fontSize,"fontFamily":A3.fontFamily});A5=AQ.one("#rtetext iframe");if(A5){A5.set("title",strings.str_comp_messagebody);}A6=A4.rte.frame.getInstance().one("body");if(A6){A6.set("aria-label",strings.str_comp_messagebody);if(NeoConfig.bidi&&NeoConfig.isRTL){A6.set("dir","rtl");}}});}function AF(){return this.rte;}function AB(){return this.getRTE().getInstance();}function Am(){return this.getRTEInstance().one("doc");}function AS(){var Y=this;if(NeoConfig.fullPage){Y.rteArea.addClass("border");Y.rte.frame._iframe.set("height","100%");Y.rte.frame._iframe.setStyle("border","1px solid #EEE");}}function Ae(A5){var A7=this,Y,A4,A6,A3=false;if(A7.resizeNode&&A7.resizeNestCount==0){A4=A7.resizeNode.ancestor("TBODY").get("children");Y=A7.baseNode.get("offsetHeight")-A4.item(0).get("offsetHeight")-A4.item(1).get("offsetHeight");if(Y<As){Y=As;A3=true;}if(A5||Y!=A7.resizeRTEHeight){A7.resizeRTEHeight=Y;A6=A7.baseNode.one("div.compose-message");A6.setStyle("height",Y+"px");if(NeoConfig.fullPage&&AQ.UA.ie>0&&AQ.UA.ie<8){A7.resizeNestCount++;A6.ancestor("TR").setStyle("height",Y+"px");A6.ancestor("TD").setStyle("height",Y+"px");A7.resizeNestCount--;}if(A7.rte&&A7.rteReady&&AQ.UA.ie){A7.rte.frame._ieSetBodyHeight();}if(!NeoConfig.fullPage){A7.baseNode.setStyle("overflow-y",A3?"scroll":"hidden");}}}}function H(){var A5=this,A4,Y,A3;if(NeoConfig.fullPage){if(A5.baseNode==null){return;}A4=A5.baseNode.one("table");if(A4==null){return;}A3=parseInt(A4.one(".compose-header").getStyle("height"));Y=AQ.one("body").get("winHeight")+A3;if(Y<Af){Y=Af;}A4.setStyle("height",Y+"px");if(AQ.UA.ie){A5.baseNode.setStyle("height",Y+"px");A5._resizeRTE(true);}}}function n(A5){var A6=this,A3,Y,A4;if(!0){A3=A5.commands;A6.formatButtons.removeClass("pressed");A6.formatButtons.each(function(A9){var A8=A9.getAttribute("data-action"),A7=A9.hasClass("btnpress");if(A8&&A3[A8]&&A7){A9.addClass("pressed");}});A6.fontFamilyOptions.each(function(A7){var A8=A7.get("value").toLowerCase();if(A8.indexOf(","!==-1)){A8=(A8.split(","))[0];}if(A8===A5.fontFamily){A7.set("selected",true);}});Y=parseInt(A5.fontSize.replace("px",""));if(!isNaN(Y)){A6.fontSizeOptions.item(A6._fontSizeMatch(Y)).set("selected",true);
}else{if(AQ.UA.webkit){Y=A6._fontSizeMatchWebkit(A5.fontSize);if(!isNaN(Y)){A6.fontSizeOptions.item(Y-1).set("selected",true);}}}if(A5.fontColor){if(!A6._formatPane){A6._formatPane=A6.baseNode.one(".format-pane");}A4=A6._formatPane.one("#btn-forecolor i");A4.setStyle("backgroundColor",A5.fontColor);}}}function u(A6){var A7=10000,A4,A3=A6,A5,Y=g.length;if(A3>7){for(A5=0;A5<Y;A5++){A4=Math.abs(A6-g[A5]);if(A4<A7){A7=A4;A3=A5;}}}else{if(A3){A3--;}}return A3;}function AC(Y){var A3=Y=="-webkit-xxx-large"?7:Y=="xx-large"?6:Y=="x-large"?5:Y=="large"?4:Y=="medium"?3:Y=="small"?2:Y=="x-small"?1:Y;return A3;}function AI(A4,A3,Y){var A5=U(A4);AQ.one("body").appendChild(A5);AQ.use("comms-ui-menu-base",function(A6){A3.plug(A6.Plugin.Menu,{"menu":A5});A3.menu.show();A5.delegate("mousedown",function(BB){BB.halt();var BA=BB.target,A9=BB.currentTarget,A7=BA.ancestor(function(BD){return BD.getAttribute("data-action")||BD===A9;},true),A8=A7?A7.getAttribute("data-action"):0,BC=A7.getAttribute("data-value")||"";A5.fire("menuSelected",{dataAction:A8,dataValue:BC,item:A7});A3.menu&&A3.menu.hide();},"li");Y(A5);});return A5;}function N(Y){var A5=this,A4,A3=AQ.mail.model.DataStore.Messages.getPermMidPart;if(Y&&Y.oMsg&&A5.draftMID){return A3(A5.draftMID)==A3(Y.oMsg.mid);}if(!A5._isOrigin()){if(!Y||!Y.oMsg){return true;}}if(Y&&Y.oMsg){A4=A5.cdo.get("origin");return(Y.action===A4.action&&Y.fid===A4.fid&&Y.oMsg.mid===A4.oMsg.mid&&Y.forwardAsAttachment===A4.forwardAsAttachment);}return false;}function Al(){var A3=this,Y;Y=A3.cdo.get("origin");return(Y.action&&Y.fid&&Y.oMsg);}function AY(){var A3=this,Y;Y=A3.cdo.get("origin");A3._clearOriginTimers();A3._writeLoadingHtml(Y.errInfo=="ok"?"pop":"slow");}function x(){var Y=this;Y._writeLoadingHtml("start");}function A0(A3){var Y=this;if(Y.loadingArea.hasChildNodes()){Y.loadingArea.get("children").remove();}Y.loadingArea.appendChild(U(W(Ay.base,null,Y.loadFormatters,A3,strings,Au)));}function Ac(){var Y=this;Y.slowOriginReqTimer&&clearTimeout(Y.slowOriginReqTimer);Y.loadingTimer&&clearTimeout(Y.loadingTimer);}function AH(Y){var A5=this,A4,A3;if(A5.allowSend){AQ.use("common-ui-dialog-helper",function(A6){A5.allowSend=false;A4={hd:Y?strings.str_rte_attachments_alert_virus_title:strings.str_comp_dialogtitle_invalidSendAttachments,bd:Y?strings.str_rte_attachments_alert_virus:strings.str_comp_dialogbody_invalidSendAttachments,suppressRestoreFocus:true};A3=function(){A5.allowSend=true;A5._restoreFocus();};A6.common.ui.DialogHelper.alert(A4,{ok:{handler:A3},cancel:{handler:A3}});});}else{A5._restoreFocus();}}function s(A4,A3,Y){AZ.push({params:AQ.clone(A4),appInstance:A3,handler:Y});AQ.fire("om:compose_add_btn");}function X(Y){AQ.each(AZ,function(A3,A4){if(A3.appInstance===Y){AZ.splice(A4,1);}});AQ.fire("om:compose_remove_btns",Y);}AQ.extend(AP,AQ.mail.ui.MailCompose);AQ.mix(AP.prototype,{NAME:"FullCompose",render:AK,bindUI:C,onKeyDown:i,onFocus:p,handleActiveChanged:AG,handleToolbarSelection:F,handleCloseChange:Aq,updateToolbar:k,getRTE:AF,getRTEInstance:AB,getRTEDocNode:Am,getContent:A,getFirstNode:R,setContent:r,setFocus:Aj,contentChangeAfter:AL,replyheaderChangeAfter:Ax,replyContentChangeAfter:t,postRender:Ai,matchOrigin:N,_bindCDO:AM,_bindUIRTE:AN,_initOpenMailButtons:Ag,_addFocusListeners:Ao,_intlBindUIRTE:D,_allowEditing:Aa,_invokeRTECommand:AE,_invokeDataAction:a,_invokeAction:Ar,_initializeRTE:y,_resizeRTE:Ae,_isRTEActive:Aw,_updateRTToolbar:n,_initializeRTEContent:A2,_setRTEBorder:AS,_adjustLowRes:l,_resizeComposePage:H,assembleSendBody:AT,_invokeSend:O,_closeWell:M,_closeWellGuts:Ad,_switchWell:b,_switchWellGuts:e,_switchWellCB:K,_toggleRTEWellMode:L,_toggleRTEWell:Q,_switchEditMode:G,_cmdTextSwitch:An,_showMenus:AJ,_showRTEMenu:AI,_alertInvalidAttachments:AH,_initializeSpellCheck:AA,_activateSpellCheck:w,_isSpellCheckActive:Az,_doSpellCheck:v,_openSpellCheckMenu:AD,_isOrigin:Al,_handleSlowOriginRequest:AY,_displayLoading:x,_writeLoadingHtml:A0,_clearOriginTimers:Ac,_setComposePreference:m,_getExtraCSS:P,_fontSizeMatch:u,_fontSizeMatchWebkit:AC,ondestroy:function(){AP.superclass.ondestroy.call(this,arguments);}},true);AQ.namespace("mail");AQ.mail.ComposeView=AP;AQ.mix(AQ.mail.ComposeView,{addButton:s,removeButtons:X},true);if(NeoConfig.intl==="jp"){AQ.use("mail-ui-composeview-base-jp",function(A3){A3.extend(A3.mail.ComposeViewJp,AP);A3.mail.ComposeView=A3.mail.ComposeViewJp;});}},"1.0.0",{requires:["mail-ui-mailcompose","mail-ui-messagepane-utils","forms_css","rte_css","attachments_css","mod-stationery_css","mod-compose_css","mail-ui-composeview-attach","editor-base","editor-para","editor-br","node","stylesheet","mail-controller-compose-text","mail-model-compose","contacts-api-utils","contacts-api","filter-contacts","plugin","comms-bidi-textentry","comms-editor-autobidi","comms-intl-bidi","editor-bidi","_shared_module_compose","_shared_module_toolbar_compose","_shared_module_compose_loading","_shared_module_offscreen_bin_compose","_shared_module_offscreen_bin_compose_menu_spellcheck","_shared_module_offscreen_bin_compose_modal_cancel_compose","_shared_module_rte_well_content_format","_shared_module_rte_well_content_emoticons","_shared_module_rte_well_content_attachments","_shared_module_rte_well_tabs_compose","common-ui-toolbar-base","_shared_module_offscreen_bin_compose_menu_list","_shared_module_offscreen_bin_compose_menu_text_align"]});YUI.add("swfdetect",function(C){var J=0,H=C.UA,E=C.Lang,M="ShockwaveFlash",B,G,D,N,A;function L(O){return parseInt(O,10);}function F(O){if(E.isNumber(L(O[0]))){H.flashMajor=O[0];}if(E.isNumber(L(O[1]))){H.flashMinor=O[1];}if(E.isNumber(L(O[2]))){H.flashRev=O[2];}}if(H.gecko||H.webkit||H.opera){if((B=navigator.mimeTypes["application/x-shockwave-flash"])){if((G=B.enabledPlugin)){D=G.description.replace(/\s[rd]/g,".").replace(/[A-Za-z\s]+/g,"").split(".");F(D);}}}else{if(H.ie){try{N=new ActiveXObject(M+"."+M+".6");N.AllowScriptAccess="always";}catch(I){if(N!==null){J=6;}}if(J===0){try{A=new ActiveXObject(M+"."+M);D=A.GetVariable("$version").replace(/[A-Za-z\s]+/g,"").split(",");F(D);}catch(K){}}}}C.SWFDetect={getFlashVersion:function(){return(String(H.flashMajor)+"."+String(H.flashMinor)+"."+String(H.flashRev));},isFlashVersionAtLeast:function(R,T,S){var P=L(H.flashMajor),Q=L(H.flashMinor),O=L(H.flashRev);R=L(R||0);T=L(T||0);S=L(S||0);if(R===P){if(T===Q){return S<=O;}return T<Q;}return R<P;}};},"@VERSION@");YUI.add("mail-service-uploader",function(B){var A=function(D){if(NeoConfig.flashUploaderPercentage==""){NeoConfig.flashUploaderPercentage=100;}var E=!!(D.mail.UploaderServiceDebug||false),F=parseInt(NeoConfig.flashUploaderPercentage,10),J=parseInt(Math.random()*100,10),M=(J>=F);D.namespace("mail");var G=(window.location.search.indexOf("uploader=yui")>0),H=(window.location.search.indexOf("uploader=form")>0)&&!G,K=function(P,N,Q){var O=D.log;if(D.mail.UploaderServiceDebug){D.mail.UploaderServiceDebug.logIt(P,N,Q);}if(window.location.search.indexOf("uploaddebug=1")>0){O(P);}};if((NeoConfig.isFullSSL&&!NeoConfig.isAttachSSL)||M){G=false;H=true;}function I(){var N=NeoConfig.yuiUploaderDisabledIntls;if(N=="1"){return false;}return D.SWFDetect.isFlashVersionAtLeast(10,1,0);}function C(){var N=D.mail.UploaderService,O=D.common.Utils.rocketstats;K("Uploader Service: Determining default uploader...");if(I()&&!H){K("Uploader Service: YUI is the default Uploader",null,"YUI");N.DEFAULT_UPLOADER=N.UPLOADER_TYPE_YUI;O.intlStat("UploaderService","UploaderTypeYUI");N.INITIAL_UPLOADER=N.UPLOADER_TYPE_YUI;}else{K("Uploader Service: Flash is not available");K("Uploader Service: Form is the default Uploader",null,"Form");N.DEFAULT_UPLOADER=N.UPLOADER_TYPE_FORM;O.intlStat("UploaderService","UploaderTypeForm");N.INITIAL_UPLOADER=N.UPLOADER_TYPE_FORM;}N.emptyCreateQueue();return;}D.mail.UploaderService={debug:E,UPLOADER_TYPE_WAIT:"wait",UPLOADER_TYPE_FORM:"form",UPLOADER_TYPE_YUI:"yui",UPLOADER_TYPE_FLASH:"yui",UPLOAD_URL_BASE:NeoConfig.launch_protocol+(NeoConfig.attachmentServer?NeoConfig.attachmentServer+"/":"")+((NeoConfig.isFullSSL&&!NeoConfig.isAttachSSL)?window.location.host:(strings["str_cfg_base_intl"]+"."+NeoConfig.farm+".mail.yahoo."+(NeoConfig.intl=="jp"?"co.jp":"com")))+"/ya/upload",DEFAULT_UPLOADER:"wait",createQueue:[],uploadersCreated:{},uploadersCount:0,rs:D.common.Utils.rocketstats,handlePostRedirectResponse:function(N){var Q=D.common.Utils.parseQueryString(N);var P=this.uploadersCreated[Q.uploaderID];var O=this.parseResponse(Q);P.handlePostRedirectResponse(O);},parseResponse:function(P){var O=[],Q,U,T,X=parseInt(P.cdoidx,10),S=(P.filename+"").split(","),W=(P.mimetype+"").split(","),V=(P.filesize+"").split(","),N=(P.diskfilename+"").split(","),R=(P.errorcode+"").split(",");for(T=0;T<R.length;T++){Q={cdoIndex:X+T,filename:S[T],mimetype:W[T],size:{original:parseInt(V[T],10)},serverID:N[T],thumbData:null};this.setAttachmentState(Q,R[T]);O.push(Q);}return O;},setAttachmentState:function(Q,O){O=O||Q.attachCode;var S=this,R=S.type||S.DEFAULT_UPLOADER,N={attachcode:O,resampled:false,cancelled:false,rotated:false,uploaded:false,scanned:false,failed:false},P=0;switch(O){case"uploadAVNoVirus":case"uploadAVCleaned":N.scanned=true;N.uploaded=true;S.rs.intlStat("UploaderService",R+"Attachment_UploadSuccess");break;case"uploadAVInternalError":case"uploadAVError":case"uploadAVNotScannable":case"uploadAVServerDown":N.uploaded=true;N.failed=false;N.failCause="averror";S.rs.intlStat("UploaderService",R+"Attachment_UploadSuccessNoAV");break;case"uploadFileSizeError":N.failed=true;N.failCause="size";S.rs.intlStat("UploaderService",R+"Attachment_UploadFail");P=1;break;case"uploadNoFileError":N.failed=true;N.failCause="nofile";S.rs.intlStat("UploaderService",R+"Attachment_UploadFail");P=1;break;case"uploadAVCannotClean":case"uploadAVHasVirus":N.scanned=true;N.uploaded=true;N.failed=true;N.failCause="virus";S.rs.intlStat("UploaderService",R+"Attachment_UploadFailVirus");P=1;break;case"uploaderFormUploadNoResponse":N.failed=true;N.failCause="form_upload_no_response";S.rs.intlStat("UploaderService",R+"Attachment_UploadNoResponse");P=1;break;case"uploaderFormUploadUnexpectedResponse":N.failed=true;N.failCause="form_upload_unexpected_response";S.rs.intlStat("UploaderService",R+"Attachment_UploadUnexpectedResponse");P=1;break;case"uploaderFormUploadTimeout":N.failed=true;N.failCause="form_upload_timeout";S.rs.intlStat("UploaderService",R+"Attachment_UploadTimeout");P=1;break;case"uploaderFormUserCancelled":N.cancelled=true;N.failCause="form_upload_cancelled";S.rs.intlStat("UploaderService",R+"Attachment_UploadCancelled");break;case"uploaderYUIUploadError":N.failed=true;N.failCause="yui_upload_error";S.rs.intlStat("UploaderService",R+"Attachment_UploadError");P=1;break;case"uploaderYUIResponseTimeout":N.failed=true;N.failCause="yui_response_timeout";S.rs.intlStat("UploaderService",R+"Attachment_UploadResponseTimeout");P=1;break;case"uploaderYUIUploadStartTimeout":N.failed=true;N.failCause="yui_uploadstart_timeout";S.rs.intlStat("UploaderService",R+"Attachment_UploadStartTimeout");P=1;break;case"uploaderYUIProgressTimeout":N.failed=true;N.failCause="yui_progress_timeout";S.rs.intlStat("UploaderService",R+"Attachment_UploadProgressTimeout");P=1;break;case"uploaderYUIUploadCompleteTimeout":N.failed=true;N.failCause="yui_uploadcomplete_timeout";S.rs.intlStat("UploaderService",R+"Attachment_UploadUploadCompleteTimeout");P=1;break;case"uploaderYUIUserCancelled":N.cancelled=true;N.failCause="yui_upload_cancelled";S.rs.intlStat("UploaderService",R+"Attachment_UploadCancelled");break;case"uploaderYUIAutoRetryAll":N.failed=true;N.failCause="yui_upload_error_retry";S.rs.intlStat("UploaderService",R+"Attachment_UploadErrorRetry");break;case"uploaderYUIAutoRetry2038":N.failed=true;N.failCause="yui_upload_error2038";S.rs.intlStat("UploaderService",R+"Attachment_UploadError2038");break;case"uploaderYUIError2049":N.failed=true;N.failCause="yui_upload_error2049";S.rs.intlStat("UploaderService",R+"Attachment_UploadError2049");P=1;break;case"uploaderYUICredExpired":N.failed=true;N.failCause="yui_upload_302";S.rs.intlStat("UploaderService",R+"Attachment_UploadError302");break;case"uploadInternalError":N.failed=true;N.failCause="internal_server_error";S.rs.intlStat("UploaderService",R+"Attachment_InternalServerError");P=1;break;case"uploadMailboxError":N.failed=true;N.failCause="mailbox_error";S.rs.intlStat("UploaderService",R+"Attachment_MailboxError");
P=1;break;case"uploadPartialFileError":N.failed=true;N.failCause="partial_file_error";S.rs.intlStat("UploaderService",R+"Attachment_PartialFileError");P=1;break;case"uploadAuthError":N.failed=true;N.failCause="upload_auth_error";S.rs.intlStat("UploaderService",R+"Attachment_UploadAuthError");P=1;break;default:N.failed=true;N.failCause="generic";S.rs.intlStat("UploaderService",R+"Attachment_UploadFail");P=1;}S.rs.intlStat("UploaderService",R+"AttachmentStatus_"+O);if(N.failed){D.use("common-utils-error",function(T){T.common.Utils.error.report(O+":"+N.failCause,"ATTACH_UPLOAD_ERR",1,0,1);});}if(P){S.rs.intlStat("UploaderService",R+"UploaderFail_"+S.INITIAL_UPLOADER);}Q.state=N;},emptyCreateQueue:function(){var N=this.createQueue;for(var O=0;O<N.length;O++){N[O]();}},create:function(P,O,Q){var R=this,N=function(){Q=Q||R.DEFAULT_UPLOADER;var S="mail-service-uploader-"+Q;R.type=Q;D.use(S,function(X){var V=new Date(),U=V.getTime(),W=R.uploadersCreated,T;P.uploaderID=U;switch(Q){case"yui":X.mail.Uploader=X.mail.UploaderYUI;break;case"form":X.mail.Uploader=X.mail.UploaderForm;break;}T=new X.mail.Uploader(P);if(T.fail){R.rs.intlStat("UploaderService","UploaderInstanceCreationFailed_"+Q);K("Uploader Service: Uploader creation failed for "+Q,"color:red;font-weight:bold;");R.DEFAULT_UPLOADER=R.UPLOADER_TYPE_FORM;K("Uploader Service: Reverting to uploader type: "+R.DEFAULT_UPLOADER);R.rs.intlStat("UploaderService","UploaderCreationFallback_"+R.DEFAULT_UPLOADER);S="mail-service-uploader-"+R.DEFAULT_UPLOADER;X.use(S,function(Z){R.create(P,O);});return;}else{R.rs.intlStat("UploaderService","UploaderInstanceCreated_"+Q);}W[U]=T;R.uploadersCount++;if(R.uploadersCount<6){R.rs.intlStat("UploaderService","UploadersCreated_"+R.uploadersCount);}else{if(R.uploadersCount==6){R.rs.intlStat("UploaderService","UploadersCreated_Plus");}}T.updateUI();if(O){O(T);}});};if(R.DEFAULT_UPLOADER===R.UPLOADER_TYPE_WAIT){R.createQueue.push(N);R.rs.intlStat("UploaderService","UploaderCreationQueued");}else{N();}}};D.mail.UploaderService.logIt=K;C();var L=function(N){function O(Q,P){this.theQueue.push({action:Q,att:P});}};D.mail.attachmentQueue=L;};A(B);},"1.0.0",{requires:["_shared_module_compose","mail-controller-compose","mail-model-compose","rocket-stats","common-utils","swfdetect"]});YUI.add("_shared_module_compose_title",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_compose_title={base:"<span class='compose'><span>{{str_comp_title}}</span>{{compose_title}}</span>"};},"1.0.0");YUI.add("mail-ui-authorview-base",function(G){var R=G.Node.create,a="hidden";var X=function(){var h=this,Y;h.keyCodes=[];h.keyCodesL10N={};h.parent=null;h.subview=null;h.subviews=[];h.cdo=null;h.composeView=null;h.composeViewTainer=null;h.sendConfirmView=null;h.sendConfirmViewTainer=null;h.captchaView=null;h.captchaViewTainer=null;h.localCharCodes=[8,77,78,73,84];h.firstRender=true;h.composeActive=true;h.type="author";h.keyCodesL10N[strings["str_cfg_sc_keycode_save_as_draft"]]=83;h.keyCodesL10N[strings["str_cfg_sc_keycode_close_tab"]]=220;for(Y in h.keyCodesL10N){h.keyCodes.push(Y);}X.superclass.constructor.call(h);h.modifyAttr("canClose",{getter:function(){if(h.subview.canWeClose){return h.subview.canWeClose();}else{return true;}}});h.set("charCodes","13,13+ctrl,13+meta,27,188+ctrl,190+ctrl,"+h.keyCodes.join("+ctrl,")+"+ctrl,"+h.keyCodes.join("+meta,")+"+meta");if(G.UA.ie){h.set("localCharCodes",h.localCharCodes.join());}h.on("activeChange",h.proxyActiveChanged);h.after("activeChange",h.proxyAfterActiveChanged);h.on("closeChange",h.proxyCloseChange);h.updateTabTitle(h.get("title"));h.dsMsgChgHandler=G.on("ds:msg:change",h.handleDSMessageChange,h);};function Z(Y){var h=this;G.each(h.subviews,function(i){i.handleCloseChange&&i.handleCloseChange(Y);G.each(i.handles,function(j){j.detach&&j.detach();});});h.composeViewTainer&&h.composeViewTainer._node&&h.composeViewTainer.remove(true);h.sendConfirmViewTainer&&h.sendConfirmViewTainer._node&&h.sendConfirmViewTainer.remove(true);h.dsMsgChgHandler&&h.dsMsgChgHandler.detach();}function C(j,r,l,t,o){var p=this,s=p.cdo&&p.cdo.oComposeData&&p.cdo.oComposeData.origin,h,k,m,Y=l&&l[0],n,q;if(s){h=s.oMsg;k=s.fid;m=s.action;}if((m=="reply_all"||m=="reply_sender"||m=="forward")&&o=="move"){for(n=0;h&&n<l.length;n++){q=l[n].mid;if(G.mail.model.DataStore.Messages.hasMoved(h.mid,q,k,j)){p.backToMessageTab=null;p.subview.showToolbarButtons&&p.subview.showToolbarButtons();p.dsMsgChgHandler&&p.dsMsgChgHandler.detach();return;}}}}function g(Y){var h=this;Y=Y||strings["str_tabs_compose"];h.set("title",Y);}function T(Y){var h=this;h.set("direction",Y);}function D(Y){var h=this;if(h.firstRender){h.firstRender=false;return;}if(h.subview.handleActiveChanged){h.subview.handleActiveChanged(Y);}else{}}function P(Y){this.subview.handleAfterActiveChanged&&this.subview.handleAfterActiveChanged(Y);}function N(j){var k=this,Y=k.localCharCodes.length,h;for(h=0;h<Y;h++){if(j==k.localCharCodes[h]){return true;}}return false;}function J(Y){var i=this,h=Y.keyCode;h=i.keyCodesL10N[h]||h;switch(h){case 220:if(!Y.altKey&&(Y.metaKey||Y.ctrlKey)){i.set("close",1);return true;}break;case 27:i.set("close",1);return true;break;}if(G.UA.ie&&i.subview.onLocalKeyDown){if(!i.subview.onLocalKeyDown(Y)){return false;}}if(i.subview&&i.subview.onKeyDown){return i.subview.onKeyDown(Y);}else{return null;}}function K(Y){var h=this;if(h.subview.onFocus){return h.subview.onFocus(Y);}else{return null;}}function Q(){var Y=this;if(Y.subview.isDirty){return Y.subview.isDirty();}else{return true;}}function E(){var Y=this;if(Y.subview.isSaved){return Y.subview.isSaved();}else{return false;}}function S(Y){var h=this;if(h.subview.matchOrigin){return h.subview.matchOrigin(Y);}else{return false;}}function F(Y){var h=this;h.set("contentToolbar",Y);if(Y){Y.on("itemSelected",O,h);}}function O(Y){var h=this;if(Y.item&&Y.item.ancestor().hasClass("disabled")){return;}if(h.subview.handleToolbarSelection){h.subview.handleToolbarSelection(Y);}else{}}function B(Y){var h=this;h.sendConfirmViewTainer.addClass(a);h.composeViewTainer.removeClass(a);h.composeView.isSending=false;h.composeView.updateToolbar();h.composeView.resetSaveTimer();if(Y){h.composeView.dirty=true;}h.composeActive=true;h.subview=h.composeView;}function W(Y){var i=this,h;i.sendConfirmViewTainer.removeClass(a);i.composeViewTainer.addClass(a);i.sendConfirmView.updateToolbar();if(!Y&&NeoConfig.fullPage){h=G.config.win||window,h.scrollTo(0,0);}i.composeActive=false;i.subview=i.sendConfirmView;i.sendConfirmViewTainer.setAttribute("tabIndex","-1");i.set("focusNode",i.sendConfirmViewTainer.one(".col-a"));i.sendConfirmViewTainer.one(".col-a").focus();}function c(i,h){var j=this,Y;i.cdo&&i.cdo.get("passive")?Y=i.cdo:Y=G.mail.Controller.Compose.createCDO();h=false||h;if(h){j.setDraftOrigin(Y,i);j.setDraftFromAddress(Y);}else{j.setMessageFromAddress(Y);j.setMessageOrigin(Y,i);}if(i&&i.cbfn){Y.set("prePopulated",true);i.cbfn(Y,i);}if(!i||!i.action||!i.fid||!i.oMsg){G.mail.Controller.Compose.insertSignature(Y);}return Y;}function M(h,Y){var i=this;Y=false||Y;i.cdo=i.initComposeData(h,Y);i.cdo.handles=[];i.subview=i.createComposeView(i.cdo,Y,h);i.subviews.push(i.subview);if(h&&h.postRender){i.subview.handles.push(i.subview.on("renderComplete",function(){h.postRender(i,h);}));}if(h&&h.oMsg&&h.oMsg.header){h.oMsg.header.subject=G.mail.Controller.Compose.seedSubject(h);}return i.subview;}function I(Y,j,h){var i=this;h&&h.start(1,"moduleLoad");G.use("mail-controller-sendconfirm","mail-ui-sendconfirmview-base",function(m){var k=i.sendConfirmView?i.sendConfirmView.sdo:null,l=m.mail.persist.MetaData.get("cg.pref.general.showconfirmpage");if(h){h.start(1,"prepareSend");h.action="normal";}k=m.mail.Controller.Compose.transformSend(Y,k,j,true);i.createSendConfirmView(k,Y);m.mail.Controller.SendConfirm.sendMessage(k,h);m.use("contacts-api-utils",function(n){i.showSendConfirm(j.noScroll);});});}function d(Y,h){if(h&&h.action&&h.fid&&h.oMsg){Y.set("origin",{action:h.action,fid:h.fid,oMsg:h.oMsg,forwardAsAttachment:h.forwardAsAttachment,ctxReq:null});}}function A(Y){var h=Y.get("header");h.from=G.mail.Controller.Compose.getDefaultFromAddress();Y.set("header",h);}function H(Y,h){if(h&&h.action&&h.fid&&h.oMsg){Y.set("origin",{action:h.action,fid:h.fid,oMsg:h.oMsg,ctxReq:null});}}function U(Y){var i=Y.get("header"),h=Y.get("origin").oMsg;i.from=h.from?h.from:(h.header||{}).from;Y.set("header",i);}function L(j,Y){var n=this,m=Y.get("origin"),l=0,k=0,i=null,h=null;if(!!m&&m.action&&m.action=="reply_sender"||m.action=="reply_all"){l=1;
}else{if(!!m&&m.action=="forward"){k=1;}}i=new G.mail.SendConfirmView({sdo:j,author:n,isReply:l,isForward:k});i.handles=[];i.handles.push(i.on("darlaEvent",function(o){n.fire("darlaEvent",o);}));h=R('<div class="hidden">');h.addClass(a);i.render(h);n.parent.appendChild(h);n.set("rootNode",n.parent.get("firstChild"));i.postrender(h);n.set("children",[i]);n.sendConfirmView=i;n.subviews.push(i);n.sendConfirmViewTainer=h;}function f(Y,i,j){var k=this,h=null;h=new G.mail.ComposeView(Y,i,k,j);h.handles=[];h.handles.push(h.on("darlaEvent",function(l){k.fire("darlaEvent",l);}));k.set("children",[h]);k.composeView=h;return h;}function V(){var Y=this;Y.parent=Y.get("parentNode");Y.composeView.render(Y.parent);Y.composeViewTainer=Y.composeView.baseNode;Y.composeView.postRender();}function e(h){var i=this,Y=G.one(h);i.set("parentNode",Y);i.set("rootNode",Y.get("firstChild"));return;}function b(){return;}G.extend(X,G.mail.ui.BaseWidget);G.mix(X.prototype,{NAME:"AuthorView",onKeyDown:J,onFocus:K,bindUI:b,render:e,initCompose:M,initComposeData:c,createComposeView:f,bindComposeView:V,createSendConfirmView:L,showSendConfirm:W,showCompose:B,isLocalCharCode:N,isDirty:Q,isSaved:E,invokeSend:I,matchOrigin:S,setMessageOrigin:d,setMessageFromAddress:A,setDraftOrigin:H,setDraftFromAddress:U,attachToolbar:F,proxyToolbarSelection:O,proxyActiveChanged:D,proxyAfterActiveChanged:P,updateTabTitle:g,updateTabDirection:T,proxyCloseChange:Z,handleDSMessageChange:C},true);G.namespace("mail.ui");G.mail.ui.AuthorView=X;},"1.0.0",{requires:["mail-controller-base","mail-controller-compose","mail-ui-composeview-base","mail-service-uploader","_shared_module_compose_title"]});YUI.add("om-ui-composeview",function(D){var C=false;var A=function(){var E=this;A.superclass.constructor.apply(E,arguments);!C&&E.once("renderComplete",function(){D.use("om-ui-sendconfirm",B);});D.fire("om:compose.start",{cdo:E.cdo},E);};function B(E){E.mail.ui.Factory.register("mail.SendConfirmView",E.om.ui.SendConfirmView);C=true;}D.extend(A,D.mail.ComposeView,{NAME:"OMComposeView"},{addButton:D.mail.ComposeView.addButton,removeButtons:D.mail.ComposeView.removeButtons});D.namespace("om.ui");D.om.ui.ComposeView=A;},"1.0.0",{requires:["mail-ui-composeview-base"]});YUI.add("om-controller-compose-events",function(A){var Q=A.om,F=Q.Controller,B=F.extend("ComposeEvents"),N=Q.common.Utils,H=function(){A.log.apply({},arguments);N.log.apply({},arguments);},K=A.Lang,P=A.common.Utils,E=A.contacts.utils,C=0,R={},D={START:"compose.start",SENDSTART:"compose.sendstart",SENDCOMPLETE:"compose.sendcomplete",USER_EVENT:"compose.user_event"};function J(X,U,Y){var V={};this.view=Y;try{V=this.formatData(A.clone(U||{}));}catch(W){H('Bad incomding data to Open Mail event "'+this.eventName+'" : '+W.message);throw W;}var L=Y&&(Y.cdo||Y.sdo),S=L&&L._yuid,Z=L&&L.get&&L.get("origin"),T;switch(Z&&Z.action){case"reply_sender":case"reply_all":T="reply";break;case"forward":T="forward";break;default:T="compose";}this.returnEventId=X+A.guid("-");this.sharedData={data:V,action:T,instance:S||"",cancel:G(J.CANCEL,this.eventName,this.returnEventId),proceed:G(J.SUCCESS,this.eventName,this.returnEventId)};}J.CANCEL="cancel";J.SUCCESS="success";J.prototype={eventName:"",onCancel:function(){},onSuccess:function(){},getSharedData:function(){return this.sharedData;},formatData:function(L){return L;},validateSuccessData:function(L){return true;},validateCancelData:function(L){return true;},validateLog:function(L,S){var U;if(!L){U=["OM compose_event: Invalid data from App."," returnEventId=",this.returnEventId,", data="].join("");try{U+=A.JSON.stringify(S||"");}catch(T){U+="(Error stringifying data: "+T.message+")";}H(U);}return L;},responseHandler:function(S,T,L){if(S.returnCode===J.SUCCESS){this.validateSuccessData(S.data)&&this.onSuccess.apply(this,arguments);}else{if(S.returnCode===J.CANCEL){this.validateCancelData(S.data)&&this.onCancel.apply(this,arguments);}else{H("OM compose_events handler - unhandled returnCode ["+S.returnCode+"], event: "+this.returnEventId);}}}};function G(S,L,T){return["function(o) { ",'    var _context = { eventName: "',L,'",','                     returnEventId: "',T,'"};','    var _params =  { cmd:"returnEvent", args:{ ctx:_context, ','                     returnCode:"',S,'", data:o } };',"    openmail.Application.callWebService( ",'          { url:"apps://", method:"GET", parameters : _params });',"};"].join("");}function M(S){var L=S.eventName;R[L]=A.Base.create(L,J,[],S);}C&&M({eventName:D.START,formatData:function(U){var L=U.cdo,V=L.get("header"),T=L.get("isRichText"),S=L.get("origin");return{header:V,isRich:T,content:T?L.get("content"):L.get("textcontent"),fid:S.fid||"",action:S.action||""};},onSuccess:function(S,T,L){H("compose.start success callback");}});M({eventName:D.SENDSTART,formatData:function(T){var S=T.sdo,U=S.get("header"),L=A.clone(S.get("recipients"),true);A.Array.each([].concat(L.to,L.cc),function(V){V.contactId=(E.getContactsByEmail(V.email)||[0])[0]["id"];});return{subject:P.escapeHtml(U.subject),recipients:L,from:U.from};},validateSuccessData:function(S){var L=S.view&&K.isString(S.view)&&(!S.width||K.isNumber(parseInt(S.width,10)))&&(!S.height||K.isNumber(parseInt(S.height,10)));return this.validateLog(L,S);},onSuccess:function(S,T,L){if(L&&L.attachAppView){L.attachAppView(T,S.data,this.sharedData.data);}else{H("OM compose event onSuccess - no view or not an OMSendconfirmView: event="+this.returnEventId);}}});C&&M({eventName:D.SENDCOMPLETE,onSuccess:function(S,T,L){H("compose.sendcomplete success callback");}});M({eventName:D.USER_EVENT,formatData:function(T){var S=this.view,U=S._getHeader(),L={to:U.to,cc:U.cc,bcc:U.bcc};this.appArgs=T.args;S.getRTEInstance().Selection.cleanCursor();return{body:S.getContent(),recipients:L,from:U.from,subject:P.escapeHtml(U.subj)};},getSharedData:function(){if(!this.sharedData.returneMessage){this.sharedData.returnMessage=this.sharedData.proceed;}A.mix(this.sharedData,this.appArgs);this.sharedData.body=this.sharedData.data.body;delete this.sharedData.data.body;return this.sharedData;},validateSuccessData:function(V){var W=!V.body||K.isString(V.body),U=!V.to||K.isArray(V.to),T=!V.cc||K.isArray(V.cc),L=V.body||V.to||V.cc,S=W&&U&&T&&L;return this.validateLog(S,V);},onSuccess:function(T,X,S){var L=T.data.body,W=T.data.to,U=T.data.cc,V;if(L){S.setContent(L,false);}if(W){V=S.getFirstNode("to");S._makeLozenges(W,V);}if(U){V=S.getFirstNode("cc");S._makeLozenges(U,V);}}});function I(){return A.Object.keys(R);}function O(L){if(!(L in R)){throw new Error("OM compose unsupported event: "+L);}return R[L];}A.mix(B,{COMPOSE:D,getSupportedEvents:I,getHandlerClass:O});},"1.0.0",{requires:["om-common-utils","om-controller-base"]});YUI.add("om-controller-compose",function(E){var M=E.om,c=M.common.Utils,C=M.model.DataStore,T=C.Registry,Z=C.ViewRegistry,V=T.getAll(),N=M.Controller,a=M.Controller.Views,A=N.extend("Compose"),G=E.common.Utils.assert,K=function(){E.log.apply({},arguments);c.log.apply({},arguments);},I="om:",H=E.common.Utils.rocketstats,d=false,B=(function(){var Y={};return function(g,f){if(!(g in Y)||f){Y[g]=[];}return Y[g];};})(),X=N.ComposeEvents,S=X.COMPOSE,J=X.getSupportedEvents();function O(f){var Y;if(!f||T.isSick(f)){return null;}return c.tryProp(f,"config.events.compose.action.launch");}function b(Y,f){var g=a.getInternalViewId(Y,"compose",f);return Z.get(g)!==null;}function P(i,f){G(i.app==f);var g=i.instance,h=O(i),Y=T.isPreload(i);if(!h||!h.view||i.needsAck||T.isSick(i)){return;}if(b(f,h)){return;}if(!Y&&!d){return;}K("yomc:loadComposeView: "+i.name);E.each(J,function(j){var l=c.getEventName(i.instance,j,null),k=l+"registered";E.once(k,function(m,n){R(i,j,l);if(j===S.USER_EVENT){Q(i,l,n);}});});E.once("om:close_application"+g,F);a.runActions(i,"events","compose",true,null);}function U(){E.detach("omcompose|*");if(d){return;}d=true;V=T.getAll();E.each(V,P);}function R(i,Y,f){var g,h=i.instance;g=E.on(I+Y,function(n,k,j){var l,m;if(j&&j!==f){return;}try{l=new (X.getHandlerClass(Y))(f,n,k);}catch(o){K('OM Compose Ctrl: Caught exception for event "'+Y+'"... returning. '+o.message);return;}m=E.on(l.returnEventId,l.responseHandler,l,i,k);B(i.instance).push(m);E.fire(f,l.getSharedData());});B(h).push(g);}function F(Y){E.each(B(Y),E.detach);B(Y,true);}function Q(i,f,Y){var g=i.instance,h={label:Y.label,tooltip:Y.tooltip,tab:Y.tab};function j(l,k){Y.elemID=l;H.stat("OM","compose:user_event:click:"+i.app);E.fire(I+S.USER_EVENT,{args:Y},k,f);}E.once("om:close_application"+g,E.mail.ComposeView.removeButtons);E.mail.ComposeView.addButton(h,g,j);}function e(){var Y=[];E.each(V,function(f){if(T.isLargeFiler(f)){Y.push(f);}});return Y;}function D(Y){a.runActions(Y,"events","url",true,{});}function L(m){var Y=e();if(!Y.length){return false;}var k=window.strings||{},h=k["str_comp_attach_error"]||"",l=k["str_comp_attach_size_exceeded"],i=E.common.Utils.substitute,g={partner_name:function(){return Y[0].developer_name;},app_name:function(){return Y[0].name;}},j=k["str_comp_attach_install_app"];j=i(j,{},g);function f(){D(Y[0]);m._removeAllAttachments(m._isAttachmentOversized);}E.use("common-ui-dialog-helper",function(n){n.common.ui.DialogHelper.confirm({hd:h,bd:["<p>",l,"</p><p>",j,"</p>"].join("")},{ok:{handler:f,stopDestroy:false}});});return true;}function W(){E.each(V,P);E.on("om:register_app",P);E.once("omcompose|newMessage",U);E.once("omcompose|editMessage",U);E.once("omcompose|Y.mail.ui.Workspace:composeMessage:complete",U);}E.mix(E.mail.AttachmentView,{attachErrorSize:L},true);K("Open Mail is overriding mail.ComposeView.");E.mail.ui.Factory.register("mail.ComposeView",M.ui.ComposeView);if(C.Loading.isLoading()){E.on("om:datastoreLoaded",W);}else{W();}},"1.0.0",{requires:["om-controller-base","om-controller-views","om-ui-composeview","om-controller-compose-events","om-controller-internalapi","rocket-stats","om-common-utils","common-utils-stats"]});