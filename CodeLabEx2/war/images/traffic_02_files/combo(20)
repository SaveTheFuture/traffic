YUI.add("mail-ui-messagesview-resize",function(A){A.namespace("mail.MessagesViewResize");var E=A.common.persist.getCookie(),B="pos.vslider",F=A.common.persist.UserData,C=function(){};function D(K){var J,N,M=this,L=K.cursor||"row-resize";M.id=K.id||"rail-resize-hori";M.drag_node=N=A.one("#"+M.id);M.realParent=J=K.messagesview.get("parentNode");M.inbox=J.one("div.inbox");M.tripane=J.one("div.tripane");M.on=K.on||1;M.msgsView=K.messagesview;M.OFFSET_STYLE=M.OFFSET_STYLE||"offsetHeight";M.INBOX_STYLE=M.INBOX_STYLE||"height";M.TRIPANE_STYLE=M.TRIPANE_STYLE||"top";M.DRAG_STYLE=M.DRAG_STYLE||"top";M.COOKIE_NAME=M.COOKIE_NAME||B;M.PREFIX=M.PREFIX||"";M.MIN_PANE=M.MIN_PANE||80;M.MIN_LIST=M.MIN_LIST||100;if(!N){M.drag_node=N=A.Node.create('<div style="position:absolute;z-index:1" id="'+M.id+'"></div>');N.setStyles(K.styles||{top:(E.get(B)||148)});J.append(N);}(new A.mail.DD({scope:this,start:M.start,end:M.endUp,move:M.moveMouse,node:M.drag_node,cursor:L,disable:A.one("#msg-list")}));M.checkDisplay();}D.prototype={checkDisplay:function(){var P=this,N=E.get(P.COOKIE_NAME),M,O,L,J,K;if(N&&P.on){if(P.PREFIX&&N.charAt(0)==P.PREFIX){N=parseInt(N.substr(1));}N=parseInt(N);M=A.one("#shellcontent");O=M?M.get(P.OFFSET_STYLE):10000000;K=P.msgsView;if((N+P.MIN_PANE)>O){L=O-P.MIN_PANE;J=L>P.MIN_LIST;if(J){P.inbox.setStyle(P.INBOX_STYLE,L);P.tripane.setStyle(P.TRIPANE_STYLE,L+6);P.drag_node.setStyle(P.DRAG_STYLE,L);E.set(P.COOKIE_NAME,(P.PREFIX+L));}else{P.msgsView.togglePreviewPane();}}}},setDisplay:function(J){this.drag_node.setStyle("display",(J?"block":"none"));this.on=J?1:0;},start:C,endUp:function(){var J=parseInt(this.drag_node.getStyle("top"),10);E.set(B,J);A.fire("msgsview:splitterdone");},moveMouse:function(N){var Q=this,P=N.pageY,K=A.one("body").get("offsetHeight"),O=157,L=P-O,J=Q.MIN_LIST,M=Q.MIN_PANE;if(P>(K-M)){N.halt();L=K-O-M;}if(L<=J){N.halt();L=J;}Q.drag_node.setStyle("top",L);Q.inbox.setStyle("height",L);Q.tripane.setStyle("top",L+6);}};A.namespace("mail.ui").MessagesViewResize=D;function H(L){var J=["subj","from","to","date","size"];for(var K=0;K<J.length;K++){if(L.lastIndexOf(J[K])>-1){return J[K];}}}function G(L,M){var K=H(L.get("className")),J;if(K){J=Math.round(L.getData("col-right"));E.set("column_resize."+K+".width_pct",(100-(M+J)));E.set("column_resize."+K+".left_pct",M);}}var I={init:function(J){this.element=J;this.resizeableColumns=this.element.all(".flex > div");this.createResizeWidgets();},createResizeWidgets:function(){var J=A.one("div.flex").get("offsetWidth");this.resizeableColumns.each(function(M,X){var T=this;if(!M.getData("col-right")){var Y,U,Q=M.get("offsetLeft"),V=M.get("offsetWidth");Q=Q>0?Q:0;V=V>0?V:0;Y=Math.round(Q/J*100);U=Math.round((J-(V+Q))/J*100);M.setData("col-left",Y);M.setData("col-right",U);}if(!X){return;}var L=A.Node.create('<div class="rail-resize" style="border: 3px solid transparent" id="resize-'+M.getAttribute("data-action")+'"></div>');M.append(L);var S=0,W,P,Z,N;var K=function(a){var b=M.get("region");N=M.previous();while(!N.getData("col-right")){N=N.previous();}P=N.get("region").left+75;W=b.left+b.width-75;Z=M.get("parentNode").get("offsetWidth");};var R=function(d){if(!S){S=d.target.startXY[0];}var h,g,b,e,f,c,a=d.target.lastXY[0];if(a<P||a>W){return false;}h=S-a;S=a;g=Math.round(h/Z*100*1000)/1000;b=A.StyleSheet("ColResize");e=Math.round(M.getData("col-left"))-g;c=H(M.get("className"));if(c){M.setData("col-left",e);A.all("div.flex ."+c).setStyles({left:e+"%"});b.set("div div.flex div."+c,{left:e+"%"});}f=Math.round(N.getData("col-right"))+g;c=H(N.get("className"));if(c){N.setData("col-right",f);A.all("div.flex ."+c).setStyle("right",f+"%");b.set("div div.flex div."+c,{right:f+"%"});}};var O=function(a){var b=0;S=0;L.setStyle("left",-2);T.resizeableColumns.each(function(d,c){G(d,b);b+=(100-Math.round(d.getData("col-right")));});N=null;};(new A.mail.DD({scope:this,start:K,move:R,end:O,node:L,cursor:"col-resize"}));},this);}};A.all(".list-header").each(function(J){I.init(J);});A.namespace("mail.ui").MessagesViewColResize=I;A.namespace("test.MsgView.Resize");A.mix(A.test.MsgView.Resize,{retrieveClass:H,persistNode:G});},"1.0.0",{requires:["common-persist-cookie-data","stylesheet","node","common-ui-dd","common-persist-user-data"]});YUI.add("mail-ui-messagesview-dd",function(B){B.namespace("mail.MessagesViewDD");var A=B.common.Utils,C=["Draft","%40C%40Chats"];B.mail.MessagesViewDD={setDD:function(O){var S=B.one("#system-folders"),L=false,P=100,E=B.one("#shellnavigation"),R=B.one("#custom-folders"),G=B.one("#custom-folders-nav"),K=B.one("body.fullpage"),N=false,Q=B.one("#accordiontitlelist_bottom");var I={scrollTimer:null,dd:null,pageX:0,pageY:0,clientX:0,clientY:0,timerCB:null,start:function(U,X,W,V,T,Y){this.timerCB=U;this.dd=X;this.pageX=W;this.pageY=V;this.clientX=T;this.clientY=Y;this.scrollTimer=B.Lang.later(P,this,this.ssHandler,null,true);},update:function(T){this.pageY=T;},ssHandler:function(){this.timerCB(this.dd,this.pageX,this.pageY,this.clientX,this.clientY);},isActive:function(){return(this.scrollTimer!=null);},hasMoved:function(T,U){return(T!=this.clientX||U!=this.clientY);},clear:function(){if(this.scrollTimer){this.scrollTimer.cancel();delete this.scrollTimer;this.scrollTimer=null;}}};B.publish("dropMessages",{emitFacade:true,defaultFn:function(X){var W=X.msgs,U=X.fromFid,V=X.toFid,T=X.theList;if(B.mail.ui.MessageEvents){B.mail.ui.MessageEvents.handleUI({action:"move",fid:V},U,T,W);if(V==="Trash"){B.fire("darlaEvent",{action:"dd_msg_to_trash"});}else{if(U==="Trash"){B.fire("darlaEvent",{action:"dd_msg_to_folder"});}}}}});var D=function(U){var T=function(W){function V(X){if(U.dd.dragging&&X.arr.length&&W.Array.indexOf(C,O.fid)===-1){U.dd.proxy=W.Node.create('<div style="z-index: 999" class="msgDragProxy"><span></span><b class="counter">'+X.arr.length+"</b></div>");W.one("body").prepend(U.dd.proxy);U.dd.proxy.setXY([-100,-100]);U.dd.shellbottom=E.get("winHeight");U.dd.shelltop=E.getY();}else{U.notDragging=true;}}if(O.hasMsgList){O.msgList.vlist.getSelected(V);}else{V([O.msgPane.get("message")]);}N=G.hasClass("expanded")?true:false;};I.clear();if(U.target.hasClass("list-view-items")){U.notDragging=true;return;}if(!L){B.use("mail-ui-messageevents",T);L=true;}else{T(B);}};var M=function(U,V){var W,T=B.mail.MessagesViewDD.currentDrop;if(V.getAttribute("data-fid")){W=V.getAttribute("data-fid");if(U.proxy.inRegion(V)&&O.fid!==W&&W!=="Draft"&&W!=="Sent"&&W!=="%40C%40Chats"){if(T){T.removeClass("popping");}V&&V.addClass("popping");B.mail.MessagesViewDD.currentDrop=V;}else{if(V.hasClass("popping")){V.removeClass("popping");B.mail.MessagesViewDD.currentDrop=null;}}}};var J=function(T){if(I.isActive()&&!I.hasMoved(T.clientX,T.clientY)){return;}I.clear();F(T.dd,T.pageX,T.pageY,T.clientX,T.clientY);};var F=function(c,Y,X,W,U){var d,b=MARGIN_BOTTOM=MOVING_UNIT=30,T,Z,e,V=c.shelltop,a=c.shellbottom;if(NeoConfig.intl=="jp"){MARGIN_BOTTOM=parseInt(Q.getStyle("height"))+parseInt(Q.getStyle("bottom"))+40;}if(c.proxy){if(c.proxy._node){c.proxy.setStyle("top",X);c.proxy.setStyle("left",Y);}if(!N){if(c.proxy.inRegion(G)){G.replaceClass("collapsed","expanded");N=true;}}if(c.proxy.inRegion(E)){if(c.proxy.inRegion(R)){R.all("li").each(function(f){M(c,f);});}else{if(c.proxy.inRegion(S)){S.all("li").each(function(f){M(c,f);});}else{if(B.mail.MessagesViewDD.currentDrop){B.mail.MessagesViewDD.currentDrop.removeClass("popping");B.mail.MessagesViewDD.currentDrop=null;}}}if(K){V=window.scrollY||0;a=V+K.get("winHeight");}if(X<V+b){T=Z=true;}else{if(X>a-MARGIN_BOTTOM){T=true;Z=false;}}if(T){if(Z){if(K){window.scrollTo(0,V-MARGIN_BOTTOM);B.UA.ie&&(window.scrollY=V-MARGIN_BOTTOM);e=X-MOVING_UNIT;if(e<0){e=0;}}else{d=E.get("scrollTop");E.set("scrollTop",d-MOVING_UNIT);e=X;}}else{if(K){window.scrollTo(0,V+MOVING_UNIT);B.UA.ie&&(window.scrollY=V+MOVING_UNIT);e=X+MOVING_UNIT;}else{d=E.get("scrollTop");E.set("scrollTop",d+MOVING_UNIT);e=X;}}if(!I.isActive()){I.start(F,c,Y,X,W,U);}I.update(e);}else{I.clear();}}else{if(B.mail.MessagesViewDD.currentDrop){B.mail.MessagesViewDD.currentDrop.removeClass("popping");B.mail.MessagesViewDD.currentDrop=null;I.clear();}}}};var H=function(V){var T,U;I.clear();if(V.dd.proxy){V.dd.proxy.remove(true);if(B.mail.MessagesViewDD.currentDrop){B.mail.MessagesViewDD.currentDrop.removeClass("popping");T=B.mail.MessagesViewDD.currentDrop.getAttribute("data-fid");U=function(W){if(O.hasMsgList){W.fire("dropMessages",{fromFid:O.fid,toFid:T,theList:O.msgList});if(NeoConfig.fullPage){O.msgList.vlist.resetFocus();}}else{W.fire("dropMessages",{fromFid:O.fid,toFid:T,msgs:[O.msgPane.get("message")]});}};if(!L){B.use("mail-ui-messageevents",U);L=true;}else{U(B);}}}B.mail.MessagesViewDD.currentDrop=null;};(new B.mail.DD({start:D,move:J,end:H,node:B.one("div.list-view")}));}};},"1.0.0",{requires:["mail-model-datastore","common-utils","node-base","common-ui-dd"]});