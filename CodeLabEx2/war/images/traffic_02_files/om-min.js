var JSON;if(!JSON){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());var YUI;if(typeof YUI==="undefined"){(function(){var e=".",b=Object.prototype.hasOwnProperty,d=Object.prototype.toString,c={"undefined":"undefined",number:"number","boolean":"boolean",string:"string","[object Function]":"function","[object RegExp]":"regexp","[object Array]":"array","[object Date]":"date","[object Error]":"error"},f,a=function(j,i){var h=typeof j;return(j&&(h==="object"||(!i&&(h==="function"||f.Lang.isFunction(j)))))||false};f={namespace:function(){var k=arguments,q=this,n=0,m,p,h;for(;n<k.length;n++){h=k[n];if(h.indexOf(e)){p=h.split(e);for(m=(p[0]=="YAHOO")?1:0;m<p.length;m++){q[p[m]]=q[p[m]]||{};q=q[p[m]]}}else{q[h]=q[h]||{}}}return q},add:function(h,i){if(i){i(f)}},use:function(){var h=arguments[arguments.length-1];if(typeof h==="function"){h(f)}},log:function(){},merge:function(){var k=arguments,m=0,j=k.length,h={};for(;m<j;++m){f.mix(h,k[m],true)}return h},Object:{_hasEnumBug:!{valueOf:0}.propertyIsEnumerable("valueOf"),_forceEnum:["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toString","toLocaleString","valueOf"]},mix:function(h,j,q,k,n,r){var o,u,t,m,v,p,s;if(!h||!j){return h||f}if(n){if(n===2){f.mix(h.prototype,j.prototype,q,k,0,r)}t=n===1||n===3?j.prototype:j;s=n===1||n===4?h.prototype:h;if(!t||!s){return h}}else{t=j;s=h}o=q&&!r;if(k){for(m=0,p=k.length;m<p;++m){v=k[m];if(!b.call(t,v)){continue}u=o?false:b.call(s,v);if(r&&u&&a(s[v],true)&&a(t[v],true)){f.mix(s[v],t[v],q,null,0,r)}else{if(q||!u){s[v]=t[v]}}}}else{for(v in t){if(!b.call(t,v)){continue}u=o?false:b.call(s,v);if(r&&u&&a(s[v],true)&&a(t[v],true)){f.mix(s[v],t[v],q,null,0,r)}else{if(q||!u){s[v]=t[v]}}}if(f.Object._hasEnumBug){f.mix(s,t,q,f.Object._forceEnum,n,r)}}return h},Lang:{isString:function(h){return typeof h==="string"},isFunction:function(h){return f.Lang.type(h)==="function"},type:function(h){return c[typeof h]||c[d.call(h)]||(h?"object":"null")}}};YUI=function(){return f};for(var g in f){if(f.hasOwnProperty(g)){YUI[g]=f[g]}}})()}if(typeof YAHOO==="undefined"||!YAHOO){var YAHOO={util:{}}}if(typeof YAHOO.util==="undefined"||!YAHOO.util){YAHOO.util={}}if(!YAHOO.util.CrossFrame){YAHOO.util.CrossFrame=(function(){var k=/^frames\[(\d+)\]$/,h=/^frames\[['"]([a-zA-Z0-9-_]+)['"]\]$/;var m,e,g,o,i,f,c,b,n,a=YUI;if(window.postMessage||document.postMessage){c=function(p,s,q){var r;if(n(q||"1.0.15","1.0.15")<1){r=[i(s),i(p)].join("|")}else{r=[i(q),i(s),i(p)].join("|")}return r};b=function(r){var q=r.split("|"),p;for(p=q.length-1;p>=0;--p){q[p]=f(q[p])}if(q.length==2){return{sig:q[0],body:q[1]}}else{if(q.length==3){return{version:q[0],sig:q[1],body:q[2]}}else{return null}}};i=function(p){return p.replace(/\|/g,"&c124;")};f=function(p){return p.replace(/&c124;/g,"|")}}else{c=function(p,u,q,s,r){var t;q=q||"1.0.15";if(n(q,"1.0.15")<1){t=[u,p.replace(/\&/g,"&c38;").replace(/\"/g,"&c34;").replace(/\'/g,"&c39;").replace(/\\/g,"&c92;").replace(/\0/g,"&c0;").replace(/\n/g,"&c10;").replace(/\r/g,"&c13;")].join("|")}else{if(n(q,"1.1.9")<0){t=[i(q),i(u),i(p)].join("|")}else{t=[i(q),i(u),i(p),i(s),i(r)].join("|")}}return t};b=function(q){var p=q.split("|");if(p.length===2){return{sig:p[0],body:p[1].replace(/&c13;/g,"\r").replace(/&c10;/g,"\n").replace(/&c0;/g,"\0").replace(/&c92;/g,"\\").replace(/&c39;/g,"'").replace(/&c34;/g,'"').replace(/&c38;/g,"&")}}else{if(p.length===3){return{version:f(p[0]),sig:f(p[1]),body:f(p[2])}}else{if(p.length===5){return{version:f(p[0]),sig:f(p[1]),body:f(p[2]),target:f(p[3]),url:f(p[4])}}else{return null}}}};i=function(p){return escape(p.replace(/\&/g,"&c38;").replace(/\"/g,"&c34;").replace(/\'/g,"&c39;").replace(/\\/g,"&c92;").replace(/\0/g,"&c0;").replace(/\n/g,"&c10;").replace(/\r/g,"&c13;").replace(/\//g,"&c47;").replace(/\@/g,"&c64;").replace(/\+/g,"&c43;"))};f=function(p){return unescape(p).replace(/&c43;/g,"+").replace(/&c64;/g,"@").replace(/&c47;/g,"/").replace(/&c13;/g,"\r").replace(/&c10;/g,"\n").replace(/&c0;/g,"\0").replace(/&c92;/g,"\\").replace(/&c39;/g,"'").replace(/&c34;/g,'"').replace(/&c38;/g,"&")}}n=function(t,r){var s=typeof t==="string",q=typeof r==="string";if(!s||!q){return s&&!q?1:(!s&&q?-1:0)}t=t.split(".");r=r.split(".");if(t.length!==3||r.length!==3){throw new Error("Invalid version format")}var v=0,u=0;for(var p=0;p<3;p++){v=parseInt(t[p],10);u=parseInt(r[p],10);if(v!==u){return(v>u)?1:-1}}return 0};e=function(p,q){if(Object.prototype.hasOwnProperty){return p.hasOwnProperty(q)}return typeof p[q]!=="undefined"&&p.constructor.prototype[q]!==p[q]};g=function(v){var w,t,y,x,u,q;w={};t=v.split("&");for(u=0,q=t.length;u<q;u++){x=t[u].indexOf("=");w[t[u].substr(0,x)]=decodeURIComponent(t[u].substr(x+1))}return w};m=function(v){var s=v.split("."),t,r,q,u;v=window;for(r=0,q=s.length;r<q;r++){u=s[r];if(u==="parent"){v=v.parent}else{if(u==="opener"){v=v.opener}else{if(u==="top"){v=v.top}else{if((t=k.exec(u)||h.exec(u))){v=v.frames[t[1]]}else{throw new Error("Invalid Target: "+v)}}}}}return v};o=function(){var u,t,r,q,p,w=g(window.location.hash.substr(1)),v=b(window.name);if(w.target){t=m("parent."+w.target);q=w.url}else{t=m("parent.opener."+v.target);q=v.url}if(v&&t&&q){r=q.split("/")[2];p=v.version;u=(t.YUI&&t.YUI.util&&t.YUI.util.CrossFrame)?t.YUI.util.CrossFrame:t.YAHOO.util.CrossFrame;try{if(navigator.userAgent.indexOf("Firefox")>-1){t.setTimeout(function(){u._receive([v.sig,v.body].join("|"),r,q,p)},0)}else{u._receive([v.sig,v.body].join("|"),r,q,p)}}catch(s){}}else{throw new Error("Missing required params")}};function d(r,s,q,p){a.util.CrossFrame._receive(r,s,q,p)}var j;j={proxyReceive:o,parseTarget:m,constructMessage:c,deconstructMessage:b,escapeAttr:i,unescapeAttr:f,compareVer:n,_receive:d};return j})();if(typeof YUI!=="undefined"&&YUI){YUI.namespace("util.CrossFrame");YUI.add("omCrossframe",function(a){},"1.0.0",{requires:[]});(function(d){var u="1.1.19",p=YUI.util.CrossFrame;var h="OM_VBS_Wrapper",b="OM_VBS_GetWrapper",s="OM_VBS_HandleMessage",m="OM_VBS_CreateChannel",j,v=window.location.toString(),i,x,n,y;i=YAHOO.util.CrossFrame.parseTarget;x=YAHOO.util.CrossFrame.compareVer;function o(D,C,B,e){if(D&&D.addEventListener){D.addEventListener(C,B,e)}else{if(D&&D.attachEvent){D.attachEvent("on"+C,B)}}}function g(e){if(e.stopImmediatePropagation){e.stopImmediatePropagation()}else{if(e.stopPropagation){e.stopPropagation()}}e.cancelBubble=true}n=function(D){var e=(d.Lang.isString(D))?D.replace(/#$/,""):false,C=document.getElementsByTagName("iframe"),B;for(B=0,l=C.length;B<l;B++){if(C[B].src.replace(/#$/,"")===e||C[B].contentWindow.location===D){return C[B]}}return null};y=function(D){var B=(typeof D==="object")&&(D!==null)&&(typeof D.sig==="string")&&(typeof D.body==="string")&&(D.sig.length>2)&&(D.body.length>0);if(B){try{if(x(D.version||"1.0.15","1.0.15")<1){}else{B=(x(D.version,D.version)===0)}}catch(C){B=false}}return B};var z,q,k,a,t,A,r,f,c;k=YAHOO.util.CrossFrame.constructMessage;a=YAHOO.util.CrossFrame.deconstructMessage;t=YAHOO.util.CrossFrame.escapeAttr;A=YAHOO.util.CrossFrame.unescapeAttr;if(window.postMessage||document.postMessage){r=!window.postMessage;o(window,"message",function(B){var C,D,E,G;B=B||window.event;try{G=a(B.data);if(y(G)){D=B.origin;E=D.split("/")[2];C=n(B.source.location);if(self===top){g(B)}p.fire("receiveMessage",[G.sig,G.body].join("|"),E,D,C,G.version)}else{}}catch(F){d.log("crossframe.js:onMessageListener: error msg["+F.message+"]")}},false);z=function(E){var B,D,C=i(E.target),e=E.version||u;if(!C){return false}if(r){C=C.document}D=k(E.message,E.sig||"",e);C.postMessage(D,E.proxy);E.handler.call(window);return true}}else{if(window.ActiveXObject){j={};window[s]=function(e,H,I,F){var E=arguments.length,D,C,B,G;window.setTimeout(function(){try{if(E===1){D=JSON.parse(e);e=D.uri;H=D.sig;I=D.message;F=D.version}else{e+="";H+="";I+="";F+=""}C=n(e);B=e.split("/")[2];p.fire("receiveMessage",[H,I].join("|"),B,e,C,F)}catch(J){}},0)};window[m]=function(e,B){j[e]=B};vbscript=["Class "+h+"\n ","Private m_Intended\n","Public Sub SetIntendedName(name)\n ","If isEmpty(m_Intended) Then\n","m_Intended = name\n","End If\n","End Sub\n","Public Sub SendMessage(data)\n ",s+"(data)\n","End Sub\n","Public Sub SendMessage2(uri, sig, message, version)\n ","Call "+s+"(uri, sig, message, version)\n","End Sub\n","Public Sub CreateChannel(channel)\n ","Call "+m+"(m_Intended, channel)\n","End Sub\n","End Class\n","Function "+b+"(name)\n","Dim wrap\n","Set wrap = New "+h+"\n","wrap.SetIntendedName name\n","Set "+b+" = wrap\n","End Function"].join("");try{window.execScript(vbscript,"vbscript")}catch(w){}}z=function(E){var B,C;E.version=E.version||u;E.sig=E.sig||"";E.uri=v;try{B=E.targetId||"parent";if(B=="parent"){C=j.parent;if(!C&&window.opener&&"CreateChannel" in window.opener){C=window.opener;C.CreateChannel(window[b]("parent"));j.parent=C;window.opener=null}if(C){if("SendMessage2" in C){C.SendMessage2(E.uri,E.sig,E.message,E.version)}else{C.SendMessage(JSON.stringify(E))}E.handler.call(window);return true}}else{if(j[B]){if("SendMessage2" in j[B]){j[B].SendMessage2(E.uri+"",E.sig+"",E.message+"",E.version+"")}else{j[B].SendMessage(JSON.stringify(E))}E.handler.call(window);return true}}}catch(D){}c.send(E)};c=(function(){var e=(function(){var C=0;return function(){return"om_xdm_proxy"+C++}})();q=function(D){function C(){var E=document.getElementById(D);E.getElementsByTagName("iframe")[0].onload=null;if(E.parentNode){E.parentNode.removeChild(E)}E=null}p.mapHandlers[D].call(window);delete p.mapHandlers[D];if(navigator.userAgent.indexOf("Firefox")>-1){setTimeout(C,0)}else{C()}};var B=function(E){if(!document||!document.body){setTimeout(function(){z(E)},20);return}var I=E.proxy,G=E.target,O=E.message,L=E.handler,N=E.sig||"",H=E.version||u;if(!i(G)){L();return false}if(window.ActiveXObject&&x(H,"1.1.9")>=0){var J=new ActiveXObject("htmlfile");J.open();J.parentWindow.opener=window;J.parentWindow.callback=function(){J=null;L()};J.write(["<html><head></head><body>",'<iframe src="',I,'" name="',k(O,N,H,G,v),'"></iframe>',"<script>onload = callback;<\/script>","</body></html>"].join(""));J.close()}else{var K=[I,"#","target=",encodeURIComponent(G)+"&url=",encodeURIComponent(v)].join(""),F,D,C=document.createElement("div"),M=C.style;D=e();p.mapHandlers[D]=L;F=["<iframe onload=\"YAHOO.util.CrossFrame.iframeOnload('",D,'\');" name="',k(O,N,H),'" src="',K,'"></iframe>'].join("");M.width=M.left=M.top=M.height="0";M.overflow="hidden";M.position="absolute";C.id=D;document.body.appendChild(C);C.innerHTML=F}return true};return{send:B}})()}d.mix(p,{_events:{},on:function(e,C){var B=this._events;if(!B[e]){B[e]=[C]}else{B[e].push(C)}},fire:function(C){var E=this._events[C]||[],B=Array.prototype.slice.apply(arguments,[1]);for(var D=E.length;D--;){try{E[D].apply(null,B)}catch(F){}}},send:z,mapHandlers:{},_receive:function(D,E,C,e){var B=n(C);p.fire("receiveMessage",D,E,C,B,e)},initIEFrameTransport:function(e,C){var B;if(window.ActiveXObject&&!window.postMessage){B=window[b](C);e.contentWindow.opener=B}},proxyReceive:YAHOO.util.CrossFrame.proxyReceive},true);YAHOO.util.CrossFrame.iframeOnload=q})(YUI())}}if(typeof YUI!=="undefined"&&YUI&&!(YUI.om&&YUI.om.Iframe)){YUI.namespace("om.Iframe");(function(b){var d=[],f=[],j,c,g,i,e=true,h=YUI.util.CrossFrame;j=function(v,o,m,p,s){var k=v.indexOf("|"),u=v.substr(0,k),t,q,n;v=v.substr(k+1);for(q=0,n=d.length;q<n;q++){t=d[q];if(t.sig){if(!u||(t.sig!==u)){continue}}if(t.filter&&((t.filter.exec&&!t.filter.exec(m))||(t.filter.call&&!t.filter.call(null,m)))){continue}if(t.handler){try{t.handler.apply(t.scope,[{iframe:p,version:s},v.substr(4)])}catch(r){b.log("Exception in user defined handler","om.Iframe","iframe.js")}}}};h.on("receiveMessage",j);c=function(k){if(!k.pattern||!k.pattern.test||!k.handler||!k.handler.call){return false}d.push(k);return true};i=function(o,q,p,m,k,n){f.push({proxy:o,target:q,message:p,handler:g,sig:m,version:k,targetId:n});if(!e){g()}};g=function(){if(!f.length){e=false;return}e=true;h.send(f.shift())};YUI.om.Iframe={listen:c,send:i};function a(k){if(/in/.test(document.readyState)){setTimeout(function(){a(k)},9)}else{k()}}if(window.postMessage||document.postMessage||(top==self)){g()}else{if(document.addEventListener){document.addEventListener("DOMContentLoaded",g,false)}else{a(g)}}})(YUI())}YUI.add("om-common-errors",function(a){a.namespace("om.common.Errors");a.mix(a.om.common.Errors,{ERR_NONE:0,ERR_BAD_ARG:1,ERR_DEPRECATED:2,ERR_DELETED:3,ERR_XFRAME:4,ERR_UNSUPPORTED_BY_HOST:5,ERR_VIEW_NOT_FOUND:1000,ERR_INVALID_TARGET:1001,ERR_VIEW_EXISTS:1002,ERR_NOT_ATTACHMENT_URL:1003,ERR_SET_DATA:1004,ERR_GET_DATA:1005,ERR_KEY_NOT_SET:1006,ERR_KEY_EXPIRED:1007,ERR_KEY_FAILURE:1008,ERR_KEY_INVALID:1009,ERR_REMOVE_DATA:1010,ERR_VALIDATION_FAILURE:2000,ERR_AUTH:3000,ERR_FLASH_REQUIRED:3001,ERR_FLASH_ERR:3002,ERR_FLASH_LAUNCH_ERR:3003,ERR_API_UNAVAILABLE:3004,ERR_UNDEFINED:-1})},"1.0.0");YUI.add("om-common-constants",function(a){a.mix(a.namespace("om.common.Constants"),{DIALOG_CANCEL:0,DIALOG_OK:1,OK:1,FAIL:0,UNDEFINED:2})},"1.0.0");if(typeof YAHOO==="undefined"||!YAHOO){var YAHOO={}}var openmail;YUI.namespace("openmail");var svninfo="o@8866 e@34525 c@34525";YUI().use("om-common-constants","om-common-errors",function(Y){YAHOO.openmail=openmail=function(){var apiVersion="1.1.19";var xdmProxyVer=window.location.href.match(/bn=([^&#]*)/i);var proxyHost=window.location.href.match(/proxyHost=([^&#]*)/i);var proxySSL=window.location.href.match(/proxySSL=([^&#]*)/i);var forceXdmVer=/\bmailver=neo\b/i.test(location.hash)?null:"1.0.19";var sigMatch=window.location.href.match(/sig=([^&#]*)/i);var appSig=(sigMatch&&sigMatch[1])?sigMatch[1]:-1;var proxy=proxyHost?("http"+(proxySSL?"s":"")+"://"+proxyHost[1]+"/om/xdm_proxy?"+xdmProxyVer[0]):null;var handlerMap={};var id_counter=0;var crumb=null;var CrossFrame=YUI.om.Iframe;function registerHandler(handler){var id="z"+Math.floor(Math.random()*1000000000)+"_"+(id_counter++);handlerMap[id]=handler;return id}function receiveHandler(header,cmd){var args=JSON.parse(cmd),id=args.$cbid,d,f=handlerMap[id];if(args.returnMessage){eval("args.returnMessage="+args.returnMessage)}if(args.proceed){eval("args.proceed="+args.proceed)}if(args.cancel){eval("args.cancel="+args.cancel)}if(!f){return}if(args.reason==="data/message"){if(args.data&&args.data.date){d=new Date(args.data.date);args.data.date=d}}if(!args.$keep){delete handlerMap[id];delete args.$cbid;delete args.$apiVersion}try{f(args)}catch(e){send("reportJSError",{message:e.message,url:e.fileName||null,linenumber:e.lineNumber||null},null);throw e}}if(proxyHost){try{CrossFrame.listen({pattern:/^cmd=([\s\S]*)$/,handler:receiveHandler,filter:new RegExp("^https?://"+proxyHost[1].replace(/\./g,"\\.")+"(?:/|$)"),sig:appSig})}catch(e){Y.log("omapi:cant set iframe listener: YUI.om.Iframe missing, check if the app loaded openmail crossframe/omapi correctly. message=["+(e.message||"")+"]")}}else{Y.log("om_api_public: no proxyhost found, can't attach OMIframe listener")}var openmail={};openmail.Constants=Y.om.common.Constants;openmail.Errors=Y.om.common.Errors;var errors=openmail.Errors;function returnError(error,handler){if(handler&&(typeof handler==="function")){handler({error:error})}return error}function handlerOnly(api,args,handler){if((!args.wasNull)||(handler&&typeof handler!="function")){return returnError(errors.ERR_BAD_ARG)}return returnError(errors.ERR_NONE)}var supportChecks={"Mail.refreshApplications":handlerOnly,"Application.getParameters":handlerOnly};openmail.isSupported=function(api,args,handler){api=api.replace(/^openmail\.(.*)/,"$1");var o=openmail,parts=api.split("."),i;for(i in parts){o=o[parts[i]];if(!o){break}}if(!o||(typeof o!="function")){return returnError(errors.ERR_DELETED,handler)}var args2=args||{};args2.checkSupported=true;if(!args){args2.wasNull=true}if(supportChecks[api]){return supportChecks[api](api,args2,handler)}return o(args2,handler)};function send(cmd,args,handler){args=args||{};if(args.checkSupported){return returnError(errors.ERR_NONE,handler)}if(proxy){args.$cmd=cmd;if(handler){args.$cbid=registerHandler(handler)}args.$apiVersion=apiVersion;CrossFrame.send(proxy,"parent",["cmd=",JSON.stringify(args)].join(""),appSig,forceXdmVer);return errors.ERR_NONE}return returnError(errors.ERR_XFRAME,handler)}window.onerror=function(errorMsg,url,lineNumber){send("reportJSError",{message:errorMsg,url:url,linenumber:lineNumber},null);return true};openmail.ERR_NONE=errors.ERR_NONE;openmail.ERR_BAD_ARG=errors.ERR_BAD_ARG;openmail.ERR_DEPRECATED=errors.ERR_DEPRECATED;openmail.ERR_DELETED=errors.ERR_DELETED;openmail.ERR_XFRAME=errors.ERR_XFRAME;function validate(args,constraints,handler){if(handler&&(typeof handler!="function")){return errors.ERR_BAD_ARG}var e,n,r,i;if(constraints){n="'"+(constraints.name||"args")+"'"}if(!args){if(!constraints){return}e={error:errors.ERR_BAD_ARG,errorMsg:n+" is required"}}else{if(typeof args!="object"){e={error:errors.ERR_BAD_ARG,errorMsg:n+" must be an object"}}else{if(constraints&&constraints.required){if(args.checkSupported&&args.wasNull){return returnError(errors.ERR_NONE)}r=constraints.required;for(i=0;i<r.length;i++){if(typeof args[r[i]]=="undefined"){e={error:errors.ERR_BAD_ARG,errorMsg:"Missing required member '"+r[i]+"'"};break}}}}}if(e){if(handler){handler(e)}return e.error}}openmail.Mail={search:function(query,handler){return validate(query,{name:"query",required:["query"]},handler)||send("search",query,handler)},compose:function(msg,handler){return validate(msg,null,handler)||send("compose",msg,handler)},openMessage:function(args,handler){return send("openMessage",args,handler)},draft:function(msg,handler){return validate(msg,{name:"messageId",required:["messageId"]},handler)||send("draft",msg,handler)},refreshApplications:function(handler){send("refreshApplications",{},handler)}};openmail.Application={isSSL:function(){return !!proxySSL},sendMessage:(function(params){var _id=window.location.href.match(/\bvid=([^&#]*)/i),_origin=_id?_id[1]:null;var fn=function(params){var result=validate(params,{name:"msg",required:["msg"]});if(result){return result}var data=JSON.stringify(params.msg),target=params.target,i,l,frame;for(i=0,l=top.frames.length;i<l;++i){try{frame=top.frames[i];if(!target){frame.openmail.Application.sendMessage.receiveMessage(data,_origin)}else{if(target&&frame.openmail.Application.sendMessage.viewId==target){frame.openmail.Application.sendMessage.receiveMessage(data,_origin);break}}}catch(e){}}return result};fn.viewId=_origin;return fn})(),getUserLanguages:function(){var lang=window.location.href.match(/lang=([^#&]*)/i);return lang&&lang[1]?[lang[1]]:["en-US"]},openView:function(view,handler){view.ttl=view.ttl||60;view.title=view.title||null;return validate(view,{name:"view",required:["view","target"]},handler)||send("openView",view,handler)},closeView:function(view,handler){view=view||{id:""};return validate(view,{name:"view",required:["id"]},handler)||send("closeView",view,handler)},filterHTML:function(args,handler){return validate(args,{name:"args",required:["html"]},handler)||send("filterHTML",args,handler)},getParameters:function(handler){if(!handler||(typeof handler!="function")){return errors.ERR_BAD_ARG}return send("getParameters",{},handler)},setFolderConfig:function(config,handler){return validate(config,{name:"config"},handler)||send("setFolderConfig",config,handler)},setTabCloseMessage:function(config){send("setTabCloseMessage",config)},callWebService:function(service,handler){var p;if(crumb&&service&&service.url=="apps://"){p=service.parameters;if(!p){p={}}p.crumb=crumb}return validate(service,{name:"service",required:["url"]},handler)||send("callWebService",service,handler)},getAttachmentUrl:function(args,handler){return validate(args,{name:"url",required:["url"]},handler)||send("getAttachmentUrl",args,handler)},setListener:function(event,handler){var msg,result=validate(event,{name:"event",required:["event"]},handler);if(result){return result}if(event&&event.event=="view.message"&&handler){openmail.Application.sendMessage.receiveMessage=function(msg,origin){msg=JSON.parse(msg);handler({msg:msg,origin:origin})};return result}else{return send("setListener",event,handler)}},upgradeIfNecessary:function(args,handler){if(!handler){return errors.ERR_BAD_ARG}args=args||{suppressMessaging:false};return validate(args,{name:"args",required:["suppressMessaging"]},handler)||send("upgradeIfNecessary",args,handler)},setData:function(data,handler){return validate(data,{name:"data",required:["keys"]},handler)||send("setData",data,handler)},getData:function(keys,handler){return validate(keys,{name:"keys",required:["keys"]},handler)||send("getData",keys,handler)},removeData:function(keys,handler){return validate(keys,{name:"keys",required:["keys"]},handler)||send("removeData",keys,handler)},getAuthService:function(config){config=config||{};var omAuthApi={profile:(config.profile||"_yahoo_internal"),rewrite:{url:config.url,proxy:config.proxy},ERR_AUTH:errors.ERR_AUTH,getStatus:function(handler){return validate(null,null,handler)||send("getAuthStatus",{profile:this.profile},handler)},getUserAuthorizationURL:function(params,handler){return validate(null,null,handler)||send("getUserAuthorizationUrl",{params:params,profile:this.profile},handler)},notifyAuthorizationReceived:function(handler){return send("notifyAuthorizationComplete",{profile:this.profile},handler)},removeAuthorization:function(handler){return send("removeAuthorization",{profile:this.profile},handler)},callWebService:function(service,handler){service.profile=this.profile;if(!service.rewrite){service.rewrite=this.rewrite}return send("callAuthWebService",service,handler)}};return omAuthApi}};(function(){var param;if(crumb=(param=window.location.href.match(/crumb=([^#&]*)/i))?param[1]:null){openmail.Application.callWebService({url:"apps://",method:"GET",parameters:{cmd:"setListener",args:{event:"crumb.update"},crumb:crumb}},function(args){if(args.crumb){crumb=args.crumb}})}})();openmail.makeContextualApi=function(ctx){var omapi=Y.merge(openmail);omapi.Application=Y.merge(openmail.Application);function callWithContext(apiName,apiArgs,callback){if(apiName==="getParameters"){callback=apiArgs}var args={url:"apps://",method:"GET",parameters:{cmd:"callWithContext",api:{name:apiName,args:apiArgs},context:ctx}};openmail.Application.callWebService(args,callback)}function makeContextFn(api){return function(){Array.prototype.unshift.call(arguments,api);callWithContext.apply(this,arguments)}}var apis={Application:["setData","getData","openView","closeView","upgradeIfNecessary","setListener","setFolderConfig","getParameters","filterHTML"],Mail:["search","compose","draft"]},api,namespace,i,l;for(namespace in apis){if(apis.hasOwnProperty(namespace)){for(i=0,l=apis[namespace].length;i<l;i++){api=apis[namespace][i];omapi[namespace][api]=makeContextFn(api)}}}omapi.Application.callWebService=function(service,handler){var p;if(crumb&&service&&service.url=="apps://"){p=service.parameters||{};p.crumb=crumb}callWithContext("callWebService",service,handler)};omapi.Application.getAuthService=function(config){var auth=openmail.Application.getAuthService(config);auth.getStatus=function(handler){callWithContext("getAuthStatus",{profile:auth.profile},handler)};auth.getUserAuthorizationURL=function(params,handler){params.profile=auth.profile;callWithContext("getUserAuthorizationUrl",params,handler)};auth.notifyAuthorizationReceived=function(handler){callWithContext("getUserAuthorizationUrl",{profile:auth.profile},handler)};auth.removeAuthorization=function(handler){callWithContext("removeAuthorization",{profile:auth.profile},handler)};auth.callWebService=function(service,handler){service.profile=auth.profile;if(!service.rewrite){service.rewrite=auth.rewrite}callWithContext("callAuthWebService",service,handler)};return auth};return omapi};function addEventListener(el,type,fn,capture){if(el&&el.addEventListener){el.addEventListener(type,fn,capture)}else{if(el&&el.attachEvent){el.attachEvent("on"+type,fn)}}}addEventListener(document,"keydown",function(e){if(e.keyCode==27){openmail.Application.closeView({id:null})}},false);return openmail}()});