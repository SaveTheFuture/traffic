YUI.add("ommenus",function(A){if(!YUI.namespace("Messenger").OMMENUS_LOADED){(function(){var b=A.Messenger.Intl,C=A.Messenger.CommonUtils,W=A.Messenger.SessionManager,T=A.Messenger.ContactsManager,f=A.Messenger.WindowManager,O=A.Messenger.Events,D=window.launchData,L=window.openmail.Application,Z=b.get("str_cfg_generic_messenger"),I,Y=b.get("str_menu_new_im"),R=b.get("str_menu_send_text"),V=b.get("str_menu_report_spam"),a=b.get("str_menu_im_shortcut"),e=b.get("str_menu_sms_shortcut"),H=C.substitute(b.get("str_menu_messenger_options"),{str_cfg_branding_messenger:Z}),S=b.get("str_menu_available"),d=b.get("str_menu_busy"),P=b.get("str_menu_invisible"),U=C.substitute(b.get("str_menu_sign_out_messenger"),{str_cfg_branding_messenger:Z}),K=window.callInternal,M={root:{id:"btn-new"},items:[{data_action:"newIM",title:Y,label:Y,shortcut:a,keycode:a.toUpperCase().charCodeAt(0),icon:{},selected:false}]},g={root:{id:"btn-uh-account",icon:{"class":"ymsg-available"}},items:[{data_action:"im_available",title:S,label:S,shortcut:"",icon:{"class":"ymsg-available"},selected:true},{data_action:"im_busy",title:d,label:d,shortcut:"",icon:{"class":"ymsg-busy"},selected:false},{data_action:"im_invisible",title:P,label:P,shortcut:"",icon:{"class":"ymsg-invisible"},selected:false},{data_action:"im_offline",title:U,label:U,shortcut:"",icon:{"class":"signout"},selected:false},{data_action:"fb_offline",title:"",label:b.get("str_menu_sign_out_facebookchat"),shortcut:"",icon:{"class":"signout"},selected:false,remove:true}]},E={root:{id:"btn-options"},items:[{data_action:"msgr_options",title:H,label:H,icon:{},selected:false}]},F={items:[{data_action:"newIM",icon:{"class":"im"}}]},B={root:{id:"btn-conv-actions"},items:[{data_action:"",title:"",label:"-",shortcut:"",icon:{},selected:false},{data_action:"report_spam",title:V,label:V,shortcut:"",icon:{},selected:false}]},c={data_action:"newSMS",title:R,label:R,shortcut:e,keycode:e.toUpperCase().charCodeAt(0),icon:{},selected:false},G={data_action:"newSMS",icon:{"class":"sms"}};function Q(i){if(i.spammedAs&&i.spammerId&&i.initiatedBy&&i.spims){var h=C.getYidFromEmailAddr(i.spammedAs).value,k,j;if(h){T.reportSpam({spims:i.spims,user:i.spammerId,alias:h,network:"yahoo",initiatedBy:i.initiatedBy});k=b.get("str_offline_msg_report_spam");j=b.get("str_offline_msg_reportasspam");f.alert(C.substitute(j,{user:i.spammerId}),null,k,"warning");}}}function N(){var l=W.getStateID(),k,h,m="im_"+l,j=g.items;for(k=0,h=j.length;k<h;k++){if(j[k].data_action===m){j[k].selected=true;}else{j[k].selected=false;}}switch(l){case"available":g.root.icon["class"]="ymsg-available";break;case"busy":g.root.icon["class"]="ymsg-busy";break;case"invisible":g.root.icon["class"]="ymsg-invisible";break;case"offline":g.root.icon["class"]="ymsg-invisible";break;default:return;}if(W.isOnlineFacebook()){j[j.length-1].remove=false;}else{j[j.length-1].remove=true;}K("setMenuConfig",{"rootObj":g.root,"menuObj":j});}if(D.smsSupported){M.items.push(c);F.items.push(G);}K("setMenuConfig",{"rootObj":M.root,"menuObj":M.items});K("setPreviewPaneButtonConfig",{"buttonObj":F.items});K("setMenuConfig",{"rootObj":B.root,"menuObj":B.items});K("setMenuConfig",{"rootObj":E.root,"menuObj":E.items});N();A.Global.on(O.SELF_PRESENCE_CHANGED,N);A.Global.on(O.CONNECTION_UPDATE,N);A.Global.on(O.LOGIN_FACEBOOK,N);A.Global.on(O.LOGOUT_FACEBOOK,N);var X=function(i){var h=i.data_action,j;switch(h){case"im_available":W.setPresence(0);break;case"im_invisible":W.setPresence(-1);break;case"im_busy":W.setPresence(2);break;case"im_offline":W.logout();break;case"fb_offline":W.logoutFacebook();break;case"msgr_options":A.Global.fire(O.SHOW_WINDOW,"OptionsWindow");break;case"newIM":if(!W.isOnline()){W.login(0,"",function(){A.Global.fire(O.OPEN_CONV_PICKER);});}else{A.Global.fire(O.OPEN_CONV_PICKER);}break;case"newSMS":if(!W.isOnline()){W.login(0,"",function(){A.Global.fire(O.OPEN_SMS_CONV_PICKER);});}else{A.Global.fire(O.OPEN_SMS_CONV_PICKER);}break;case"report_spam":L.callWebService({url:"apps://",method:"GET",parameters:{cmd:"getSelectedItem",args:{context:"spam"}}},function(k){if(!W.isOnline()){W.login(0,"",function(){Q(k);});}else{Q(k);}});break;default:break;}},J=function(l,k){if(!W.isOnline()){W.login(0,"",A.bind(function(){this.openConversation(l,k);},this));return;}if(!k||!k.id){A.Global.fire(l=="sms"?O.OPEN_SMS_CONV_PICKER:O.OPEN_CONV_PICKER);return;}var h,j,i;if(k.network){j=k.network;}else{if(k.cloud_id){j=C.convertCloudId(k.cloud_id);if(!j){A.Global.fire(l=="sms"?O.OPEN_SMS_CONV_PICKER:O.OPEN_CONV_PICKER);return;}}else{j="yahoo";}}h=(j!=="yahoo")?k.id:C.getYidFromEmailAddr(k.id,j).value;if(k.alias){i=C.getYidFromEmailAddr(k.alias,"yahoo").value;}else{i=W.get("loggedInId");}A.Global.fire(O.SHOW_CONVERSATION,{user:h,network:j,alias:i,mode:l,openedBySelf:true});};L.setListener({event:"data.action"},X);K("setListener",{event:"contacts.sendsms"},function(h){J("sms",h);});K("setListener",{event:"contacts.sendim"},function(h){J("im",h);});K("setListener",{event:"chats.sendsms"},function(h){K("getSelectedItem",{context:"reply"},function(i){J("sms",i);});});K("setListener",{event:"chats.sendim"},function(h){K("getSelectedItem",{context:"reply"},function(i){J("im",i);});});A.Messenger.OMMenus=true;YUI.Messenger.OMMENUS_LOADED=true;})();}},"@VERSION@",{requires:["yim-intl","commonutils","sessionmanager","events"]});